<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SYNERGIA v3.0 - Gestion d'√©quipe</title>
    
    <!-- Politique de s√©curit√© du contenu compl√®te pour Firebase -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' 'unsafe-inline' 'unsafe-eval' 
            https://www.gstatic.com 
            https://www.googleapis.com 
            https://cdn.jsdelivr.net 
            https://www.googletagmanager.com;
        style-src 'self' 'unsafe-inline' 
            https://cdnjs.cloudflare.com 
            https://fonts.googleapis.com;
        font-src 'self' 
            https://cdnjs.cloudflare.com 
            https://fonts.gstatic.com;
        connect-src 'self' 
            https://www.gstatic.com 
            https://www.googleapis.com 
            https://firebase.googleapis.com
            https://firestore.googleapis.com 
            https://identitytoolkit.googleapis.com
            https://securetoken.googleapis.com
            https://www.google-analytics.com
            https://analytics.google.com
            https://stats.g.doubleclick.net;
        img-src 'self' data: https:;
        frame-src 'self' https:;
    ">
    
    <!-- CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, updateProfile } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, doc, addDoc, updateDoc, deleteDoc, getDocs, getDoc, onSnapshot, setDoc, query, where, orderBy, limit, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getStorage, ref, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js';

        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyD7uBuAQaOhZ02owkZEuMKC5Vji6PrB2f8",
            authDomain: "synergia-app-f27e7.firebaseapp.com",
            projectId: "synergia-app-f27e7",
            storageBucket: "synergia-app-f27e7.firebasestorage.app",
            messagingSenderId: "201912738922",
            appId: "1:201912738922:web:2fcc1e49293bb632899613",
            measurementId: "G-EGJ79SCMWX"
        };

        // Initialisation Firebase avec gestion d'erreur am√©lior√©e
        let app;
        let analytics = null;
        
        window.firebaseInitPromise = (async () => {
            try {
                console.log('üîß Initialisation Firebase...');
                app = initializeApp(firebaseConfig);
                
                window.firebaseApp = app;
                window.auth = getAuth(app);
                window.db = getFirestore(app);
                window.storage = getStorage(app);
                
                // Initialisation conditionnelle d'Analytics avec d√©lai
                try {
                    await new Promise(resolve => setTimeout(resolve, 1000)); // Attendre 1 seconde
                    const { getAnalytics, isSupported } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js');
                    
                    // V√©rifier si Analytics est support√©
                    const analyticsSupported = await isSupported();
                    if (analyticsSupported) {
                        analytics = getAnalytics(app);
                        window.analytics = analytics;
                        console.log('üìä Analytics activ√© avec succ√®s');
                        window.analyticsReady = true;
                    } else {
                        console.warn('‚ö†Ô∏è Analytics non support√© dans cet environnement');
                        window.analyticsReady = false;
                    }
                } catch (analyticsError) {
                    console.warn('‚ö†Ô∏è Analytics non disponible:', analyticsError.message);
                    console.log('üìä Application fonctionnelle sans Analytics');
                    window.analyticsReady = false;
                }
                
                // Rendre les fonctions Firebase disponibles globalement
                window.firebase = {
                    collection, doc, addDoc, updateDoc, deleteDoc, getDocs, getDoc, 
                    onSnapshot, setDoc, query, where, orderBy, limit, serverTimestamp,
                    onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, 
                    signOut, updateProfile, ref, uploadBytes, getDownloadURL
                };
                
                console.log('‚úÖ Firebase initialis√© avec succ√®s');
                window.firebaseReady = true;
                
                return true;
                
            } catch (error) {
                console.error('‚ùå Erreur d\'initialisation Firebase:', error);
                console.log('‚ö†Ô∏è Activation du mode d√©mo');
                window.firebaseReady = false;
                window.analyticsReady = false;
                return false;
            }
        })();
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        /* Navigation */
        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 0;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
        }

        .nav-logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }

        .nav-menu {
            display: flex;
            gap: 2rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            text-decoration: none;
            color: #666;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .nav-link:hover,
        .nav-link.active {
            color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .nav-user {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-avatar img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        /* Layout principal */
        .main-content {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .content-section {
            display: none;
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .content-section.active {
            display: block;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f0f0f0;
        }

        .section-header h1 {
            color: #333;
            font-size: 2rem;
        }

        .section-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }

        /* Boutons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 1px solid #dee2e6;
        }

        .btn-secondary:hover {
            background: #e9ecef;
        }

        .btn-icon {
            padding: 0.5rem;
            border: none;
            background: transparent;
            border-radius: 6px;
            cursor: pointer;
            color: #666;
            transition: all 0.3s ease;
        }

        .btn-icon:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }

        /* Dashboard */
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 1.5rem;
            border-radius: 12px;
            color: white;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .stat-card i {
            font-size: 2rem;
            opacity: 0.8;
        }

        .stat-info h3 {
            font-size: 2rem;
            margin-bottom: 0.25rem;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }

        .dashboard-widget {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem 0;
            border-bottom: 1px solid #eee;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        /* Status indicators */
        .sync-status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: #28a745;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .sync-status.warning {
            background: #ffc107;
            color: #212529;
        }

        .sync-status.error {
            background: #dc3545;
        }

        .sync-status.loading {
            background: #6c757d;
        }

        .sync-indicator {
            width: 8px;
            height: 8px;
            background: currentColor;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
            100% { opacity: 1; transform: scale(1); }
        }

        /* Form styles */
        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #333;
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            font-size: 1rem;
            outline: none;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
        }

        /* Loading states */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .nav-container {
                flex-direction: column;
                gap: 1rem;
            }

            .nav-menu {
                flex-wrap: wrap;
                justify-content: center;
            }

            .main-content {
                padding: 1rem;
            }

            .dashboard-stats {
                grid-template-columns: 1fr;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .section-header {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-bolt"></i>
                <span>SYNERGIA v3.0</span>
            </div>
            
            <div class="nav-menu" id="nav-menu">
                <a href="#dashboard" class="nav-link active">
                    <i class="fas fa-tachometer-alt"></i>
                    Dashboard
                </a>
                <a href="#team" class="nav-link">
                    <i class="fas fa-users"></i>
                    √âquipe
                </a>
                <a href="#planning" class="nav-link">
                    <i class="fas fa-calendar"></i>
                    Planning
                </a>
                <a href="#chat" class="nav-link">
                    <i class="fas fa-comments"></i>
                    Chat
                </a>
                <a href="#quests" class="nav-link">
                    <i class="fas fa-trophy"></i>
                    Missions
                </a>
                <a href="#settings" class="nav-link">
                    <i class="fas fa-cog"></i>
                    Param√®tres
                </a>
            </div>
            <div class="nav-user">
                <div class="user-avatar">
                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 40 40'%3E%3Crect width='40' height='40' fill='%23667eea'/%3E%3Ctext x='20' y='25' text-anchor='middle' fill='white' font-family='Arial' font-size='16'%3EA%3C/text%3E%3C/svg%3E" alt="Avatar" id="user-avatar">
                </div>
                <span id="user-name">Allan Boehme</span>
                <button id="logout-btn" class="btn-icon">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Contenu principal -->
    <main class="main-content">
        <!-- Dashboard -->
        <section id="dashboard" class="content-section active">
            <div class="section-header">
                <h1>Dashboard</h1>
                <div class="section-actions">
                    <button id="refresh-dashboard" class="btn btn-secondary">
                        <i class="fas fa-sync-alt"></i>
                        Actualiser
                    </button>
                </div>
            </div>

            <div class="dashboard-stats">
                <div class="stat-card">
                    <i class="fas fa-users"></i>
                    <div class="stat-info">
                        <h3 id="team-count">3</h3>
                        <p>Membres d'√©quipe</p>
                    </div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-tasks"></i>
                    <div class="stat-info">
                        <h3 id="active-quests">5</h3>
                        <p>Missions actives</p>
                    </div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-calendar-check"></i>
                    <div class="stat-info">
                        <h3 id="events-today">2</h3>
                        <p>√âv√©nements aujourd'hui</p>
                    </div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-star"></i>
                    <div class="stat-info">
                        <h3 id="user-level">5</h3>
                        <p>Niveau actuel</p>
                    </div>
                </div>
            </div>

            <div class="dashboard-grid">
                <div class="dashboard-widget">
                    <h3><i class="fas fa-history"></i> Derni√®res activit√©s</h3>
                    <div id="recent-activities">
                        <div class="activity-item">
                            <i class="fas fa-rocket" style="color: #667eea;"></i>
                            <span>SYNERGIA v3.0 initialis√©</span>
                            <small style="margin-left: auto; color: #666;">Maintenant</small>
                        </div>
                        <div class="activity-item">
                            <div class="loading-spinner"></div>
                            <span>Chargement Firebase...</span>
                            <small style="margin-left: auto; color: #666;">En cours</small>
                        </div>
                    </div>
                </div>

                <div class="dashboard-widget">
                    <h3><i class="fas fa-database"></i> Statut Firebase</h3>
                    <div style="text-align: center; padding: 1rem;">
                        <div id="firebase-status-dashboard" class="sync-status loading" style="margin-bottom: 1rem;">
                            <div class="loading-spinner" style="width: 8px; height: 8px; border-width: 1px;"></div>
                            <span>Initialisation...</span>
                        </div>
                        <div style="font-size: 0.9rem; color: #666; margin-bottom: 1rem;">
                            <div>Projet: <strong>synergia-app-f27e7</strong></div>
                            <div id="analytics-status-dashboard">Analytics: <span id="analytics-status-text">Chargement...</span></div>
                            <div>Auth: <span id="auth-status-text">Initialisation...</span></div>
                        </div>
                        <button onclick="showFirebaseDetails()" class="btn btn-primary" id="firebase-details-btn" disabled>
                            <i class="fas fa-database"></i>
                            Initialisation...
                        </button>
                    </div>
                </div>

                <div class="dashboard-widget">
                    <h3><i class="fas fa-chart-line"></i> Analytics & M√©triques</h3>
                    <div style="text-align: center; padding: 1rem;">
                        <div style="margin-bottom: 1rem;">
                            <div style="font-size: 1.5rem; color: #667eea; margin-bottom: 0.5rem;">1,250</div>
                            <div style="color: #666; font-size: 0.9rem;">Points d'exp√©rience totaux</div>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <div style="font-size: 1.2rem; color: #28a745; margin-bottom: 0.5rem;">87%</div>
                            <div style="color: #666; font-size: 0.9rem;">Taux de completion missions</div>
                        </div>
                        <button onclick="trackCustomEvent()" class="btn btn-secondary" id="analytics-btn" disabled>
                            <i class="fas fa-chart-bar"></i>
                            <span>Chargement...</span>
                        </button>
                    </div>
                </div>

                <div class="dashboard-widget">
                    <h3><i class="fas fa-cloud"></i> Synchronisation</h3>
                    <div style="text-align: center; padding: 1rem;">
                        <div id="sync-status-display" class="sync-status loading" style="margin-bottom: 1rem;">
                            <div class="loading-spinner" style="width: 8px; height: 8px; border-width: 1px;"></div>
                            <span>Connexion...</span>
                        </div>
                        <div style="font-size: 0.9rem; color: #666; margin-bottom: 1rem;">
                            Statut: <span id="sync-time-text">Initialisation...</span>
                        </div>
                        <button onclick="forceSyncData()" class="btn btn-secondary" id="sync-btn" disabled>
                            <i class="fas fa-sync-alt"></i>
                            Attente...
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Param√®tres -->
        <section id="settings" class="content-section">
            <div class="section-header">
                <h1><i class="fas fa-cog"></i> Param√®tres Syst√®me</h1>
                <div class="section-actions">
                    <button onclick="saveAllSettings()" class="btn btn-primary" id="save-settings-btn" disabled>
                        <i class="fas fa-save"></i>
                        Sauvegarder
                    </button>
                    <button onclick="exportSettings()" class="btn btn-secondary">
                        <i class="fas fa-download"></i>
                        Exporter
                    </button>
                </div>
            </div>

            <!-- Statut Firebase D√©taill√© -->
            <div id="firebase-status" style="background: #fff3cd; border: 1px solid #ffc107; border-radius: 8px; padding: 1rem; margin-bottom: 2rem;">
                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                    <div class="loading-spinner" style="width: 16px; height: 16px;"></div>
                    <strong style="color: #856404;">Statut Firebase - Initialisation</strong>
                </div>
                <div id="firebase-status-details" style="color: #856404; font-size: 0.9rem;">
                    <div id="status-app">üîÑ <strong>App:</strong> Initialisation...</div>
                    <div id="status-auth">üîÑ <strong>Auth:</strong> Chargement...</div>
                    <div id="status-firestore">üîÑ <strong>Firestore:</strong> Connexion...</div>
                    <div id="status-storage">üîÑ <strong>Storage:</strong> Configuration...</div>
                    <div id="status-analytics">üîÑ <strong>Analytics:</strong> V√©rification...</div>
                    <div style="margin-top: 0.5rem;"><strong>Projet:</strong> synergia-app-f27e7</div>
                </div>
            </div>

            <!-- Configuration Firebase -->
            <div style="background: white; border: 1px solid #e9ecef; border-radius: 12px; padding: 2rem; margin-top: 2rem;">
                <h3><i class="fas fa-database"></i> Configuration Firebase</h3>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                    <div>
                        <div class="form-group">
                            <label>API Key</label>
                            <input type="password" id="firebase-api-key" value="AIzaSyD7uBuAQaOhZ02owkZEuMKC5Vji6PrB2f8" readonly>
                        </div>
                        <div class="form-group">
                            <label>Auth Domain</label>
                            <input type="text" id="firebase-auth-domain" value="synergia-app-f27e7.firebaseapp.com" readonly>
                        </div>
                        <div class="form-group">
                            <label>Project ID</label>
                            <input type="text" id="firebase-project-id" value="synergia-app-f27e7" readonly>
                        </div>
                        <div class="form-group">
                            <label>Storage Bucket</label>
                            <input type="text" id="firebase-storage-bucket" value="synergia-app-f27e7.firebasestorage.app" readonly>
                        </div>
                    </div>
                    <div>
                        <div class="form-group">
                            <label>Messaging Sender ID</label>
                            <input type="text" id="firebase-messaging-sender-id" value="201912738922" readonly>
                        </div>
                        <div class="form-group">
                            <label>App ID</label>
                            <input type="text" id="firebase-app-id" value="1:201912738922:web:2fcc1e49293bb632899613" readonly>
                        </div>
                        <div class="form-group">
                            <label>Measurement ID (Analytics)</label>
                            <input type="text" id="firebase-measurement-id" value="G-EGJ79SCMWX" readonly>
                        </div>
                        <div class="form-group">
                            <label>Statut complet</label>
                            <div id="full-status-display" style="padding: 0.75rem; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; font-family: monospace; font-size: 0.8rem;">
                                Initialisation Firebase en cours...
                            </div>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 1.5rem; text-align: center;">
                    <button onclick="testFirebaseConnection()" class="btn btn-primary" id="test-firebase-btn" disabled>
                        <i class="fas fa-plug"></i> Test connexion
                    </button>
                    <button onclick="initializeFirebaseData()" class="btn btn-secondary" id="init-data-btn" disabled>
                        <i class="fas fa-database"></i> Initialiser donn√©es
                    </button>
                    <button onclick="testAnalytics()" class="btn btn-secondary" id="test-analytics-btn" disabled>
                        <i class="fas fa-chart-bar"></i> Test Analytics
                    </button>
                </div>
            </div>
        </section>

        <!-- Sections placeholder -->
        <section id="team" class="content-section">
            <div class="section-header">
                <h1><i class="fas fa-users"></i> Gestion d'√©quipe</h1>
            </div>
            <p>Section √©quipe en d√©veloppement...</p>
        </section>

        <section id="planning" class="content-section">
            <div class="section-header">
                <h1><i class="fas fa-calendar"></i> Planning</h1>
            </div>
            <p>Section planning en d√©veloppement...</p>
        </section>

        <section id="chat" class="content-section">
            <div class="section-header">
                <h1><i class="fas fa-comments"></i> Chat d'√©quipe</h1>
            </div>
            <p>Section chat en d√©veloppement...</p>
        </section>

        <section id="quests" class="content-section">
            <div class="section-header">
                <h1><i class="fas fa-trophy"></i> Missions & R√©compenses</h1>
            </div>
            <p>Section missions en d√©veloppement...</p>
        </section>
    </main>

    <script>
        // Variables globales
        let currentUser = null;
        let isFirebaseReady = false;
        let isAnalyticsReady = false;
        let isDebugMode = false;
        let initializationComplete = false;

        // Attendre l'initialisation Firebase
        async function waitForFirebaseInit() {
            console.log('üöÄ Initialisation SYNERGIA v3.0...');
            
            try {
                await window.firebaseInitPromise;
                
                // Mettre √† jour l'interface
                updateFirebaseStatusDisplay();
                enableButtons();
                setupFirebaseAuth();
                
                console.log('‚úÖ Initialisation Firebase termin√©e');
                initializationComplete = true;
                
                // Mettre √† jour les activit√©s
                updateRecentActivities('Firebase initialis√© avec succ√®s');
                
            } catch (error) {
                console.error('‚ùå Erreur lors de l\'initialisation:', error);
                updateFirebaseStatusDisplay(false);
                showNotification('‚ùå Erreur d\'initialisation Firebase', 'error');
            }
        }

        // Mise √† jour de l'affichage du statut Firebase
        function updateFirebaseStatusDisplay(success = null) {
            if (success === null) {
                success = window.firebaseReady;
            }
            
            isFirebaseReady = success;
            isAnalyticsReady = window.analyticsReady || false;
            
            // Dashboard
            const dashboardStatus = document.getElementById('firebase-status-dashboard');
            const analyticsStatusText = document.getElementById('analytics-status-text');
            const authStatusText = document.getElementById('auth-status-text');
            const syncStatus = document.getElementById('sync-status-display');
            const syncTimeText = document.getElementById('sync-time-text');
            
            if (dashboardStatus) {
                if (success) {
                    dashboardStatus.className = 'sync-status';
                    dashboardStatus.innerHTML = '<div class="sync-indicator"></div><span>Firebase Connect√©</span>';
                } else {
                    dashboardStatus.className = 'sync-status error';
                    dashboardStatus.innerHTML = '<i class="fas fa-exclamation-triangle"></i><span>Firebase Erreur</span>';
                }
            }
            
            if (analyticsStatusText) {
                analyticsStatusText.textContent = isAnalyticsReady ? 'Actif' : 'Indisponible';
                analyticsStatusText.style.color = isAnalyticsReady ? '#28a745' : '#ffc107';
            }
            
            if (authStatusText) {
                authStatusText.textContent = success ? 'Pr√™t' : 'Erreur';
                authStatusText.style.color = success ? '#28a745' : '#dc3545';
            }
            
            if (syncStatus) {
                if (success) {
                    syncStatus.className = 'sync-status';
                    syncStatus.innerHTML = '<div class="sync-indicator"></div><span>Synchronis√©</span>';
                } else {
                    syncStatus.className = 'sync-status error';
                    syncStatus.innerHTML = '<i class="fas fa-exclamation-triangle"></i><span>Hors ligne</span>';
                }
            }
            
            if (syncTimeText) {
                syncTimeText.textContent = success ? 'Connect√©' : 'D√©connect√©';
            }
            
            // Settings - Statut d√©taill√©
            const statusContainer = document.getElementById('firebase-status');
            const statusDetails = document.getElementById('firebase-status-details');
            const fullStatusDisplay = document.getElementById('full-status-display');
            
            if (statusContainer && statusDetails) {
                if (success) {
                    statusContainer.style.background = '#d4edda';
                    statusContainer.style.borderColor = '#28a745';
                    statusContainer.querySelector('strong').style.color = '#155724';
                    statusContainer.querySelector('strong').innerHTML = '<i class="fas fa-check-circle" style="color: #28a745;"></i> Firebase - Op√©rationnel';
                    statusDetails.style.color = '#155724';
                    
                    statusDetails.innerHTML = `
                        <div>‚úÖ <strong>App:</strong> Initialis√©</div>
                        <div>‚úÖ <strong>Auth:</strong> ${currentUser ? `Connect√© (${currentUser.email})` : 'Pr√™t'}</div>
                        <div>‚úÖ <strong>Firestore:</strong> Op√©rationnel</div>
                        <div>‚úÖ <strong>Storage:</strong> Disponible</div>
                        <div>${isAnalyticsReady ? '‚úÖ' : '‚ö†Ô∏è'} <strong>Analytics:</strong> ${isAnalyticsReady ? 'Op√©rationnel' : 'Indisponible'}</div>
                        <div style="margin-top: 0.5rem;"><strong>Projet:</strong> synergia-app-f27e7</div>
                    `;
                } else {
                    statusContainer.style.background = '#f8d7da';
                    statusContainer.style.borderColor = '#dc3545';
                    statusContainer.querySelector('strong').style.color = '#721c24';
                    statusContainer.querySelector('strong').innerHTML = '<i class="fas fa-exclamation-triangle" style="color: #dc3545;"></i> Firebase - Erreur';
                    statusDetails.style.color = '#721c24';
                    
                    statusDetails.innerHTML = `
                        <div>‚ùå <strong>App:</strong> Erreur d'initialisation</div>
                        <div>‚ùå <strong>Auth:</strong> Non disponible</div>
                        <div>‚ùå <strong>Firestore:</strong> Hors ligne</div>
                        <div>‚ùå <strong>Storage:</strong> Indisponible</div>
                        <div>‚ùå <strong>Analytics:</strong> Non configur√©</div>
                        <div style="margin-top: 0.5rem;"><strong>Statut:</strong> Mode d√©mo</div>
                    `;
                }
            }
            
            if (fullStatusDisplay) {
                const status = {
                    firebase: success,
                    analytics: isAnalyticsReady,
                    user: currentUser ? currentUser.email : null,
                    timestamp: new Date().toISOString(),
                    project: 'synergia-app-f27e7'
                };
                fullStatusDisplay.textContent = JSON.stringify(status, null, 2);
            }
        }

        // Activer les boutons apr√®s l'initialisation
        function enableButtons() {
            const buttons = [
                'firebase-details-btn',
                'analytics-btn', 
                'sync-btn',
                'save-settings-btn',
                'test-firebase-btn',
                'init-data-btn',
                'test-analytics-btn'
            ];
            
            buttons.forEach(id => {
                const btn = document.getElementById(id);
                if (btn) {
                    btn.disabled = false;
                    
                    // Mettre √† jour le texte des boutons
                    if (id === 'firebase-details-btn') {
                        btn.innerHTML = '<i class="fas fa-database"></i> D√©tails Firebase';
                    } else if (id === 'analytics-btn') {
                        const span = btn.querySelector('span');
                        if (span) span.textContent = isAnalyticsReady ? 'Voir Analytics' : 'Analytics indisponible';
                    } else if (id === 'sync-btn') {
                        btn.innerHTML = '<i class="fas fa-sync-alt"></i> Synchroniser';
                    }
                }
            });
        }

        // Configuration de l'authentification Firebase
        function setupFirebaseAuth() {
            if (!isFirebaseReady) return;
            
            window.firebase.onAuthStateChanged(window.auth, (user) => {
                if (user) {
                    currentUser = user;
                    console.log(`üë§ Utilisateur connect√©: ${user.email}`);
                    document.getElementById('user-name').textContent = user.displayName || user.email.split('@')[0];
                    updateFirebaseStatusDisplay();
                    updateRecentActivities(`Utilisateur connect√©: ${user.email}`);
                } else {
                    console.log('üë§ Aucun utilisateur connect√©');
                    currentUser = null;
                    updateFirebaseStatusDisplay();
                }
            });
        }

        // Test de connexion Firebase
        function testFirebaseConnection() {
            if (!isFirebaseReady) {
                showNotification('‚ùå Firebase non disponible', 'error');
                return;
            }

            showNotification('üîç Test de connexion Firebase...', 'info');
            
            const testDoc = {
                test: true,
                timestamp: window.firebase.serverTimestamp(),
                message: 'Test connexion SYNERGIA v3.0',
                user: currentUser ? currentUser.email : 'anonyme',
                userAgent: navigator.userAgent.substring(0, 100)
            };
            
            window.firebase.addDoc(
                window.firebase.collection(window.db, 'connection-tests'), 
                testDoc
            ).then((docRef) => {
                showNotification('‚úÖ Test Firebase r√©ussi!', 'success');
                console.log('üìù Document test cr√©√©:', docRef.id);
                updateRecentActivities('Test de connexion Firebase r√©ussi');
                
                // Supprimer le document test apr√®s 10 secondes
                setTimeout(() => {
                    window.firebase.deleteDoc(window.firebase.doc(window.db, 'connection-tests', docRef.id))
                        .then(() => console.log('üßπ Document test supprim√©'))
                        .catch(e => console.log('‚ö†Ô∏è Erreur suppression test:', e));
                }, 10000);
                
            }).catch((error) => {
                showNotification('‚ùå Erreur test Firestore: ' + error.message, 'error');
                console.error('‚ùå Erreur test:', error);
            });
        }

        // Test Analytics
        function testAnalytics() {
            if (isAnalyticsReady && window.analytics) {
                showNotification('üìä Test Analytics...', 'info');
                
                import('https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js')
                    .then(({ logEvent }) => {
                        logEvent(window.analytics, 'synergia_test_analytics', {
                            event_category: 'system_test',
                            event_label: 'manual_analytics_test',
                            value: 1,
                            custom_parameter: 'test_from_settings'
                        });
                        showNotification('‚úÖ √âv√©nement Analytics envoy√©!', 'success');
                        updateRecentActivities('Test Analytics ex√©cut√©');
                        console.log('üìä √âv√©nement Analytics test envoy√©');
                    })
                    .catch(error => {
                        showNotification('‚ùå Erreur Analytics: ' + error.message, 'error');
                    });
            } else {
                showNotification('‚ö†Ô∏è Analytics non disponible', 'warning');
            }
        }

        // Suivre un √©v√©nement personnalis√©
        function trackCustomEvent() {
            if (isAnalyticsReady && window.analytics) {
                import('https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js')
                    .then(({ logEvent }) => {
                        logEvent(window.analytics, 'dashboard_interaction', {
                            event_category: 'user_engagement',
                            event_label: 'analytics_widget_click',
                            user_id: currentUser ? currentUser.uid : 'anonymous',
                            page_title: 'Dashboard'
                        });
                        showNotification('üìä Interaction Analytics enregistr√©e', 'success');
                    })
                    .catch(error => {
                        console.warn('Analytics error:', error);
                        showNotification('üìä Simulation Analytics (service indisponible)', 'info');
                    });
            } else {
                showNotification('üìä Simulation √©v√©nement Analytics', 'info');
            }
        }

        // Initialiser les donn√©es Firebase
        function initializeFirebaseData() {
            if (!isFirebaseReady) {
                showNotification('‚ùå Firebase non disponible', 'error');
                return;
            }
            
            showNotification('üöÄ Initialisation des donn√©es...', 'info');
            
            const collections = ['users', 'teams', 'projects', 'missions', 'events', 'analytics-events'];
            let initialized = 0;
            
            collections.forEach(async (collectionName) => {
                try {
                    const initDoc = {
                        initialized: true,
                        createdAt: window.firebase.serverTimestamp(),
                        version: '3.0',
                        createdBy: currentUser ? currentUser.email : 'system',
                        collectionType: collectionName,
                        metadata: {
                            purpose: `Collection ${collectionName} pour SYNERGIA v3.0`,
                            features: ['sync', 'realtime', 'backup']
                        }
                    };
                    
                    await window.firebase.addDoc(
                        window.firebase.collection(window.db, collectionName),
                        initDoc
                    );
                    
                    initialized++;
                    console.log(`‚úÖ Collection ${collectionName} initialis√©e`);
                    
                    if (initialized === collections.length) {
                        showNotification('‚úÖ Toutes les collections initialis√©es!', 'success');
                        updateRecentActivities(`${collections.length} collections Firebase cr√©√©es`);
                    }
                } catch (error) {
                    console.error(`‚ùå Erreur initialisation ${collectionName}:`, error);
                    showNotification(`‚ùå Erreur ${collectionName}: ${error.message}`, 'error');
                }
            });
        }

        // Forcer la synchronisation
        function forceSyncData() {
            showNotification('üîÑ Synchronisation forc√©e...', 'info');
            
            setTimeout(() => {
                const now = new Date();
                document.getElementById('sync-time-text').textContent = '√Ä l\'instant';
                showNotification('‚úÖ Synchronisation termin√©e!', 'success');
                updateRecentActivities('Synchronisation manuelle ex√©cut√©e');
                
                // Log Analytics si disponible
                if (isAnalyticsReady && window.analytics) {
                    import('https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js')
                        .then(({ logEvent }) => {
                            logEvent(window.analytics, 'force_sync', {
                                event_category: 'user_action',
                                sync_time: now.toISOString()
                            });
                        })
                        .catch(e => console.log('Analytics sync error:', e));
                }
            }, 2000);
        }

        // Sauvegarde des param√®tres
        function saveAllSettings() {
            showNotification('üíæ Sauvegarde des param√®tres...', 'info');
            
            if (isFirebaseReady && currentUser) {
                const settings = {
                    userId: currentUser.uid,
                    userEmail: currentUser.email,
                    systemConfig: {
                        projectId: 'synergia-app-f27e7',
                        analyticsEnabled: isAnalyticsReady,
                        version: '3.0'
                    },
                    userPreferences: {
                        debugMode: isDebugMode,
                        lastSave: new Date().toISOString(),
                        browser: navigator.userAgent.substring(0, 100)
                    },
                    updatedAt: window.firebase.serverTimestamp()
                };
                
                window.firebase.setDoc(
                    window.firebase.doc(window.db, 'user-settings', currentUser.uid),
                    settings
                ).then(() => {
                    showNotification('‚úÖ Param√®tres sauvegard√©s!', 'success');
                    updateRecentActivities('Param√®tres utilisateur sauvegard√©s');
                }).catch((error) => {
                    showNotification('‚ùå Erreur sauvegarde: ' + error.message, 'error');
                });
            } else {
                const localSettings = {
                    saved: true,
                    timestamp: new Date().toISOString(),
                    debugMode: isDebugMode,
                    version: '3.0'
                };
                localStorage.setItem('synergia-settings', JSON.stringify(localSettings));
                showNotification('‚úÖ Sauvegarde locale r√©ussie!', 'success');
            }
        }

        // Export des param√®tres
        function exportSettings() {
            const settings = {
                exportDate: new Date().toISOString(),
                firebaseStatus: {
                    ready: isFirebaseReady,
                    analyticsReady: isAnalyticsReady,
                    userConnected: !!currentUser,
                    userEmail: currentUser ? currentUser.email : null
                },
                configuration: {
                    projectId: 'synergia-app-f27e7',
                    version: '3.0',
                    initializationComplete: initializationComplete
                },
                systemInfo: {
                    userAgent: navigator.userAgent,
                    language: navigator.language,
                    platform: navigator.platform
                }
            };
            
            const blob = new Blob([JSON.stringify(settings, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `synergia_config_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('üì• Configuration export√©e!', 'success');
            updateRecentActivities('Configuration syst√®me export√©e');
        }

        // Mettre √† jour les activit√©s r√©centes
        function updateRecentActivities(activity) {
            const activitiesContainer = document.getElementById('recent-activities');
            if (!activitiesContainer) return;
            
            // Supprimer le loader s'il existe
            const loader = activitiesContainer.querySelector('.loading-spinner');
            if (loader && loader.parentElement) {
                loader.parentElement.remove();
            }
            
            const activityElement = document.createElement('div');
            activityElement.className = 'activity-item';
            activityElement.innerHTML = `
                <i class="fas fa-info-circle" style="color: #667eea;"></i>
                <span>${activity}</span>
                <small style="margin-left: auto; color: #666;">√Ä l'instant</small>
            `;
            
            activitiesContainer.insertBefore(activityElement, activitiesContainer.firstChild);
            
            // Garder seulement les 5 derni√®res activit√©s
            const activities = activitiesContainer.children;
            if (activities.length > 5) {
                activitiesContainer.removeChild(activities[activities.length - 1]);
            }
        }

        // Actualisation du dashboard
        function refreshDashboard() {
            showNotification('üîÑ Actualisation...', 'info');
            
            setTimeout(() => {
                const newTeamCount = Math.floor(Math.random() * 10) + 1;
                const newQuestCount = Math.floor(Math.random() * 15) + 1;
                const newEventCount = Math.floor(Math.random() * 5) + 1;
                
                document.getElementById('team-count').textContent = newTeamCount;
                document.getElementById('active-quests').textContent = newQuestCount;
                document.getElementById('events-today').textContent = newEventCount;
                
                showNotification('‚úÖ Dashboard actualis√©!', 'success');
                updateRecentActivities('Dashboard actualis√©');
                
                if (isAnalyticsReady && window.analytics) {
                    import('https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js')
                        .then(({ logEvent }) => {
                            logEvent(window.analytics, 'dashboard_refresh', {
                                event_category: 'user_action'
                            });
                        })
                        .catch(e => console.log('Analytics refresh error:', e));
                }
            }, 1500);
        }

        // Syst√®me de notifications
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: white;
                padding: 1rem 1.5rem;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                z-index: 3000;
                border-left: 4px solid ${type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : type === 'warning' ? '#ffc107' : '#667eea'};
                animation: slideInRight 0.3s ease;
                max-width: 350px;
            `;
            
            const icons = {
                success: 'check-circle',
                error: 'exclamation-triangle',
                warning: 'exclamation-triangle',
                info: 'info-circle'
            };
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <i class="fas fa-${icons[type]}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Navigation
        function setupNavigation() {
            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('.content-section');

            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    
                    navLinks.forEach(l => l.classList.remove('active'));
                    link.classList.add('active');
                    
                    sections.forEach(section => section.classList.remove('active'));
                    
                    const targetId = link.getAttribute('href').substring(1);
                    const targetSection = document.getElementById(targetId);
                    if (targetSection) {
                        targetSection.classList.add('active');
                        
                        if (isAnalyticsReady && window.analytics) {
                            import('https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js')
                                .then(({ logEvent }) => {
                                    logEvent(window.analytics, 'page_view', {
                                        page_title: targetId,
                                        page_location: window.location.href + '#' + targetId
                                    });
                                })
                                .catch(e => console.log('Analytics nav error:', e));
                        }
                    }
                });
            });
        }

        // Placeholder functions
        function showFirebaseDetails() {
            showNotification('üîß D√©tails Firebase: Console du navigateur (F12)', 'info');
            console.log('=== FIREBASE DETAILS ===');
            console.log('Ready:', isFirebaseReady);
            console.log('Analytics:', isAnalyticsReady);
            console.log('User:', currentUser);
            console.log('App:', window.firebaseApp);
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', async function() {
            setupNavigation();
            
            // Styles d'animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideInRight {
                    from { opacity: 0; transform: translateX(100px); }
                    to { opacity: 1; transform: translateX(0); }
                }
                @keyframes slideOutRight {
                    from { opacity: 1; transform: translateX(0); }
                    to { opacity: 0; transform: translateX(100px); }
                }
            `;
            document.head.appendChild(style);
            
            // Event listeners
            document.getElementById('refresh-dashboard')?.addEventListener('click', refreshDashboard);
            document.getElementById('logout-btn')?.addEventListener('click', () => {
                if (confirm('Voulez-vous vraiment vous d√©connecter ?')) {
                    if (window.firebase && window.auth) {
                        window.firebase.signOut(window.auth);
                    }
                    showNotification('üëã √Ä bient√¥t !', 'info');
                }
            });
            
            // Attendre l'initialisation Firebase
            await waitForFirebaseInit();
            
            console.log('‚úÖ SYNERGIA v3.0 pr√™t !');
        });
    </script>
</body>
</html>
