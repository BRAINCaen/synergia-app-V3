<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SYNERGIA v3.0 - Gestion d'équipe</title>
    
    <!-- Politique de sécurité du contenu mise à jour pour Firebase -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' 'unsafe-inline' 'unsafe-eval' 
            https://www.gstatic.com 
            https://www.googleapis.com 
            https://cdn.jsdelivr.net 
            https://www.googletagmanager.com;
        style-src 'self' 'unsafe-inline' 
            https://cdnjs.cloudflare.com 
            https://fonts.googleapis.com;
        font-src 'self' 
            https://cdnjs.cloudflare.com 
            https://fonts.gstatic.com;
        connect-src 'self' 
            https://www.gstatic.com 
            https://www.googleapis.com 
            https://firebase.googleapis.com
            https://firestore.googleapis.com 
            https://identitytoolkit.googleapis.com
            https://securetoken.googleapis.com
            https://www.google-analytics.com
            https://analytics.google.com
            https://stats.g.doubleclick.net;
        img-src 'self' data: https:;
        frame-src 'self' https:;
    ">
    
    <!-- CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, updateProfile } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, doc, addDoc, updateDoc, deleteDoc, getDocs, getDoc, onSnapshot, setDoc, query, where, orderBy, limit, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getStorage, ref, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js';
        import { getAnalytics } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js';

        // Configuration Firebase - Mise à jour avec vos vraies clés
        const firebaseConfig = {
            apiKey: "AIzaSyD7uBuAQaOhZ02owkZEuMKC5Vji6PrB2f8",
            authDomain: "synergia-app-f27e7.firebaseapp.com",
            projectId: "synergia-app-f27e7",
            storageBucket: "synergia-app-f27e7.appspot.com",
            messagingSenderId: "201912738922",
            appId: "1:201912738922:web:2fcc1e49293bb632899613",
            measurementId: "G-EGJ79SCMWX"
        };

        // Initialisation Firebase
        let app;
        try {
            app = initializeApp(firebaseConfig);
            window.firebaseApp = app;
            window.auth = getAuth(app);
            window.db = getFirestore(app);
            window.storage = getStorage(app);
            
            // Rendre les fonctions Firebase disponibles globalement
            window.firebase = {
                collection, doc, addDoc, updateDoc, deleteDoc, getDocs, getDoc, 
                onSnapshot, setDoc, query, where, orderBy, limit, serverTimestamp,
                onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, 
                signOut, updateProfile, ref, uploadBytes, getDownloadURL
            };
            
            console.log('✅ Firebase initialisé avec succès');
            window.firebaseReady = true;
        } catch (error) {
            console.warn('⚠️ Firebase non configuré, mode démo activé:', error.message);
            window.firebaseReady = false;
        }
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        /* Navigation */
        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 0;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
        }

        .nav-logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }

        .nav-menu {
            display: flex;
            gap: 2rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            text-decoration: none;
            color: #666;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .nav-link:hover,
        .nav-link.active {
            color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .nav-user {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-avatar img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        /* Layout principal */
        .main-content {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .content-section {
            display: none;
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .content-section.active {
            display: block;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f0f0f0;
        }

        .section-header h1 {
            color: #333;
            font-size: 2rem;
        }

        .section-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }

        /* Boutons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 1px solid #dee2e6;
        }

        .btn-secondary:hover {
            background: #e9ecef;
        }

        .btn-icon {
            padding: 0.5rem;
            border: none;
            background: transparent;
            border-radius: 6px;
            cursor: pointer;
            color: #666;
            transition: all 0.3s ease;
        }

        .btn-icon:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }

        /* Dashboard */
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 1.5rem;
            border-radius: 12px;
            color: white;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .stat-card i {
            font-size: 2rem;
            opacity: 0.8;
        }

        .stat-info h3 {
            font-size: 2rem;
            margin-bottom: 0.25rem;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }

        .dashboard-widget {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem 0;
            border-bottom: 1px solid #eee;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        /* Équipe */
        .team-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .team-member-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .team-member-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .team-member-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .member-avatar {
            position: relative;
            width: 60px;
            height: 60px;
            margin-bottom: 1rem;
        }

        .member-avatar img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }

        .status-indicator {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 2px solid white;
        }

        .status-indicator.online { background: #28a745; }
        .status-indicator.away { background: #ffc107; }
        .status-indicator.offline { background: #6c757d; }

        /* Planning */
        .planning-section {
            margin-bottom: 2rem;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 12px;
        }

        .calendar-navigation {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        /* Chat */
        .chat-container {
            display: grid;
            grid-template-columns: 300px 1fr;
            height: 600px;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            overflow: hidden;
        }

        .chat-sidebar {
            background: #f8f9fa;
            border-right: 1px solid #e9ecef;
        }

        .chat-main {
            display: flex;
            flex-direction: column;
        }

        .messages-area {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            background: #fafafa;
        }

        .message-input-container {
            padding: 1rem;
            border-top: 1px solid #e9ecef;
            background: white;
        }

        .message-input {
            display: flex;
            gap: 0.5rem;
        }

        .message-input input {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            outline: none;
        }

        /* Missions */
        .user-progress {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 1.5rem;
            border-radius: 12px;
            color: white;
            margin-bottom: 2rem;
        }

        .level-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .xp-bar {
            flex: 1;
            height: 8px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            overflow: hidden;
        }

        .xp-fill {
            height: 100%;
            background: white;
            border-radius: 4px;
            width: 60%;
            transition: width 0.3s ease;
        }

        .quests-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
        }

        .quest-tab {
            padding: 0.75rem 1.5rem;
            border: none;
            background: #f8f9fa;
            color: #666;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quest-tab.active,
        .quest-tab:hover {
            background: #667eea;
            color: white;
        }

        .quests-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .quest-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .quest-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        /* Modales */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 2rem;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            position: relative;
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .close {
            position: absolute;
            right: 1rem;
            top: 1rem;
            font-size: 1.5rem;
            font-weight: bold;
            color: #aaa;
            cursor: pointer;
        }

        .close:hover {
            color: #333;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #333;
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            font-size: 1rem;
            outline: none;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 3000;
            animation: slideInRight 0.3s ease;
            border-left: 4px solid #667eea;
        }

        .notification.success {
            border-left-color: #28a745;
        }

        .notification.error {
            border-left-color: #dc3545;
        }

        .notification.warning {
            border-left-color: #ffc107;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Mobile-First Responsive Design */
        
        /* Responsive breakpoints */
        @media (max-width: 1024px) {
            .nav-container {
                padding: 0 1rem;
            }
            
            .main-content {
                padding: 0 1rem;
            }
        }

        /* Tablet */
        @media (max-width: 768px) {
            .navbar {
                padding: 0.5rem 0;
            }

            .nav-container {
                flex-direction: column;
                gap: 1rem;
                padding: 0 1rem;
            }

            .nav-logo {
                font-size: 1.25rem;
            }

            .nav-menu {
                display: none; /* Caché par défaut sur mobile */
                flex-direction: column;
                width: 100%;
                background: white;
                border-radius: 8px;
                padding: 1rem;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                z-index: 1000;
            }

            .nav-menu.mobile-open {
                display: flex;
            }

            .nav-link {
                padding: 1rem;
                border-radius: 8px;
                justify-content: flex-start;
                font-size: 1rem;
            }

            .nav-user {
                flex-direction: row;
                justify-content: space-between;
                width: 100%;
            }

            /* Menu hamburger */
            .mobile-menu-toggle {
                display: block;
                background: none;
                border: none;
                font-size: 1.5rem;
                color: #667eea;
                cursor: pointer;
                padding: 0.5rem;
            }

            .main-content {
                padding: 1rem;
                margin-top: 1rem;
            }

            .content-section {
                padding: 1rem;
                border-radius: 12px;
            }

            .section-header {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
                text-align: left;
            }

            .section-header h1 {
                font-size: 1.5rem;
            }

            .section-actions {
                width: 100%;
                flex-wrap: wrap;
                gap: 0.5rem;
            }

            .section-actions input[type="text"] {
                width: 100%;
                margin-bottom: 0.5rem;
            }

            /* Dashboard mobile */
            .dashboard-stats {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .stat-card {
                padding: 1rem;
                flex-direction: row;
            }

            .stat-card i {
                font-size: 1.5rem;
            }

            .stat-info h3 {
                font-size: 1.5rem;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .dashboard-widget {
                padding: 1rem;
            }

            /* Team mobile */
            .team-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .team-member-card {
                padding: 1rem;
            }

            .member-avatar {
                width: 50px;
                height: 50px;
            }

            /* Chat mobile */
            .chat-container {
                grid-template-columns: 1fr;
                height: 70vh;
                margin: 0 -1rem;
                border-radius: 0;
            }

            .chat-sidebar {
                display: none; /* Caché par défaut sur mobile */
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                z-index: 2000;
                background: rgba(0, 0, 0, 0.5);
            }

            .chat-sidebar.mobile-open {
                display: block;
            }

            .chat-sidebar > div:first-child {
                background: white;
                width: 280px;
                height: 100%;
                box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            }

            .chat-main {
                height: 70vh;
            }

            .messages-area {
                padding: 0.5rem;
            }

            /* Analytics mobile */
            .analytics-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .analytics-card {
                padding: 1rem;
            }

            /* Analytics Pro mobile */
            .analytics-pro-container > div:first-child {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 1rem;
            }

            .analytics-pro-container > div:first-child > div {
                padding: 1rem;
            }

            .analytics-pro-container > div:nth-child(2) {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            /* Planning mobile */
            .calendar-header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .calendar-navigation {
                justify-content: center;
            }

            /* Planning grid mobile */
            div[style*="grid-template-columns: 2fr 1fr"] {
                display: block !important;
            }

            div[style*="grid-template-columns: 2fr 1fr"] > div:first-child {
                margin-bottom: 1rem;
            }

            /* Quests mobile */
            .user-progress {
                padding: 1rem;
            }

            .level-info {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .xp-bar {
                width: 100%;
            }

            .quests-tabs {
                flex-wrap: wrap;
                gap: 0.25rem;
            }

            .quest-tab {
                padding: 0.5rem 1rem;
                font-size: 0.9rem;
                flex: 1;
                min-width: 120px;
                text-align: center;
            }

            .quests-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .quest-card {
                padding: 1rem;
            }

            /* Settings mobile */
            .content-section#settings > div:nth-child(3) {
                display: block !important;
                gap: 0 !important;
            }

            .content-section#settings > div:nth-child(3) > div {
                margin-bottom: 1.5rem;
            }

            /* Settings grids mobile */
            .content-section#settings div[style*="grid-template-columns: 1fr 1fr"] {
                display: block !important;
            }

            .content-section#settings div[style*="grid-template-columns: 1fr 1fr"] > div {
                margin-bottom: 1rem;
            }

            /* Settings grid layouts */
            .content-section#settings div[style*="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr))"] {
                grid-template-columns: 1fr !important;
            }

            /* Form controls mobile */
            .form-group {
                margin-bottom: 1rem;
            }

            .form-group input,
            .form-group select,
            .form-group textarea {
                font-size: 16px; /* Prevent zoom on iOS */
            }

            .form-actions {
                flex-direction: column;
                gap: 0.5rem;
            }

            .form-actions .btn {
                width: 100%;
                justify-content: center;
            }

            /* Buttons mobile */
            .btn {
                padding: 0.75rem 1rem;
                font-size: 0.9rem;
                min-height: 44px; /* Touch-friendly */
            }

            .btn-icon {
                min-width: 44px;
                min-height: 44px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            /* Modal mobile */
            .modal-content {
                margin: 0;
                width: 100%;
                height: 100vh;
                max-width: none;
                border-radius: 0;
                overflow-y: auto;
            }

            .modal-content h2 {
                font-size: 1.25rem;
                margin-bottom: 1rem;
            }

            /* Touch-friendly spacing */
            .activity-item {
                padding: 1rem 0;
                min-height: 60px;
            }

            /* Responsive text */
            .stat-info p {
                font-size: 0.9rem;
            }

            /* Hide desktop-only elements */
            .desktop-only {
                display: none !important;
            }
        }

        /* Mobile phones */
        @media (max-width: 480px) {
            .navbar {
                padding: 0.25rem 0;
            }

            .nav-container {
                padding: 0 0.5rem;
            }

            .nav-logo {
                font-size: 1.1rem;
            }

            .nav-logo span {
                display: none; /* Cacher "SYNERGIA v3.0" sur très petit écran */
            }

            .main-content {
                padding: 0.5rem;
                margin-top: 0.5rem;
            }

            .content-section {
                padding: 0.75rem;
                margin-bottom: 1rem;
            }

            .section-header h1 {
                font-size: 1.25rem;
            }

            /* Stats cards très compactes */
            .stat-card {
                padding: 0.75rem;
            }

            .stat-card i {
                font-size: 1.25rem;
            }

            .stat-info h3 {
                font-size: 1.25rem;
            }

            .stat-info p {
                font-size: 0.8rem;
            }

            /* Dashboard widgets compacts */
            .dashboard-widget {
                padding: 0.75rem;
            }

            .dashboard-widget h3 {
                font-size: 1rem;
                margin-bottom: 0.75rem;
            }

            /* Team cards compactes */
            .team-member-card {
                padding: 0.75rem;
            }

            .member-avatar {
                width: 40px;
                height: 40px;
            }

            /* Chat mobile très compact */
            .messages-area {
                padding: 0.25rem;
                font-size: 0.9rem;
            }

            .message-input-container {
                padding: 0.5rem;
            }

            /* Quest cards compactes */
            .quest-card {
                padding: 0.75rem;
            }

            .quest-tab {
                padding: 0.5rem;
                font-size: 0.8rem;
            }

            /* User progress compact */
            .user-progress {
                padding: 0.75rem;
            }

            /* Analytics compact */
            .analytics-pro-container > div:first-child {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }

            .analytics-pro-container > div:first-child > div {
                padding: 0.75rem;
            }

            /* Settings forms compact */
            .form-group {
                margin-bottom: 0.75rem;
            }

            .form-group label {
                font-size: 0.9rem;
                margin-bottom: 0.25rem;
            }

            /* Modal pour mobile très petit */
            .modal-content {
                padding: 1rem;
            }

            /* Buttons plus compacts */
            .btn {
                padding: 0.6rem 0.8rem;
                font-size: 0.85rem;
            }

            /* Responsive utilities */
            .mobile-only {
                display: block !important;
            }

            .mobile-hidden {
                display: none !important;
            }

            /* Touch improvements */
            .btn-icon {
                min-width: 40px;
                min-height: 40px;
            }
        }

        /* Landscape mobile */
        @media (max-width: 768px) and (orientation: landscape) {
            .nav-container {
                flex-direction: row;
                justify-content: space-between;
            }

            .nav-menu {
                display: flex;
                flex-direction: row;
                position: relative;
                background: none;
                box-shadow: none;
                padding: 0;
                gap: 1rem;
            }

            .nav-menu.mobile-open {
                display: flex;
            }

            .mobile-menu-toggle {
                display: none;
            }

            .nav-user {
                flex-direction: row;
                width: auto;
            }

            .chat-container {
                grid-template-columns: 300px 1fr;
                height: 50vh;
            }
        }

        /* Desktop utilities */
        @media (min-width: 769px) {
            .mobile-menu-toggle {
                display: none;
            }

            .mobile-only {
                display: none !important;
            }

            .desktop-only {
                display: block !important;
            }

            .nav-menu {
                display: flex !important;
            }
        }

        /* PWA & Mobile app styles */
        @media (display-mode: standalone) {
            .navbar {
                padding-top: env(safe-area-inset-top, 1rem);
            }

            .main-content {
                padding-bottom: env(safe-area-inset-bottom, 2rem);
            }
        }

        /* High DPI screens */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            .stat-card i,
            .dashboard-widget i {
                -webkit-font-smoothing: antialiased;
            }
        }

        /* Touch and hover states */
        @media (hover: hover) {
            .btn:hover,
            .nav-link:hover,
            .team-member-card:hover {
                /* Hover effects only on devices that support hover */
            }
        }

        @media (hover: none) {
            .btn:active,
            .nav-link:active,
            .team-member-card:active {
                transform: scale(0.98);
                transition: transform 0.1s ease;
            }
        }

        /* Accessibility improvements for mobile */
        @media (max-width: 768px) {
            /* Larger touch targets */
            .activity-item,
            .nav-link,
            .btn,
            .btn-icon {
                min-height: 44px;
                display: flex;
                align-items: center;
            }

            /* Better contrast on small screens */
            .stat-info p,
            .activity-item small {
                color: #555;
            }

            /* Improved readability */
            body {
                font-size: 16px;
                line-height: 1.6;
            }

            /* Prevent horizontal scroll */
            body, html {
                overflow-x: hidden;
            }

            /* Better form accessibility */
            .form-group input:focus,
            .form-group select:focus,
            .form-group textarea:focus {
                outline: 2px solid #667eea;
                outline-offset: 2px;
            }
        }

        /* Animations */
        .animate-fade-in {
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .animate-slide-up {
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Google Calendar styles */
        .google-auth-section {
            text-align: center;
            padding: 2rem;
        }

        .google-connected {
            background: #e8f5e8;
            border: 1px solid #28a745;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .sync-status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: #28a745;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .sync-indicator {
            width: 8px;
            height: 8px;
            background: #28a745;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        /* Analytics Pro styles */
        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
        }

        .analytics-pro-container {
            position: relative;
        }

        .analytics-pro-container h3 {
            color: #333;
            margin-bottom: 1rem;
        }

        .analytics-pro-container h4 {
            color: #333;
            margin-bottom: 0.5rem;
        }

        .analytics-pro-container canvas {
            max-height: 250px;
        }

        /* Pulse animation for real-time indicator */
        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
            100% { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-bolt"></i>
                <span>SYNERGIA v3.0</span>
            </div>
            
            <!-- Menu hamburger pour mobile -->
            <button class="mobile-menu-toggle" id="mobile-menu-toggle">
                <i class="fas fa-bars"></i>
            </button>
            
            <div class="nav-menu" id="nav-menu">
                <a href="#dashboard" class="nav-link active">
                    <i class="fas fa-tachometer-alt"></i>
                    Dashboard
                </a>
                <a href="#team" class="nav-link">
                    <i class="fas fa-users"></i>
                    Équipe
                </a>
                <a href="#planning" class="nav-link">
                    <i class="fas fa-calendar"></i>
                    Planning
                </a>
                <a href="#chat" class="nav-link">
                    <i class="fas fa-comments"></i>
                    Chat
                </a>
                <a href="#quests" class="nav-link">
                    <i class="fas fa-trophy"></i>
                    Missions
                </a>
                <a href="#analytics" class="nav-link desktop-only">
                    <i class="fas fa-chart-bar"></i>
                    Analytics
                </a>
                <a href="#analytics-pro" class="nav-link desktop-only">
                    <i class="fas fa-chart-line"></i>
                    Analytics Pro
                </a>
                <a href="#settings" class="nav-link">
                    <i class="fas fa-cog"></i>
                    Paramètres
                </a>
            </div>
            <div class="nav-user">
                <div class="user-avatar">
                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 40 40'%3E%3Crect width='40' height='40' fill='%23667eea'/%3E%3Ctext x='20' y='25' text-anchor='middle' fill='white' font-family='Arial' font-size='16'%3EA%3C/text%3E%3C/svg%3E" alt="Avatar" id="user-avatar">
                </div>
                <span id="user-name">Allan Boehme</span>
                <button id="logout-btn" class="btn-icon">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Contenu principal -->
    <main class="main-content">
        <!-- Dashboard -->
        <section id="dashboard" class="content-section active animate-fade-in">
            <div class="section-header">
                <h1>Dashboard</h1>
                <div class="section-actions">
                    <button id="refresh-dashboard" class="btn btn-secondary">
                        <i class="fas fa-sync-alt"></i>
                        Actualiser
                    </button>
                </div>
            </div>

            <div class="dashboard-stats">
                <div class="stat-card animate-slide-up">
                    <i class="fas fa-users"></i>
                    <div class="stat-info">
                        <h3 id="team-count">3</h3>
                        <p>Membres d'équipe</p>
                    </div>
                </div>
                <div class="stat-card animate-slide-up">
                    <i class="fas fa-tasks"></i>
                    <div class="stat-info">
                        <h3 id="active-quests">5</h3>
                        <p>Missions actives</p>
                    </div>
                </div>
                <div class="stat-card animate-slide-up">
                    <i class="fas fa-calendar-check"></i>
                    <div class="stat-info">
                        <h3 id="events-today">2</h3>
                        <p>Événements aujourd'hui</p>
                    </div>
                </div>
                <div class="stat-card animate-slide-up">
                    <i class="fas fa-star"></i>
                    <div class="stat-info">
                        <h3 id="user-level">5</h3>
                        <p>Niveau actuel</p>
                    </div>
                </div>
            </div>

            <div class="dashboard-grid">
                <div class="dashboard-widget animate-slide-up">
                    <h3><i class="fas fa-history"></i> Dernières activités</h3>
                    <div id="recent-activities">
                        <div class="activity-item">
                            <i class="fas fa-rocket" style="color: #667eea;"></i>
                            <span>SYNERGIA v3.0 avec Google Calendar activé</span>
                            <small style="margin-left: auto; color: #666;">Maintenant</small>
                        </div>
                        <div class="activity-item">
                            <i class="fab fa-google" style="color: #4285f4;"></i>
                            <span>Synchronisation Google Calendar configurée</span>
                            <small style="margin-left: auto; color: #666;">Il y a 2 minutes</small>
                        </div>
                        <div class="activity-item">
                            <i class="fas fa-users" style="color: #28a745;"></i>
                            <span>Équipe chargée (3 membres)</span>
                            <small style="margin-left: auto; color: #666;">Il y a 5 minutes</small>
                        </div>
                    </div>
                </div>

                <div class="dashboard-widget animate-slide-up">
                    <h3><i class="fas fa-tasks"></i> Missions du jour</h3>
                    <div id="daily-quests-preview">
                        <div class="activity-item">
                            <i class="fas fa-clock" style="color: #ffc107;"></i>
                            <span>Pointer son arrivée</span>
                            <small style="margin-left: auto; color: #667eea; font-weight: bold;">50 XP</small>
                        </div>
                        <div class="activity-item">
                            <i class="fas fa-comments" style="color: #28a745;"></i>
                            <span>Message d'équipe</span>
                            <small style="margin-left: auto; color: #667eea; font-weight: bold;">30 XP</small>
                        </div>
                        <div class="activity-item">
                            <i class="fas fa-star" style="color: #dc3545;"></i>
                            <span>Journée parfaite</span>
                            <small style="margin-left: auto; color: #667eea; font-weight: bold;">100 XP</small>
                        </div>
                    </div>
                </div>

                <div class="dashboard-widget animate-slide-up">
                    <h3><i class="fab fa-google"></i> Google Calendar</h3>
                    <div style="text-align: center; padding: 1rem;">
                        <div id="google-status" class="sync-status" style="margin-bottom: 1rem;">
                            <div class="sync-indicator"></div>
                            <span>Synchronisé avec Google</span>
                        </div>
                        <div style="font-size: 0.9rem; color: #666; margin-bottom: 1rem;">
                            Dernière sync: il y a 5 minutes
                        </div>
                        <button onclick="showGoogleModal()" class="btn btn-primary">
                            <i class="fab fa-google"></i>
                            Gérer la synchronisation
                        </button>
                    </div>
                </div>

                <div class="dashboard-widget animate-slide-up">
                    <h3><i class="fas fa-chart-line"></i> Progression XP</h3>
                    <div style="text-align: center; padding: 2rem;">
                        <div style="font-size: 2rem; color: #667eea; margin-bottom: 0.5rem;">1,250</div>
                        <div style="color: #666;">XP Total</div>
                        <div style="margin-top: 1rem;">
                            <div class="xp-bar" style="background: #e9ecef;">
                                <div class="xp-fill" style="width: 60%; background: #667eea;"></div>
                            </div>
                            <small style="color: #666;">Niveau 5 - 60% vers niveau 6</small>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Paramètres -->
        <section id="settings" class="content-section">
            <div class="section-header">
                <h1><i class="fas fa-cog"></i> Paramètres Système</h1>
                <div class="section-actions">
                    <button id="save-all-settings" class="btn btn-primary">
                        <i class="fas fa-save"></i>
                        Sauvegarder Tout
                    </button>
                    <button id="export-config" class="btn btn-secondary">
                        <i class="fas fa-download"></i>
                        Exporter Config
                    </button>
                    <button id="import-config" class="btn btn-secondary">
                        <i class="fas fa-upload"></i>
                        Importer Config
                    </button>
                </div>
            </div>

            <!-- Statut Firebase -->
            <div id="firebase-status" style="background: #e8f5e8; border: 1px solid #28a745; border-radius: 8px; padding: 1rem; margin-bottom: 2rem;">
                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                    <i class="fas fa-database" style="color: #28a745;"></i>
                    <strong style="color: #155724;">Statut Firebase</strong>
                </div>
                <p style="color: #155724; margin: 0;">
                    <span id="firebase-status-text">✅ Connecté et synchronisé</span>
                    <br><small>Base de données: <span id="firebase-project">synergia-app-f27e7</span></small>
                </p>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                <!-- Gestion des Utilisateurs -->
                <div style="background: white; border: 1px solid #e9ecef; border-radius: 12px; padding: 2rem;">
                    <h3><i class="fas fa-users-cog"></i> Gestion des Utilisateurs</h3>
                    
                    <div class="form-group">
                        <label>Créer un nouvel utilisateur</label>
                        <input type="text" id="new-user-name" placeholder="Nom complet" style="margin-bottom: 0.5rem;">
                        <input type="email" id="new-user-email" placeholder="Email" style="margin-bottom: 0.5rem;">
                        <select id="new-user-role" style="margin-bottom: 0.5rem;">
                            <option value="">Sélectionner un rôle</option>
                            <option value="admin">Administrateur</option>
                            <option value="manager">Manager</option>
                            <option value="developer">Développeur</option>
                            <option value="designer">Designer</option>
                            <option value="employee">Employé</option>
                        </select>
                        <select id="new-user-department" style="margin-bottom: 1rem;">
                            <option value="">Département</option>
                            <option value="direction">Direction</option>
                            <option value="it">Informatique</option>
                            <option value="design">Design</option>
                            <option value="marketing">Marketing</option>
                            <option value="rh">Ressources Humaines</option>
                            <option value="finance">Finance</option>
                        </select>
                        <button onclick="createUser()" class="btn btn-primary" style="width: 100%;">
                            <i class="fas fa-user-plus"></i> Créer l'utilisateur
                        </button>
                    </div>

                    <div style="margin-top: 2rem;">
                        <h4>Utilisateurs existants</h4>
                        <div id="users-list" style="max-height: 300px; overflow-y: auto; margin-top: 1rem;">
                            <!-- Liste générée dynamiquement -->
                        </div>
                    </div>
                </div>

                <!-- Gestion des Rôles -->
                <div style="background: white; border: 1px solid #e9ecef; border-radius: 12px; padding: 2rem;">
                    <h3><i class="fas fa-user-tag"></i> Gestion des Rôles</h3>
                    
                    <div class="form-group">
                        <label>Créer un nouveau rôle</label>
                        <input type="text" id="new-role-name" placeholder="Nom du rôle" style="margin-bottom: 0.5rem;">
                        <textarea id="new-role-description" placeholder="Description du rôle" style="margin-bottom: 0.5rem; height: 80px;"></textarea>
                        <div style="margin-bottom: 1rem;">
                            <label style="font-size: 0.9rem; margin-bottom: 0.5rem; display: block;">Permissions</label>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; font-size: 0.9rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                    <input type="checkbox" name="role-permissions" value="users.read"> Voir utilisateurs
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                    <input type="checkbox" name="role-permissions" value="users.write"> Modifier utilisateurs
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                    <input type="checkbox" name="role-permissions" value="planning.read"> Voir planning
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                    <input type="checkbox" name="role-permissions" value="planning.write"> Modifier planning
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                    <input type="checkbox" name="role-permissions" value="analytics.read"> Voir analytics
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                    <input type="checkbox" name="role-permissions" value="admin.all"> Administration complète
                                </label>
                            </div>
                        </div>
                        <button onclick="createRole()" class="btn btn-primary" style="width: 100%;">
                            <i class="fas fa-plus"></i> Créer le rôle
                        </button>
                    </div>

                    <div style="margin-top: 2rem;">
                        <h4>Rôles existants</h4>
                        <div id="roles-list" style="max-height: 200px; overflow-y: auto; margin-top: 1rem;">
                            <!-- Liste générée dynamiquement -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Gestion des Missions -->
            <div style="background: white; border: 1px solid #e9ecef; border-radius: 12px; padding: 2rem; margin-top: 2rem;">
                <h3><i class="fas fa-tasks"></i> Gestion des Missions & Quêtes</h3>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                    <div>
                        <h4>Créer une nouvelle mission</h4>
                        <div class="form-group">
                            <input type="text" id="new-quest-title" placeholder="Titre de la mission" style="margin-bottom: 0.5rem;">
                            <textarea id="new-quest-description" placeholder="Description de la mission" style="margin-bottom: 0.5rem; height: 80px;"></textarea>
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <select id="new-quest-type">
                                    <option value="daily">Quotidienne</option>
                                    <option value="weekly">Hebdomadaire</option>
                                    <option value="monthly">Mensuelle</option>
                                    <option value="special">Spéciale</option>
                                </select>
                                <input type="number" id="new-quest-xp" placeholder="XP" min="1" max="1000" value="50">
                                <select id="new-quest-difficulty">
                                    <option value="easy">Facile</option>
                                    <option value="medium">Moyen</option>
                                    <option value="hard">Difficile</option>
                                </select>
                            </div>
                            <div style="margin-bottom: 1rem;">
                                <label style="font-size: 0.9rem; margin-bottom: 0.5rem; display: block;">Conditions de validation</label>
                                <select id="new-quest-condition" style="margin-bottom: 0.5rem;">
                                    <option value="manual">Validation manuelle</option>
                                    <option value="checkin">Pointage arrivée</option>
                                    <option value="message">Envoyer un message</option>
                                    <option value="event">Créer un événement</option>
                                    <option value="attendance">Présence complète</option>
                                    <option value="custom">Condition personnalisée</option>
                                </select>
                                <input type="text" id="new-quest-condition-value" placeholder="Valeur condition (optionnel)">
                            </div>
                            <button onclick="createQuest()" class="btn btn-primary" style="width: 100%;">
                                <i class="fas fa-plus"></i> Créer la mission
                            </button>
                        </div>
                    </div>

                    <div>
                        <h4>Missions existantes</h4>
                        <div id="quests-list" style="max-height: 400px; overflow-y: auto;">
                            <!-- Liste générée dynamiquement -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Configuration Firebase -->
            <div style="background: white; border: 1px solid #e9ecef; border-radius: 12px; padding: 2rem; margin-top: 2rem;">
                <h3><i class="fas fa-database"></i> Configuration Firebase</h3>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                    <div>
                        <div class="form-group">
                            <label>API Key</label>
                            <input type="password" id="firebase-api-key" placeholder="Votre Firebase API Key" value="AIzaSyD7uBuAQaOhZ02owkZEuMKC5Vji6PrB2f8">
                        </div>
                        <div class="form-group">
                            <label>Auth Domain</label>
                            <input type="text" id="firebase-auth-domain" placeholder="your-project.firebaseapp.com" value="synergia-app-f27e7.firebaseapp.com">
                        </div>
                        <div class="form-group">
                            <label>Project ID</label>
                            <input type="text" id="firebase-project-id" placeholder="your-project-id" value="synergia-app-f27e7">
                        </div>
                    </div>
                    <div>
                        <div class="form-group">
                            <label>Storage Bucket</label>
                            <input type="text" id="firebase-storage-bucket" placeholder="your-project.appspot.com" value="synergia-app-f27e7.appspot.com">

                        </div>
                        <div class="form-group">
                            <label>Messaging Sender ID</label>
                            <input type="text" id="firebase-messaging-sender-id" placeholder="123456789012" value="201912738922">
                        </div>
                        <div class="form-group">
                            <label>App ID</label>
                            <input type="text" id="firebase-app-id" placeholder="1:123456789012:web:abcdef..." value="1:201912738922:web:2fcc1e49293bb632899613">
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 1.5rem; text-align: center;">
                    <button onclick="updateFirebaseConfig()" class="btn btn-primary">
                        <i class="fas fa-save"></i> Mettre à jour la configuration
                    </button>
                    <button onclick="testFirebaseConnection()" class="btn btn-secondary">
                        <i class="fas fa-plug"></i> Tester la connexion
                    </button>
                </div>
            </div>

            <!-- Synchronisation & Import/Export -->
            <div style="background: white; border: 1px solid #e9ecef; border-radius: 12px; padding: 2rem; margin-top: 2rem;">
                <h3><i class="fas fa-sync-alt"></i> Synchronisation & Données</h3>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                    <div style="text-align: center; padding: 1.5rem; border: 1px solid #e9ecef; border-radius: 8px;">
                        <i class="fas fa-sync-alt" style="font-size: 2rem; color: #667eea; margin-bottom: 1rem;"></i>
                        <h4>Synchroniser tout</h4>
                        <p style="color: #666; font-size: 0.9rem; margin-bottom: 1rem;">Synchronise toutes les données locales vers Firebase</p>
                        <button onclick="syncAllToFirebase()" class="btn btn-primary">
                            <i class="fas fa-cloud-upload-alt"></i> Synchroniser
                        </button>
                    </div>
                    
                    <div style="text-align: center; padding: 1.5rem; border: 1px solid #e9ecef; border-radius: 8px;">
                        <i class="fas fa-download" style="font-size: 2rem; color: #28a745; margin-bottom: 1rem;"></i>
                        <h4>Importer depuis Firebase</h4>
                        <p style="color: #666; font-size: 0.9rem; margin-bottom: 1rem;">Charge toutes les données depuis Firebase</p>
                        <button onclick="importFromFirebase()" class="btn btn-secondary">
                            <i class="fas fa-cloud-download-alt"></i> Importer
                        </button>
                    </div>
                    
```html
                        <div style="text-align: center; padding: 1.5rem; border: 1px solid #e9ecef; border-radius: 8px;">
                        <i class="fas fa-file-export" style="font-size: 2rem; color: #ffc107; margin-bottom: 1rem;"></i>
                        <h4>Exporter la configuration</h4>
                        <p style="color: #666; font-size: 0.9rem; margin-bottom: 1rem;">Sauvegarde complète du système</p>
                        <button onclick="exportFullConfig()" class="btn btn-secondary">
                            <i class="fas fa-file-download"></i> Exporter
                        </button>
                    </div>
                    
                    <div style="text-align: center; padding: 1.5rem; border: 1px solid #e9ecef; border-radius: 8px;">
                        <i class="fas fa-trash-alt" style="font-size: 2rem; color: #dc3545; margin-bottom: 1rem;"></i>
                        <h4>Réinitialiser</h4>
                        <p style="color: #666; font-size: 0.9rem; margin-bottom: 1rem;">Efface toutes les données (irréversible)</p>
                        <button onclick="resetAllData()" class="btn" style="background: #dc3545; color: white;">
                            <i class="fas fa-exclamation-triangle"></i> Réinitialiser
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Analytics Pro -->
        <section id="analytics-pro" class="content-section">
            <div class="section-header">
                <h1><i class="fas fa-chart-line"></i> Analytics Avancées</h1>
                <div class="section-actions">
                    <button id="fullscreen-analytics" class="btn btn-primary">
                        <i class="fas fa-external-link-alt"></i>
                        Ouvrir Analytics Pro
                    </button>
                    <button id="refresh-pro-analytics" class="btn btn-secondary">
                        <i class="fas fa-sync-alt"></i>
                        Actualiser
                    </button>
                    <button id="export-all-reports" class="btn btn-secondary">
                        <i class="fas fa-download"></i>
                        Export Global
                    </button>
                </div>
            </div>

            <div class="analytics-pro-container">
                <!-- KPI Cards Avancés -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1.5rem; border-radius: 12px; position: relative;">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">
                            <i class="fas fa-users"></i>
                        </div>
                        <div style="font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem;" id="pro-active-users">12</div>
                        <div style="font-size: 1rem; opacity: 0.9;">Utilisateurs actifs</div>
                        <div style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; margin-top: 0.5rem;">
                            <i class="fas fa-arrow-up"></i>
                            <span>+23% vs semaine dernière</span>
                        </div>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; padding: 1.5rem; border-radius: 12px;">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div style="font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem;" id="pro-avg-hours">8.4h</div>
                        <div style="font-size: 1rem; opacity: 0.9;">Temps moyen/jour</div>
                        <div style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; margin-top: 0.5rem;">
                            <i class="fas fa-arrow-up"></i>
                            <span>+0.2h vs mois dernier</span>
                        </div>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%); color: white; padding: 1.5rem; border-radius: 12px;">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">
                            <i class="fas fa-trophy"></i>
                        </div>
                        <div style="font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem;" id="pro-missions">147</div>
                        <div style="font-size: 1rem; opacity: 0.9;">Missions complétées</div>
                        <div style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; margin-top: 0.5rem;">
                            <i class="fas fa-arrow-up"></i>
                            <span>+15% ce mois</span>
                        </div>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, #dc3545 0%, #e83e8c 100%); color: white; padding: 1.5rem; border-radius: 12px;">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">
                            <i class="fas fa-percentage"></i>
                        </div>
                        <div style="font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem;" id="pro-productivity">94%</div>
                        <div style="font-size: 1rem; opacity: 0.9;">Taux de productivité</div>
                        <div style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; margin-top: 0.5rem;">
                            <i class="fas fa-arrow-up"></i>
                            <span>+6% amélioration</span>
                        </div>
                    </div>

                    <div style="background: linear-gradient(135deg, #4285f4 0%, #34a853 100%); color: white; padding: 1.5rem; border-radius: 12px;">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">
                            <i class="fab fa-google"></i>
                        </div>
                        <div style="font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem;" id="pro-google-sync">98%</div>
                        <div style="font-size: 1rem; opacity: 0.9;">Sync Google Calendar</div>
                        <div style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; margin-top: 0.5rem;">
                            <i class="fas fa-check-circle"></i>
                            <span>Temps réel actif</span>
                        </div>
                    </div>
                </div>
                
                <!-- Graphiques avancés -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 2rem; margin-bottom: 2rem;">
                    <div style="background: white; border: 1px solid #e9ecef; border-radius: 12px; padding: 1.5rem;">
                        <h4 style="margin-bottom: 1rem; color: #333;">
                            <i class="fas fa-chart-area"></i>
                            Présence Temps Réel
                        </h4>
                        <div style="position: relative; height: 250px;">
                            <canvas id="pro-attendance-chart"></canvas>
                        </div>
                        <div style="text-align: center; margin-top: 1rem;">
                            <button onclick="updateAttendanceChart()" class="btn btn-secondary btn-sm">
                                <i class="fas fa-sync-alt"></i> Actualiser
                            </button>
                        </div>
                    </div>
                    
                    <div style="background: white; border: 1px solid #e9ecef; border-radius: 12px; padding: 1.5rem;">
                        <h4 style="margin-bottom: 1rem; color: #333;">
                            <i class="fas fa-rocket"></i>
                            Productivité par Membre
                        </h4>
                        <div style="position: relative; height: 250px;">
                            <canvas id="pro-productivity-chart"></canvas>
                        </div>
                        <div style="text-align: center; margin-top: 1rem;">
                            <button onclick="updateProductivityChart()" class="btn btn-secondary btn-sm">
                                <i class="fas fa-sync-alt"></i> Actualiser
                            </button>
                        </div>
                    </div>

                    <div style="background: white; border: 1px solid #e9ecef; border-radius: 12px; padding: 1.5rem;">
                        <h4 style="margin-bottom: 1rem; color: #333;">
                            <i class="fab fa-google"></i>
                            Synchronisation Google Calendar
                        </h4>
                        <div style="position: relative; height: 250px;">
                            <canvas id="pro-google-chart"></canvas>
                        </div>
                        <div style="text-align: center; margin-top: 1rem;">
                            <button onclick="updateGoogleChart()" class="btn btn-secondary btn-sm">
                                <i class="fas fa-sync-alt"></i> Actualiser
                            </button>
                        </div>
                    </div>

                    <div style="background: white; border: 1px solid #e9ecef; border-radius: 12px; padding: 1.5rem;">
                        <h4 style="margin-bottom: 1rem; color: #333;">
                            <i class="fas fa-trophy"></i>
                            Missions & XP Temps Réel
                        </h4>
                        <div style="position: relative; height: 250px;">
                            <canvas id="pro-missions-chart"></canvas>
                        </div>
                        <div style="text-align: center; margin-top: 1rem;">
                            <button onclick="updateMissionsChart()" class="btn btn-secondary btn-sm">
                                <i class="fas fa-sync-alt"></i> Actualiser
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Analytics IA & Prédictions -->
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 16px; padding: 2rem; margin-bottom: 2rem;">
                    <h3 style="margin-bottom: 1.5rem;">
                        <i class="fas fa-brain"></i> Analytics IA & Prédictions
                    </h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div style="background: rgba(255, 255, 255, 0.1); padding: 1.5rem; border-radius: 12px;">
                            <h4><i class="fas fa-chart-line"></i> Tendance Productivité</h4>
                            <div style="font-size: 1.5rem; font-weight: bold; margin: 0.5rem 0;">↗️ +12%</div>
                            <p style="opacity: 0.9; font-size: 0.9rem;">Prédiction semaine prochaine basée sur l'IA</p>
                        </div>
                        
                        <div style="background: rgba(255, 255, 255, 0.1); padding: 1.5rem; border-radius: 12px;">
                            <h4><i class="fas fa-users"></i> Engagement Équipe</h4>
                            <div style="font-size: 1.5rem; font-weight: bold; margin: 0.5rem 0;">🔥 96%</div>
                            <p style="opacity: 0.9; font-size: 0.9rem;">Score d'engagement calculé par IA</p>
                        </div>
                        
                        <div style="background: rgba(255, 255, 255, 0.1); padding: 1.5rem; border-radius: 12px;">
                            <h4><i class="fab fa-google"></i> Optimisation Sync</h4>
                            <div style="font-size: 1.5rem; font-weight: bold; margin: 0.5rem 0;">⚡ 99.2%</div>
                            <p style="opacity: 0.9; font-size: 0.9rem;">Efficacité Google Calendar optimisée</p>
                        </div>
                        
                        <div style="background: rgba(255, 255, 255, 0.1); padding: 1.5rem; border-radius: 12px;">
                            <h4><i class="fas fa-exclamation-triangle"></i> Alertes IA</h4>
                            <div style="font-size: 1.5rem; font-weight: bold; margin: 0.5rem 0;">⚠️ 2</div>
                            <p style="opacity: 0.9; font-size: 0.9rem;">Risques détectés automatiquement</p>
                        </div>
                    </div>
                </div>

                <!-- Rapports Avancés -->
                <div style="background: #f8f9fa; border-radius: 12px; padding: 2rem;">
                    <h3 style="margin-bottom: 1.5rem; color: #333;">
                        <i class="fas fa-file-alt"></i> Rapports Avancés
                    </h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                        <div onclick="generateReport('performance')" style="background: white; padding: 1.5rem; border-radius: 8px; text-align: center; cursor: pointer; transition: all 0.3s ease; border: 1px solid #e9ecef;" 
                             onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'"
                             onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                            <i class="fas fa-chart-bar" style="font-size: 2rem; color: #667eea; margin-bottom: 1rem;"></i>
                            <h4 style="margin-bottom: 0.5rem; color: #333;">Rapport Performance</h4>
                            <p style="color: #666; font-size: 0.9rem;">Analyse complète des performances équipe</p>
                        </div>
                        
                        <div onclick="generateReport('google-integration')" style="background: white; padding: 1.5rem; border-radius: 8px; text-align: center; cursor: pointer; transition: all 0.3s ease; border: 1px solid #e9ecef;"
                             onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'"
                             onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                            <i class="fab fa-google" style="font-size: 2rem; color: #4285f4; margin-bottom: 1rem;"></i>
                            <h4 style="margin-bottom: 0.5rem; color: #333;">Rapport Google Calendar</h4>
                            <p style="color: #666; font-size: 0.9rem;">Statistiques détaillées de synchronisation</p>
                        </div>
                        
                        <div onclick="generateReport('missions')" style="background: white; padding: 1.5rem; border-radius: 8px; text-align: center; cursor: pointer; transition: all 0.3s ease; border: 1px solid #e9ecef;"
                             onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'"
                             onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                            <i class="fas fa-trophy" style="font-size: 2rem; color: #ffc107; margin-bottom: 1rem;"></i>
                            <h4 style="margin-bottom: 0.5rem; color: #333;">Rapport Missions</h4>
                            <p style="color: #666; font-size: 0.9rem;">Analyse gamification et récompenses</p>
                        </div>
                        
                        <div onclick="generateReport('predictive')" style="background: white; padding: 1.5rem; border-radius: 8px; text-align: center; cursor: pointer; transition: all 0.3s ease; border: 1px solid #e9ecef;"
                             onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'"
                             onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                            <i class="fas fa-brain" style="font-size: 2rem; color: #28a745; margin-bottom: 1rem;"></i>
                            <h4 style="margin-bottom: 0.5rem; color: #333;">Analyse Prédictive</h4>
                            <p style="color: #666; font-size: 0.9rem;">Prédictions IA et recommandations</p>
                        </div>
                    </div>
                </div>

                <!-- Temps réel indicator -->
                <div style="text-align: center; margin: 2rem 0;">
                    <div style="display: inline-flex; align-items: center; gap: 0.5rem; background: #28a745; color: white; padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.9rem;">
                        <div style="width: 8px; height: 8px; background: #28a745; border-radius: 50%; animation: pulse 2s infinite;"></div>
                        Données mises à jour en temps réel • Google Calendar intégré
                    </div>
                </div>
                
                <!-- Actions finales -->
                <div style="text-align: center;">
                    <button onclick="openFullAnalytics()" class="btn btn-primary" style="margin-right: 1rem;">
                        <i class="fas fa-external-link-alt"></i>
                        Analytics Pro Complet
                    </button>
                    <button onclick="refreshAllAnalytics()" class="btn btn-secondary" style="margin-right: 1rem;">
                        <i class="fas fa-sync-alt"></i>
                        Actualiser Tout
                    </button>
                    <button onclick="exportAllData()" class="btn btn-secondary">
                        <i class="fas fa-download"></i>
                        Export Complet
                    </button>
                </div>
            </div>
        </section>

        <!-- Équipe -->
        <section id="team" class="content-section">
            <div class="section-header">
                <h1><i class="fas fa-users"></i> Gestion d'équipe</h1>
                <div class="section-actions">
                    <input type="text" id="team-search" placeholder="Rechercher..." style="padding: 0.75rem; border: 1px solid #dee2e6; border-radius: 8px; width: 100%; max-width: 300px;">
                    <button id="add-member-btn" class="btn btn-primary">
                        <i class="fas fa-user-plus"></i>
                        <span class="desktop-only">Ajouter</span>
                    </button>
                    <button id="export-team-btn" class="btn btn-secondary">
                        <i class="fas fa-download"></i>
                        <span class="desktop-only">Exporter</span>
                    </button>
                </div>
            </div>

            <div class="team-container">
                <div id="team-members-list" class="team-grid">
                    <!-- Membres générés dynamiquement -->
                </div>
            </div>
        </section>

        <!-- Planning -->
        <section id="planning" class="content-section">
            <div class="section-header">
                <h1><i class="fas fa-calendar"></i> Planning</h1>
                <div class="section-actions">
                    <button id="add-event-btn" class="btn btn-primary">
                        <i class="fas fa-plus"></i>
                        <span class="desktop-only">Nouvel événement</span>
                        <span class="mobile-only">Nouveau</span>
                    </button>
                    <button id="google-sync-btn" class="btn btn-secondary">
                        <i class="fab fa-google"></i>
                        <span class="desktop-only">Sync Google</span>
                    </button>
                    <button id="export-schedule-btn" class="btn btn-secondary desktop-only">
                        <i class="fas fa-download"></i>
                        Exporter
                    </button>
                </div>
            </div>

            <div class="calendar-header">
                <h3><i class="fas fa-calendar-alt"></i> Planning Équipe</h3>
                <div class="calendar-navigation">
                    <button id="prev-month" class="btn-icon">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <h4 id="current-month">Juin 2025</h4>
                    <button id="next-month" class="btn-icon">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>

            <div style="display: block;">
                <!-- Calendrier principal -->
                <div style="margin-bottom: 1.5rem;">
                    <div id="calendar" style="background: white; border-radius: 12px; padding: 1.5rem; min-height: 300px; border: 1px solid #e9ecef;">
                        <div style="text-align: center; color: #666; padding: 2rem;">
                            <i class="fas fa-calendar-alt" style="font-size: 2.5rem; margin-bottom: 1rem; color: #ccc;"></i>
                            <h3>Calendrier interactif</h3>
                            <p>Vue Juin 2025</p>
                            <div style="margin-top: 1rem;">
                                <div class="sync-status">
                                    <div class="sync-indicator"></div>
                                    <span>Synchronisé avec Google Calendar</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Événements à venir -->
                <div>
                    <h3><i class="fas fa-list"></i> Événements à venir</h3>
                    <div id="events-container" style="background: white; border-radius: 12px; padding: 1.5rem; border: 1px solid #e9ecef;">
                        <div class="activity-item">
                            <i class="fas fa-users" style="color: #667eea;"></i>
                            <div style="flex: 1;">
                                <strong>Réunion équipe</strong>
                                <br><small style="color: #666;">Point hebdomadaire</small>
                                <br><small style="color: #28a745; font-weight: bold;">Aujourd'hui 10:00</small>
                                <br><small style="color: #4285f4;"><i class="fab fa-google"></i> Depuis Google Calendar</small>
                            </div>
                        </div>
                        
                        <div class="activity-item">
                            <i class="fas fa-graduation-cap" style="color: #28a745;"></i>
                            <div style="flex: 1;">
                                <strong>Formation SYNERGIA</strong>
                                <br><small style="color: #666;">Nouvelles fonctionnalités</small>
                                <br><small style="color: #666;">Vendredi 14:00</small>
                            </div>
                        </div>
                        
                        <div class="activity-item">
                            <i class="fas fa-birthday-cake" style="color: #e83e8c;"></i>
                            <div style="flex: 1;">
                                <strong>Anniversaire Marie</strong>
                                <br><small style="color: #666;">Célébration d'équipe</small>
                                <br><small style="color: #666;">Lundi 12:00</small>
                            </div>
                        </div>
                    </div>
                    
                    <button onclick="showAllEvents()" style="width: 100%; margin-top: 1rem;" class="btn btn-secondary">
                        <i class="fas fa-eye"></i>
                        Voir tous les événements
                    </button>
                </div>
            </div>
        </section>

        <!-- Chat -->
        <section id="chat" class="content-section">
            <div class="section-header">
                <h1><i class="fas fa-comments"></i> Chat d'équipe</h1>
                <div class="section-actions">
                    <select style="padding: 0.5rem; border: 1px solid #dee2e6; border-radius: 6px;">
                        <option>En ligne</option>
                        <option>Absent</option>
                        <option>Occupé</option>
                    </select>
                    <button class="btn btn-secondary">
                        <i class="fas fa-cog"></i>
                        Paramètres
                    </button>
                </div>
            </div>

            <div class="chat-container">
                <!-- Sidebar avec bouton mobile -->
                <div class="chat-sidebar" id="chat-sidebar">
                    <div style="padding: 1rem; border-bottom: 1px solid #e9ecef; display: flex; justify-content: space-between; align-items: center;">
                        <h3>Conversations</h3>
                        <button class="btn-icon mobile-only" onclick="toggleChatSidebar()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div style="padding: 1rem;">
                        <div class="activity-item" style="cursor: pointer; padding: 0.5rem; border-radius: 8px;">
                            <i class="fas fa-users" style="color: #667eea;"></i>
                            <div style="flex: 1;">
                                <strong>Équipe Générale</strong>
                                <br><small style="color: #666;">Bonne journée à tous!</small>
                            </div>
                            <small style="color: #28a745;">●</small>
                        </div>
                    </div>
                </div>

                <div class="chat-main">
                    <div style="padding: 1rem; border-bottom: 1px solid #e9ecef; background: white; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <button class="btn-icon mobile-only" onclick="toggleChatSidebar()" style="margin-right: 0.5rem;">
                                <i class="fas fa-bars"></i>
                            </button>
                            <span>
                                <h3 style="display: inline;">Équipe Générale</h3>
                                <br><span style="color: #28a745; font-size: 0.9rem;">
                                    <i class="fas fa-circle"></i> 3 membres en ligne
                                </span>
                            </span>
                        </div>
                        <div class="desktop-only">
                            <button class="btn-icon" title="Appel vidéo">
                                <i class="fas fa-video"></i>
                            </button>
                            <button class="btn-icon" title="Appel audio">
                                <i class="fas fa-phone"></i>
                            </button>
                        </div>
                    </div>

                    <div class="messages-area">
                        <div style="text-align: center; padding: 1rem; color: #666; border-bottom: 1px solid #eee;">
                            <small>Conversation démarrée le 15 décembre 2024</small>
                        </div>
                        
                        <div style="display: flex; gap: 1rem; padding: 1rem;">
                            <img src="https://via.placeholder.com/40" alt="Allan" style="width: 40px; height: 40px; border-radius: 50%;">
                            <div>
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                                    <strong>Allan Boehme</strong>
                                    <small style="color: #666;">10:30</small>
                                </div>
                                <div style="background: #f8f9fa; padding: 0.75rem; border-radius: 12px;">
                                    Bonne journée ! Google Calendar intégré avec succès 🎉
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="message-input-container">
                        <div class="message-input">
                            <button class="btn-icon"><i class="fas fa-smile"></i></button>
                            <input type="text" id="message-input" placeholder="Tapez votre message...">
                            <button id="send-message-btn" style="padding: 0.75rem 1rem; background: #667eea; color: white; border: none; border-radius: 8px;">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Missions -->
        <section id="quests" class="content-section">
            <div class="section-header">
                <h1><i class="fas fa-trophy"></i> Missions & Récompenses</h1>
                <div class="section-actions">
                    <select style="padding: 0.5rem; border: 1px solid #dee2e6; border-radius: 6px;">
                        <option>Toutes les missions</option>
                        <option>Disponibles</option>
                        <option>En cours</option>
                        <option>Terminées</option>
                    </select>
                    <button class="btn btn-secondary">
                        <i class="fas fa-history"></i>
                        Historique
                    </button>
                </div>
            </div>

            <div class="user-progress">
                <div class="level-info">
                    <div style="text-align: center; margin-right: 1rem;">
                        <div style="font-size: 2rem; margin-bottom: 0.25rem;">⭐</div>
                        <span>Niveau 5</span>
                    </div>
                    <div class="xp-bar">
                        <div class="xp-fill" style="width: 60%;"></div>
                    </div>
                    <div style="text-align: center; margin-left: 1rem;">
                        <span>1,250 XP</span>
                        <div style="font-size: 0.8rem; opacity: 0.8;">750 XP vers niveau 6</div>
                    </div>
                </div>
            </div>

            <div class="quests-tabs">
                <button class="quest-tab active">
                    <i class="fas fa-sun"></i> Quotidiennes
                </button>
                <button class="quest-tab">
                    <i class="fas fa-calendar-week"></i> Hebdomadaires
                </button>
                <button class="quest-tab">
                    <i class="fas fa-star"></i> Spéciales
                </button>
            </div>

            <div class="quests-grid">
                <div class="quest-card animate-slide-up">
                    <div style="font-size: 2rem; margin-bottom: 1rem;">⏰</div>
                    <h3>Pointer son arrivée</h3>
                    <p style="color: #666; margin-bottom: 1rem;">Pointer votre arrivée avant 9h30</p>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <span style="background: #667eea; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.85rem;">50 XP</span>
                        <span style="background: #f8f9fa; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.85rem;">Quotidienne</span>
                    </div>
                    <button onclick="acceptQuest('daily_checkin')" class="btn btn-primary" style="width: 100%;">
                        Accepter
                    </button>
                </div>

                <div class="quest-card animate-slide-up">
                    <div style="font-size: 2rem; margin-bottom: 1rem;">💬</div>
                    <h3>Message d'équipe</h3>
                    <p style="color: #666; margin-bottom: 1rem;">Envoyer un message dans le chat</p>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <span style="background: #667eea; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.85rem;">30 XP</span>
                        <span style="background: #f8f9fa; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.85rem;">Quotidienne</span>
                    </div>
                    <button onclick="acceptQuest('daily_message')" class="btn btn-primary" style="width: 100%;">
                        Accepter
                    </button>
                </div>

                <div class="quest-card animate-slide-up">
                    <div style="font-size: 2rem; margin-bottom: 1rem;">📅</div>
                    <h3>Synchronisation Google</h3>
                    <p style="color: #666; margin-bottom: 1rem;">Créer un événement et le synchroniser</p>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <span style="background: #667eea; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.85rem;">75 XP</span>
                        <span style="background: #4285f4; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.85rem;">Google</span>
                    </div>
                    <button onclick="acceptQuest('google_sync')" class="btn btn-primary" style="width: 100%;">
                        Accepter
                    </button>
                </div>
            </div>
        </section>

        <!-- Analytics -->
        <section id="analytics" class="content-section">
            <div class="section-header">
                <h1><i class="fas fa-chart-bar"></i> Analytics</h1>
                <div class="section-actions">
                    <select style="padding: 0.5rem; border: 1px solid #dee2e6; border-radius: 6px;">
                        <option>Cette semaine</option>
                        <option>Ce mois</option>
                    </select>
                    <button class="btn btn-secondary">
                        <i class="fas fa-sync-alt"></i>
                        Actualiser
                    </button>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
                <div style="background: white; border: 1px solid #e9ecef; border-radius: 12px; padding: 1.5rem;">
                    <h3><i class="fas fa-users"></i> Activité équipe</h3>
                    <div style="text-align: center; padding: 2rem;">
                        <canvas id="team-chart" width="300" height="200"></canvas>
                    </div>
                </div>

                <div style="background: white; border: 1px solid #e9ecef; border-radius: 12px; padding: 1.5rem;">
                    <h3><i class="fab fa-google"></i> Synchronisation Google</h3>
                    <div style="padding: 1rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                            <span>Événements synchronisés</span>
                            <strong style="color: #28a745;">12</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                            <span>Dernière synchronisation</span>
                            <strong>Il y a 5 min</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                            <span>Statut</span>
                            <span style="color: #28a745;"><i class="fas fa-check-circle"></i> Actif</span>
                        </div>
                        <button onclick="showGoogleModal()" class="btn btn-primary" style="width: 100%;">
                            <i class="fab fa-google"></i>
                            Gérer la sync
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Modal Google Calendar -->
    <div id="google-calendar-modal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <span class="close" onclick="closeGoogleModal()">&times;</span>
            <h2><i class="fab fa-google"></i> Intégration Google Calendar</h2>
            
            <div id="google-auth-section">
                <div class="google-auth-section">
                    <div style="font-size: 3rem; margin-bottom: 1rem; color: #4285f4;">
                        <i class="fab fa-google"></i>
                    </div>
                    <h3>Connecter votre Google Calendar</h3>
                    <p style="color: #666; margin-bottom: 2rem;">
                        Synchronisez automatiquement vos événements SYNERGIA avec Google Calendar
                    </p>
                    
                    <button id="google-signin-btn" class="btn btn-primary" style="background: #4285f4; border: none; padding: 1rem 2rem;">
                        <i class="fab fa-google"></i>
                        Se connecter avec Google
                    </button>
                    
                    <div style="margin-top: 2rem; padding: 1rem; background: #f8f9fa; border-radius: 8px; text-align: left;">
                        <h4><i class="fas fa-info-circle"></i> Fonctionnalités :</h4>
                        <ul style="color: #666; margin-top: 1rem;">
                            <li>✅ Synchronisation bidirectionnelle</li>
                            <li>✅ Import automatique des RDV Google</li>
                            <li>✅ Export des événements SYNERGIA</li>
                            <li>✅ Notifications synchronisées</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div id="google-sync-settings" style="display: none;">
                <div class="google-connected">
                    <div style="display: flex; align-items: center; gap: 0.5rem; color: #155724; margin-bottom: 0.5rem;">
                        <i class="fas fa-check-circle"></i>
                        <strong>Connecté à Google Calendar</strong>
                    </div>
                    <p style="color: #155724; margin: 0; font-size: 0.9rem;">
                        Compte : <span id="google-user-email">demo@gmail.com</span>
                    </p>
                </div>

                <div class="form-group">
                    <label><i class="fas fa-calendar-alt"></i> Calendrier principal</label>
                    <select id="google-calendar-select" style="width: 100%; padding: 0.75rem; border: 1px solid #dee2e6; border-radius: 8px;">
                        <option value="primary">Principal</option>
                        <option value="work">Travail</option>
                        <option value="personal">Personnel</option>
                    </select>
                </div>

                <div class="form-group">
                    <label><i class="fas fa-sync-alt"></i> Mode de synchronisation</label>
                    <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="radio" name="sync-mode" value="bidirectional" checked> 
                            Bidirectionnelle (SYNERGIA ⟷ Google)
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="radio" name="sync-mode" value="export-only"> 
                            Export uniquement (SYNERGIA → Google)
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="radio" name="sync-mode" value="import-only"> 
                            Import uniquement (Google → SYNERGIA)
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label><i class="fas fa-clock"></i> Fréquence de synchronisation</label>
                    <select style="width: 100%; padding: 0.75rem; border: 1px solid #dee2e6; border-radius: 8px;">
                        <option value="realtime">Temps réel</option>
                        <option value="15min">Toutes les 15 minutes</option>
                        <option value="1hour" selected>Toutes les heures</option>
                        <option value="daily">Quotidienne</option>
                    </select>
                </div>

                <div class="form-actions">
                    <button onclick="disconnectGoogle()" class="btn btn-secondary">
                        <i class="fas fa-unlink"></i> Déconnecter
                    </button>
                    <button onclick="testGoogleSync()" class="btn btn-secondary">
                        <i class="fas fa-test-tube"></i> Test
                    </button>
                    <button onclick="saveGoogleSettings()" class="btn btn-primary">
                        <i class="fas fa-save"></i> Sauvegarder
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Ajout Événement -->
    <div id="add-event-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEventModal()">&times;</span>
            <h2><i class="fas fa-calendar-plus"></i> Nouvel événement</h2>
            <form id="add-event-form">
                <div class="form-group">
                    <label><i class="fas fa-heading"></i> Titre</label>
                    <input type="text" id="event-title" required placeholder="Ex: Réunion équipe">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-align-left"></i> Description</label>
                    <textarea id="event-description" placeholder="Description de l'événement..."></textarea>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label><i class="fas fa-calendar"></i> Date</label>
                        <input type="date" id="event-date" required>
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-clock"></i> Heure</label>
                        <input type="time" id="event-time" required>
                    </div>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-tag"></i> Type</label>
                    <select id="event-type" required>
                        <option value="">Sélectionner un type</option>
                        <option value="meeting">🏢 Réunion</option>
                        <option value="training">🎓 Formation</option>
                        <option value="event">🎉 Événement</option>
                        <option value="social">☕ Social</option>
                    </select>
                </div>
                <div class="form-group">
                    <label><i class="fab fa-google"></i> Options Google Calendar</label>
                    <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="checkbox" id="sync-to-google" checked> Synchroniser vers Google Calendar
                        </label>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" onclick="closeEventModal()" class="btn btn-secondary">
                        Annuler
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-calendar-plus"></i> Créer l'événement
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast container -->
    <div id="toast-container" style="position: fixed; top: 20px; right: 20px; z-index: 3000;"></div>

    <script>
        // Variables globales
        let currentUser = null;
        let isGoogleConnected = false;
        let events = [];
        let users = [];
        let roles = [];
        let quests = [];

        // Firebase Manager
        class FirebaseManager {
            constructor() {
                this.isReady = false;
                this.isDemo = false;
                this.init();
            }

            async init() {
                // Attendre que Firebase soit prêt
                await this.waitForFirebase();
                
                if (window.firebaseReady) {
                    console.log('🔥 Firebase Manager initialisé');
                    this.isReady = true;
                    this.setupAuth();
                    this.setupRealtimeListeners();
                } else {
                    console.log('🎭 Mode démo - Firebase non configuré');
                    this.isDemo = true;
                    this.loadDemoData();
                }
            }

            async waitForFirebase() {
                return new Promise((resolve) => {
                    if (window.firebaseReady !== undefined) {
                        resolve();
                    } else {
                        setTimeout(() => this.waitForFirebase().then(resolve), 100);
                    }
                });
            }

            setupAuth() {
                if (!this.isReady) {
                    // Mode démo automatique si Firebase non configuré
                    console.log('🎭 Mode démo automatique - Firebase non configuré');
                    this.isDemo = true;
                    this.loadDemoData();
                    return;
                }
                
                window.firebase.onAuthStateChanged(window.auth, (user) => {
                    if (user) {
                        currentUser = user;
                        console.log(`👤 Utilisateur connecté: ${user.email}`);
                        this.loadUserData();
                    } else {
                        console.log('👤 Aucun utilisateur connecté - Mode démo automatique');
                        this.isDemo = true;
                        this.loadDemoData();
                    }
                });
            }

            setupRealtimeListeners() {
                if (!this.isReady || !currentUser) return;

                // Écouter les changements en temps réel
                const userCompanyId = currentUser.uid;

                // Écouter les utilisateurs
                const usersRef = window.firebase.collection(window.db, 'companies', userCompanyId, 'users');
                window.firebase.onSnapshot(usersRef, (snapshot) => {
                    users = [];
                    snapshot.forEach(doc => {
                        users.push({ id: doc.id, ...doc.data() });
                    });
                    this.updateUsersDisplay();
                });

                // Écouter les missions
                const questsRef = window.firebase.collection(window.db, 'companies', userCompanyId, 'quests');
                window.firebase.onSnapshot(questsRef, (snapshot) => {
                    quests = [];
                    snapshot.forEach(doc => {
                        quests.push({ id: doc.id, ...doc.data() });
                    });
                    this.updateQuestsDisplay();
                });

                // Écouter les événements
                const eventsRef = window.firebase.collection(window.db, 'companies', userCompanyId, 'events');
                window.firebase.onSnapshot(eventsRef, (snapshot) => {
                    events = [];
                    snapshot.forEach(doc => {
                        events.push({ id: doc.id, ...doc.data() });
                    });
                    this.updateEventsDisplay();
                });
            }

            showLoginModal() {
                // Créer une modal de connexion simple
                const modal = document.createElement('div');
                modal.className = 'modal';
                modal.style.display = 'flex';
                modal.innerHTML = `
                    <div class="modal-content">
                        <h2><i class="fas fa-sign-in-alt"></i> Connexion à SYNERGIA</h2>
                        <form id="login-form">
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" id="login-email" required placeholder="votre@email.com">
                            </div>
                            <div class="form-group">
                                <label>Mot de passe</label>
                                <input type="password" id="login-password" required placeholder="Mot de passe">
                            </div>
                            <div class="form-actions">
                                <button type="button" onclick="firebaseManager.loginDemo()" class="btn btn-secondary">
                                    <i class="fas fa-play"></i> Mode Démo
                                </button>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-sign-in-alt"></i> Se connecter
                                </button>
                            </div>
                        </form>
                        <div style="text-align: center; margin-top: 1rem;">
                            <small style="color: #666;">
                                Pas de compte ? <a href="#" onclick="firebaseManager.showRegisterForm()" style="color: #667eea;">Créer un compte</a>
                            </small>
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);

                // Gérer la soumission du formulaire
                document.getElementById('login-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleLogin();
                });
            }

            async handleLogin() {
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;

                if (!email || !password) {
                    showToast('Veuillez remplir tous les champs', 'error');
                    return;
                }

                try {
                    if (this.isReady && window.firebase && window.firebase.signInWithEmailAndPassword) {
                        // Connexion Firebase réelle
                        const userCredential = await window.firebase.signInWithEmailAndPassword(window.auth, email, password);
                        currentUser = userCredential.user;
                        showToast('Connexion réussie!', 'success');
                    } else {
                        // Mode démo si Firebase non disponible
                        console.log('🎭 Firebase non disponible, connexion en mode démo');
                        this.loginDemo();
                    }
                    
                    // Fermer la modal
                    const modal = document.querySelector('.modal');
                    if (modal) modal.remove();
                    
                } catch (error) {
                    console.error('Erreur de connexion:', error);
                    
                    // En cas d'erreur, proposer le mode démo
                    if (error.code === 'auth/api-key-not-valid' || error.code === 'auth/invalid-api-key') {
                        showToast('Clés Firebase invalides - Passage en mode démo', 'warning');
                        this.loginDemo();
                        const modal = document.querySelector('.modal');
                        if (modal) modal.remove();
                    } else {
                        showToast('Erreur de connexion: ' + (error.message || 'Erreur inconnue'), 'error');
                    }
                }
            }

            loginDemo() {
                console.log('🎭 Connexion en mode démo');
                currentUser = {
                    uid: 'demo-user',
                    email: 'demo@synergia.com',
                    displayName: 'Allan Boehme (Démo)'
                };
                
                // Fermer la modal si elle existe
                const modal = document.querySelector('.modal');
                if (modal) modal.remove();
                
                this.loadDemoData();
                showToast('Mode démo activé - Toutes les fonctionnalités sont disponibles', 'success');
                
                // Mettre à jour l'interface utilisateur
                document.getElementById('user-name').textContent = currentUser.displayName;
            }

            showRegisterForm() {
                showToast('Inscription: Fonctionnalité à venir', 'info');
            }

            async loadUserData() {
                if (!this.isReady || !currentUser) return;

                try {
                    const userCompanyId = currentUser.uid;
                    
                    // Charger les données de l'entreprise
                    const companyDoc = await window.firebase.getDoc(
                        window.firebase.doc(window.db, 'companies', userCompanyId)
                    );
                    
                    if (!companyDoc.exists()) {
                        // Première connexion, créer la structure
                        await this.initializeCompany();
                    }
                    
                    showToast('Données chargées depuis Firebase', 'success');
                } catch (error) {
                    console.error('Erreur chargement données:', error);
                    showToast('Erreur de chargement, passage en mode démo', 'warning');
                    this.isDemo = true;
                    this.loadDemoData();
                }
            }

            async initializeCompany() {
                if (!this.isReady || !currentUser) return;

                const userCompanyId = currentUser.uid;
                const companyData = {
                    name: 'Mon Entreprise',
                    createdAt: window.firebase.serverTimestamp(),
                    owner: currentUser.uid,
                    settings: {
                        timezone: 'Europe/Paris',
                        workingHours: { start: '09:00', end: '17:00' },
                        googleCalendarEnabled: false
                    }
                };

                await window.firebase.setDoc(
                    window.firebase.doc(window.db, 'companies', userCompanyId),
                    companyData
                );

                // Créer les collections par défaut
                await this.createDefaultRoles();
                await this.createDefaultQuests();
                
                console.log('✅ Entreprise initialisée dans Firebase');
            }

            async createDefaultRoles() {
                const userCompanyId = currentUser.uid;
                const defaultRoles = [
                    {
                        name: 'Administrateur',
                        description: 'Accès complet au système',
                        permissions: ['admin.all'],
                        createdAt: window.firebase.serverTimestamp()
                    },
                    {
                        name: 'Manager',
                        description: 'Gestion d\'équipe et planning',
                        permissions: ['users.read', 'users.write', 'planning.read', 'planning.write'],
                        createdAt: window.firebase.serverTimestamp()
                    },
                    {
                        name: 'Employé',
                        description: 'Accès de base',
                        permissions: ['users.read', 'planning.read'],
                        createdAt: window.firebase.serverTimestamp()
                    }
                ];

                for (const role of defaultRoles) {
                    await window.firebase.addDoc(
                        window.firebase.collection(window.db, 'companies', userCompanyId, 'roles'),
                        role
                    );
                }
            }

            async createDefaultQuests() {
                const userCompanyId = currentUser.uid;
                const defaultQuests = [
                    {
                        title: 'Pointer son arrivée',
                        description: 'Pointer votre arrivée avant 9h30',
                        type: 'daily',
                        xp: 50,
                        difficulty: 'easy',
                        condition: 'checkin',
                        icon: '⏰',
                        active: true,
                        createdAt: window.firebase.serverTimestamp()
                    },
                    {
                        title: 'Message d\'équipe',
                        description: 'Envoyer un message dans le chat d\'équipe',
                        type: 'daily',
                        xp: 30,
                        difficulty: 'easy',
                        condition: 'message',
                        icon: '💬',
                        active: true,
                        createdAt: window.firebase.serverTimestamp()
                    },
                    {
                        title: 'Synchronisation Google',
                        description: 'Créer un événement et le synchroniser',
                        type: 'weekly',
                        xp: 75,
                        difficulty: 'medium',
                        condition: 'event',
                        icon: '📅',
                        active: true,
                        createdAt: window.firebase.serverTimestamp()
                    }
                ];

                for (const quest of defaultQuests) {
                    await window.firebase.addDoc(
                        window.firebase.collection(window.db, 'companies', userCompanyId, 'quests'),
                        quest
                    );
                }
            }

            loadDemoData() {
                // Données de démonstration
                users = [
                    {
                        id: 'demo1',
                        name: 'Allan Boehme',
                        email: 'alan.boehme61@gmail.com',
                        role: 'admin',
                        department: 'direction',
                        level: 5,
                        xp: 1250,
                        status: 'online',
                        avatar: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='60' height='60' viewBox='0 0 60 60'%3E%3Crect width='60' height='60' fill='%23667eea'/%3E%3Ctext x='30' y='35' text-anchor='middle' fill='white' font-family='Arial' font-size='24'%3EA%3C/text%3E%3C/svg%3E",
                        createdAt: new Date()
                    },
                    {
                        id: 'demo2',
                        name: 'Polar Caron',
                        email: 'polar.caron@synergia.com',
                        role: 'developer',
                        department: 'it',
                        level: 4,
                        xp: 980,
                        status: 'online',
                        avatar: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='60' height='60' viewBox='0 0 60 60'%3E%3Crect width='60' height='60' fill='%2328a745'/%3E%3Ctext x='30' y='35' text-anchor='middle' fill='white' font-family='Arial' font-size='24'%3EP%3C/text%3E%3C/svg%3E",
                        createdAt: new Date()
                    },
                    {
                        id: 'demo3',
                        name: 'Marie Dubois',
                        email: 'marie.dubois@synergia.com',
                        role: 'designer',
                       department: 'design',
                       level: 3,
                       xp: 750,
                       status: 'away',
                       avatar: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='60' height='60' viewBox='0 0 60 60'%3E%3Crect width='60' height='60' fill='%23e83e8c'/%3E%3Ctext x='30' y='35' text-anchor='middle' fill='white' font-family='Arial' font-size='24'%3EM%3C/text%3E%3C/svg%3E",
                       createdAt: new Date()
                   }
               ];

               roles = [
                   { id: 'admin', name: 'Administrateur', permissions: ['admin.all'] },
                   { id: 'manager', name: 'Manager', permissions: ['users.read', 'users.write', 'planning.read', 'planning.write'] },
                   { id: 'developer', name: 'Développeur', permissions: ['users.read', 'planning.read'] },
                   { id: 'designer', name: 'Designer', permissions: ['users.read', 'planning.read'] }
               ];

               quests = [
                   {
                       id: 'daily_checkin',
                       title: 'Pointer son arrivée',
                       description: 'Pointer votre arrivée avant 9h30',
                       type: 'daily',
                       xp: 50,
                       condition: 'checkin',
                       active: true
                   },
                   {
                       id: 'daily_message',
                       title: 'Message d\'équipe',
                       description: 'Envoyer un message dans le chat',
                       type: 'daily',
                       xp: 30,
                       condition: 'message',
                       active: true
                   }
               ];

               events = [
                   {
                       id: '1',
                       title: 'Réunion équipe',
                       description: 'Point hebdomadaire',
                       date: new Date(),
                       type: 'meeting'
                   }
               ];

               // Mettre à jour l'affichage SANS appeler les autres méthodes
               this.renderAllDisplays();
               this.updateFirebaseStatus();
           }

           renderAllDisplays() {
               // Rendre tous les affichages en une seule fois pour éviter les boucles
               this.renderUsersInSettings();
               this.renderTeamMembers();
               this.renderRoles();
               this.renderQuests();
               this.updateDashboardStats();
           }

           renderUsersInSettings() {
               const container = document.getElementById('users-list');
               if (!container) return;

               container.innerHTML = '';
               users.forEach(user => {
                   const userElement = document.createElement('div');
                   userElement.style.cssText = 'display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; border: 1px solid #e9ecef; border-radius: 8px; margin-bottom: 0.5rem;';
                   userElement.innerHTML = `
                       <div>
                           <strong>${user.name}</strong>
                           <br><small style="color: #666;">${user.email} - ${user.role}</small>
                       </div>
                       <div style="display: flex; gap: 0.5rem;">
                           <button onclick="editUser('${user.id}')" class="btn-icon" title="Modifier">
                               <i class="fas fa-edit"></i>
                           </button>
                           <button onclick="deleteUser('${user.id}')" class="btn-icon" title="Supprimer" style="color: #dc3545;">
                               <i class="fas fa-trash"></i>
                           </button>
                       </div>
                   `;
                   container.appendChild(userElement);
               });
           }

           renderTeamMembers() {
               const teamContainer = document.getElementById('team-members-list');
               if (!teamContainer) return;

               teamContainer.innerHTML = '';
               users.forEach(user => {
                   const memberCard = document.createElement('div');
                   memberCard.className = 'team-member-card animate-slide-up';
                   memberCard.innerHTML = `
                       <div class="member-avatar">
                           <img src="${user.avatar || this.generateAvatar(user.name)}" alt="${user.name}">
                           <div class="status-indicator ${user.status || 'offline'}"></div>
                       </div>
                       <div class="member-info">
                           <h3>${user.name}</h3>
                           <p style="color: #667eea; font-weight: 500; margin-bottom: 0.25rem;">${user.role}</p>
                           <p style="color: #666; font-size: 0.9rem; margin-bottom: 1rem;">${user.email}</p>
                           <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                               <span style="background: #f8f9fa; padding: 0.25rem 0.5rem; border-radius: 6px; font-size: 0.85rem;">Niveau ${user.level || 1}</span>
                               <span style="background: #f8f9fa; padding: 0.25rem 0.5rem; border-radius: 6px; font-size: 0.85rem;">${user.xp || 0} XP</span>
                           </div>
                           <div style="display: flex; gap: 0.5rem; justify-content: flex-end;">
                               <button class="btn-icon" onclick="sendMessage('${user.name}')" title="Message">
                                   <i class="fas fa-envelope"></i>
                               </button>
                               <button class="btn-icon" onclick="viewProfile('${user.name}')" title="Profil">
                                   <i class="fas fa-user"></i>
                               </button>
                               <button class="btn-icon" onclick="assignQuest('${user.name}')" title="Assigner mission">
                                   <i class="fas fa-tasks"></i>
                               </button>
                           </div>
                       </div>
                   `;
                   teamContainer.appendChild(memberCard);
               });
           }

           renderRoles() {
               const container = document.getElementById('roles-list');
               if (!container) return;

               container.innerHTML = '';
               roles.forEach(role => {
                   const roleElement = document.createElement('div');
                   roleElement.style.cssText = 'display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; border: 1px solid #e9ecef; border-radius: 8px; margin-bottom: 0.5rem;';
                   roleElement.innerHTML = `
                       <div>
                           <strong>${role.name}</strong>
                           <br><small style="color: #666;">${role.permissions ? role.permissions.length : 0} permissions</small>
                       </div>
                       <div style="display: flex; gap: 0.5rem;">
                           <button onclick="editRole('${role.id}')" class="btn-icon" title="Modifier">
                               <i class="fas fa-edit"></i>
                           </button>
                           <button onclick="deleteRole('${role.id}')" class="btn-icon" title="Supprimer" style="color: #dc3545;">
                               <i class="fas fa-trash"></i>
                           </button>
                       </div>
                   `;
                   container.appendChild(roleElement);
               });
           }

           renderQuests() {
               const container = document.getElementById('quests-list');
               if (!container) return;

               container.innerHTML = '';
               quests.forEach(quest => {
                   const questElement = document.createElement('div');
                   questElement.style.cssText = 'display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; border: 1px solid #e9ecef; border-radius: 8px; margin-bottom: 0.5rem;';
                   questElement.innerHTML = `
                       <div>
                           <strong>${quest.title}</strong>
                           <br><small style="color: #666;">${quest.type} - ${quest.xp} XP</small>
                       </div>
                       <div style="display: flex; gap: 0.5rem; align-items: center;">
                           <span style="padding: 0.25rem 0.5rem; background: ${quest.active ? '#28a745' : '#6c757d'}; color: white; border-radius: 4px; font-size: 0.8rem;">
                               ${quest.active ? 'Actif' : 'Inactif'}
                           </span>
                           <button onclick="editQuest('${quest.id}')" class="btn-icon" title="Modifier">
                               <i class="fas fa-edit"></i>
                           </button>
                           <button onclick="deleteQuest('${quest.id}')" class="btn-icon" title="Supprimer" style="color: #dc3545;">
                               <i class="fas fa-trash"></i>
                           </button>
                       </div>
                   `;
                   container.appendChild(questElement);
               });
           }

           updateDashboardStats() {
               // Mettre à jour le compteur dans le dashboard
               const teamCountElement = document.getElementById('team-count');
               if (teamCountElement) {
                   teamCountElement.textContent = users.length;
               }
           }

           // SUPPRIMER updateUsersDisplay et updateTeamDisplay pour éviter les boucles
           updateUsersDisplay() {
               this.renderUsersInSettings();
           }

           updateRolesDisplay() {
               this.renderRoles();
           }

           updateQuestsDisplay() {
               this.renderQuests();
           }

           updateEventsDisplay() {
               // Mettre à jour l'affichage des événements dans le planning
               const container = document.getElementById('events-container');
               if (!container || events.length === 0) return;
               // Code d'affichage des événements déjà présent
           }

           updateFirebaseStatus() {
               const statusElement = document.getElementById('firebase-status-text');
               const projectElement = document.getElementById('firebase-project');
               
               if (statusElement) {
                   if (this.isReady && !this.isDemo) {
                       statusElement.innerHTML = '✅ Connecté et synchronisé';
                       projectElement.textContent = window.firebaseApp?.options?.projectId || 'synergia-app-f27e7';
                   } else {
                       statusElement.innerHTML = '🎭 Mode démo - Firebase configuré';
                       projectElement.textContent = 'synergia-app-f27e7';
                       
                       // Changer le style pour indiquer le mode démo
                       const statusContainer = document.getElementById('firebase-status');
                       statusContainer.style.background = '#fff3cd';
                       statusContainer.style.borderColor = '#ffc107';
                       statusContainer.querySelector('strong').style.color = '#856404';
                       statusContainer.querySelector('p').style.color = '#856404';
                   }
               }
           }

           generateAvatar(name) {
               const firstLetter = name ? name.charAt(0).toUpperCase() : 'U';
               const colors = ['#667eea', '#28a745', '#e83e8c', '#ffc107', '#dc3545', '#6c757d'];
               const color = colors[name.length % colors.length];
               
               return `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='60' height='60' viewBox='0 0 60 60'%3E%3Crect width='60' height='60' fill='${encodeURIComponent(color)}'/%3E%3Ctext x='30' y='35' text-anchor='middle' fill='white' font-family='Arial' font-size='24'%3E${firstLetter}%3C/text%3E%3C/svg%3E`;
           }

           // Méthodes CRUD pour Firebase
           async createUser(userData) {
               if (this.isDemo) {
                   // Mode démo
                   const newUser = {
                       id: 'user_' + Date.now(),
                       ...userData,
                       level: 1,
                       xp: 0,
                       status: 'offline',
                       avatar: this.generateAvatar(userData.name),
                       createdAt: new Date()
                   };
                   users.push(newUser);
                   this.renderAllDisplays();
                   return newUser;
               }

               try {
                   const userCompanyId = currentUser.uid;
                   const docRef = await window.firebase.addDoc(
                       window.firebase.collection(window.db, 'companies', userCompanyId, 'users'),
                       {
                           ...userData,
                           level: 1,
                           xp: 0,
                           status: 'offline',
                           avatar: this.generateAvatar(userData.name),
                           createdAt: window.firebase.serverTimestamp()
                       }
                   );
                   
                   console.log('✅ Utilisateur créé:', docRef.id);
                   return { id: docRef.id, ...userData };
               } catch (error) {
                   console.error('❌ Erreur création utilisateur:', error);
                   throw error;
               }
           }

           async createRole(roleData) {
               if (this.isDemo) {
                   const newRole = {
                       id: 'role_' + Date.now(),
                       ...roleData,
                       createdAt: new Date()
                   };
                   roles.push(newRole);
                   this.renderRoles();
                   return newRole;
               }

               try {
                   const userCompanyId = currentUser.uid;
                   const docRef = await window.firebase.addDoc(
                       window.firebase.collection(window.db, 'companies', userCompanyId, 'roles'),
                       {
                           ...roleData,
                           createdAt: window.firebase.serverTimestamp()
                       }
                   );
                   
                   console.log('✅ Rôle créé:', docRef.id);
                   return { id: docRef.id, ...roleData };
               } catch (error) {
                   console.error('❌ Erreur création rôle:', error);
                   throw error;
               }
           }

           async createQuest(questData) {
               if (this.isDemo) {
                   const newQuest = {
                       id: 'quest_' + Date.now(),
                       ...questData,
                       active: true,
                       createdAt: new Date()
                   };
                   quests.push(newQuest);
                   this.renderQuests();
                   return newQuest;
               }

               try {
                   const userCompanyId = currentUser.uid;
                   const docRef = await window.firebase.addDoc(
                       window.firebase.collection(window.db, 'companies', userCompanyId, 'quests'),
                       {
                           ...questData,
                           active: true,
                           createdAt: window.firebase.serverTimestamp()
                       }
                   );
                   
                   console.log('✅ Mission créée:', docRef.id);
                   return { id: docRef.id, ...questData };
               } catch (error) {
                   console.error('❌ Erreur création mission:', error);
                   throw error;
               }
           }

           async syncAllToFirebase() {
               if (this.isDemo) {
                   showToast('Mode démo - Synchronisation simulée', 'info');
                   return;
               }

               try {
                   showToast('Synchronisation en cours...', 'info');
                   
                   // Synchroniser tous les utilisateurs, rôles, missions, etc.
                   // Cette méthode serait utilisée pour migrer depuis le mode démo
                   
                   showToast('Synchronisation terminée!', 'success');
               } catch (error) {
                   console.error('❌ Erreur synchronisation:', error);
                   showToast('Erreur lors de la synchronisation', 'error');
               }
           }
       }

       // Initialiser Firebase Manager
       const firebaseManager = new FirebaseManager();

       // Système de notifications
       function showToast(message, type = 'info', duration = 3000) {
           const toast = document.createElement('div');
           toast.className = `notification ${type}`;
           toast.innerHTML = `
               <div style="display: flex; align-items: center; gap: 0.5rem;">
                   <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation-triangle' : 'info'}"></i>
                   <span>${message}</span>
               </div>
           `;
           
           document.getElementById('toast-container').appendChild(toast);
           
           setTimeout(() => {
               toast.remove();
           }, duration);
       }

       // Navigation
       function setupNavigation() {
           const navLinks = document.querySelectorAll('.nav-link');
           const sections = document.querySelectorAll('.content-section');

           navLinks.forEach(link => {
               link.addEventListener('click', (e) => {
                   e.preventDefault();
                   
                   navLinks.forEach(l => l.classList.remove('active'));
                   link.classList.add('active');
                   
                   sections.forEach(section => section.classList.remove('active'));
                   
                   const targetId = link.getAttribute('href').substring(1);
                   const targetSection = document.getElementById(targetId);
                   if (targetSection) {
                       targetSection.classList.add('active');
                   }
               });
           });
       }

       // Gestion Google Calendar
       function showGoogleModal() {
           const modal = document.getElementById('google-calendar-modal');
           modal.style.display = 'flex';
           
           if (isGoogleConnected) {
               document.getElementById('google-auth-section').style.display = 'none';
               document.getElementById('google-sync-settings').style.display = 'block';
           } else {
               document.getElementById('google-auth-section').style.display = 'block';
               document.getElementById('google-sync-settings').style.display = 'none';
           }
       }

       function closeGoogleModal() {
           document.getElementById('google-calendar-modal').style.display = 'none';
       }

       function connectGoogle() {
           // Simulation de connexion Google
           isGoogleConnected = true;
           document.getElementById('google-user-email').textContent = 'demo@gmail.com';
           showToast('Connecté à Google Calendar avec succès!', 'success');
           showGoogleModal();
       }

       function disconnectGoogle() {
           isGoogleConnected = false;
           showToast('Déconnecté de Google Calendar', 'success');
           closeGoogleModal();
           updateGoogleStatus();
       }

       function testGoogleSync() {
           showToast('Test de synchronisation...', 'info');
           setTimeout(() => {
               showToast('Test de synchronisation réussi!', 'success');
           }, 2000);
       }

       function saveGoogleSettings() {
           showToast('Paramètres de synchronisation sauvegardés', 'success');
           closeGoogleModal();
       }

       function syncWithGoogle() {
           if (!isGoogleConnected) {
               showToast('Veuillez d\'abord vous connecter à Google Calendar', 'error');
               return;
           }
           
           showToast('Synchronisation avec Google Calendar en cours...', 'info');
           setTimeout(() => {
               showToast('Synchronisation terminée! 5 événements synchronisés', 'success');
               updateGoogleStatus();
           }, 2000);
       }

       function updateGoogleStatus() {
           const statusElement = document.getElementById('google-status');
           if (statusElement) {
               if (isGoogleConnected) {
                   statusElement.innerHTML = `
                       <div class="sync-indicator"></div>
                       <span>Synchronisé avec Google</span>
                   `;
                   statusElement.className = 'sync-status';
               } else {
                   statusElement.innerHTML = `
                       <i class="fas fa-exclamation-triangle"></i>
                       <span>Non connecté</span>
                   `;
                   statusElement.className = 'sync-status';
                   statusElement.style.background = '#dc3545';
               }
           }
       }

       // Gestion des événements
       function showAddEventModal() {
           const modal = document.getElementById('add-event-modal');
           modal.style.display = 'flex';
           
           // Pré-remplir avec la date d'aujourd'hui
           const today = new Date();
           document.getElementById('event-date').value = today.toISOString().split('T')[0];
           document.getElementById('event-time').value = '10:00';
       }

       function closeEventModal() {
           document.getElementById('add-event-modal').style.display = 'none';
       }

       function createEvent() {
           const title = document.getElementById('event-title').value;
           const description = document.getElementById('event-description').value;
           const date = document.getElementById('event-date').value;
           const time = document.getElementById('event-time').value;
           const type = document.getElementById('event-type').value;
           const syncToGoogle = document.getElementById('sync-to-google').checked;

           if (!title || !date || !time || !type) {
               showToast('Veuillez remplir tous les champs obligatoires', 'error');
               return;
           }

           const newEvent = {
               id: Date.now().toString(),
               title,
               description,
               date: new Date(`${date}T${time}`),
               type,
               source: 'synergia'
           };

           events.push(newEvent);
           
           let message = `Événement "${title}" créé avec succès`;
           if (syncToGoogle && isGoogleConnected) {
               message += ' et synchronisé avec Google Calendar';
           }
           
           showToast(message, 'success');
           closeEventModal();
           
           // Réinitialiser le formulaire
           document.getElementById('add-event-form').reset();
       }

       // Missions / Quests
       function acceptQuest(questId) {
           const quests = {
               'daily_checkin': 'Pointer son arrivée',
               'daily_message': 'Message d\'équipe',
               'google_sync': 'Synchronisation Google'
           };
           
           const questName = quests[questId] || questId;
           showToast(`Mission "${questName}" acceptée!`, 'success');
           
           // Simulation d'ajout d'XP
           setTimeout(() => {
               showToast('🎉 +50 XP gagnés!', 'success');
           }, 1000);
       }

       function showAllEvents() {
           showToast('Affichage de tous les événements', 'info');
       }

       // Fonctions pour Analytics Pro
       let proCharts = {};

       function initAnalyticsPro() {
           // Créer les graphiques Analytics Pro
           createProAttendanceChart();
           createProProductivityChart();
           createProGoogleChart();
           createProMissionsChart();
           
           // Démarrer les mises à jour temps réel
           startProRealTimeUpdates();
           
           console.log('📊 Analytics Pro initialisé');
       }

       function createProAttendanceChart() {
           const ctx = document.getElementById('pro-attendance-chart');
           if (!ctx) return;

           proCharts.attendance = new Chart(ctx, {
               type: 'line',
               data: {
                   labels: Array.from({length: 24}, (_, i) => `${i}h`),
                   datasets: [{
                       label: 'Présence temps réel',
                       data: Array.from({length: 24}, () => 75 + Math.random() * 25),
                       borderColor: '#667eea',
                       backgroundColor: 'rgba(102, 126, 234, 0.1)',
                       borderWidth: 2,
                       fill: true,
                       tension: 0.4,
                       pointRadius: 0,
                       pointHoverRadius: 6
                   }]
               },
               options: {
                   responsive: true,
                   maintainAspectRatio: false,
                   plugins: {
                       legend: { display: false }
                   },
                   scales: {
                       y: {
                           beginAtZero: true,
                           max: 100,
                           ticks: {
                               callback: function(value) {
                                   return value + '%';
                               }
                           }
                       }
                   }
               }
           });
       }

       function createProProductivityChart() {
           const ctx = document.getElementById('pro-productivity-chart');
           if (!ctx) return;

           proCharts.productivity = new Chart(ctx, {
               type: 'doughnut',
               data: {
                   labels: ['Allan Boehme', 'Polar Caron', 'Marie Dubois'],
                   datasets: [{
                       data: [96, 92, 88],
                       backgroundColor: ['#667eea', '#28a745', '#ffc107'],
                       borderWidth: 0
                   }]
               },
               options: {
                   responsive: true,
                   maintainAspectRatio: false,
                   plugins: {
                       legend: { position: 'bottom' }
                   }
               }
           });
       }

       function createProGoogleChart() {
           const ctx = document.getElementById('pro-google-chart');
           if (!ctx) return;

           proCharts.google = new Chart(ctx, {
               type: 'bar',
               data: {
                   labels: ['Événements créés', 'Événements importés', 'Conflits résolus', 'Sync réussies'],
                   datasets: [{
                       label: 'Google Calendar',
                       data: [24, 18, 3, 42],
                       backgroundColor: ['#4285f4', '#34a853', '#fbbc04', '#ea4335'],
                       borderRadius: 4
                   }]
               },
               options: {
                   responsive: true,
                   maintainAspectRatio: false,
                   plugins: {
                       legend: { display: false }
                   },
                   scales: {
                       y: { beginAtZero: true }
                   }
               }
           });
       }

       function createProMissionsChart() {
           const ctx = document.getElementById('pro-missions-chart');
           if (!ctx) return;

           proCharts.missions = new Chart(ctx, {
               type: 'line',
               data: {
                   labels: ['Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam', 'Dim'],
                   datasets: [
                       {
                           label: 'XP Gagnés',
                           data: [120, 180, 95, 210, 165, 80, 45],
                           borderColor: '#ffc107',
                           backgroundColor: 'rgba(255, 193, 7, 0.1)',
                           tension: 0.4,
                           fill: true
                       },
                       {
                           label: 'Missions Complétées',
                           data: [4, 6, 3, 7, 5, 2, 1],
                           borderColor: '#28a745',
                           backgroundColor: 'rgba(40, 167, 69, 0.1)',
                           tension: 0.4,
                           fill: true
                       }
                   ]
               },
               options: {
                   responsive: true,
                   maintainAspectRatio: false,
                   plugins: {
                       legend: { position: 'bottom' }
                   },
                   scales: {
                       y: { beginAtZero: true }
                   }
               }
           });
       }

       function startProRealTimeUpdates() {
           // Mettre à jour les KPIs toutes les 5 secondes
           setInterval(() => {
               updateProKPIs();
           }, 5000);
       }

       function updateProKPIs() {
           // Simulation de mise à jour temps réel
           const elements = {
               'pro-active-users': () => 10 + Math.floor(Math.random() * 5),
               'pro-avg-hours': () => (8 + Math.random()).toFixed(1) + 'h',
               'pro-missions': () => {
                   const current = parseInt(document.getElementById('pro-missions').textContent);
                   return current + Math.floor(Math.random() * 3);
               },
               'pro-productivity': () => (90 + Math.random() * 10).toFixed(0) + '%',
               'pro-google-sync': () => (95 + Math.random() * 5).toFixed(1) + '%'
           };

           Object.entries(elements).forEach(([id, valueFunc]) => {
               const element = document.getElementById(id);
               if (element) {
                   element.textContent = valueFunc();
               }
           });

           // Mettre à jour les graphiques
           updateChartData();
       }

       function updateChartData() {
           if (proCharts.attendance) {
               const newData = Array.from({length: 24}, () => 75 + Math.random() * 25);
               proCharts.attendance.data.datasets[0].data = newData;
               proCharts.attendance.update('none');
           }

           if (proCharts.productivity) {
               const newData = [95 + Math.random() * 5, 90 + Math.random() * 8, 85 + Math.random() * 10];
               proCharts.productivity.data.datasets[0].data = newData;
               proCharts.productivity.update('none');
           }
       }

       function updateAttendanceChart() {
           showToast('Mise à jour du graphique de présence...', 'info');
           if (proCharts.attendance) {
               const newData = Array.from({length: 24}, () => 75 + Math.random() * 25);
               proCharts.attendance.data.datasets[0].data = newData;
               proCharts.attendance.update();
           }
           setTimeout(() => showToast('Graphique de présence mis à jour', 'success'), 500);
       }

       function updateProductivityChart() {
           showToast('Mise à jour de la productivité...', 'info');
           if (proCharts.productivity) {
               const newData = [95 + Math.random() * 5, 90 + Math.random() * 8, 85 + Math.random() * 10];
               proCharts.productivity.data.datasets[0].data = newData;
               proCharts.productivity.update();
           }
           setTimeout(() => showToast('Graphique de productivité mis à jour', 'success'), 500);
       }

       function updateGoogleChart() {
           showToast('Mise à jour des stats Google Calendar...', 'info');
           if (proCharts.google) {
               const newData = [
                   20 + Math.floor(Math.random() * 10),
                   15 + Math.floor(Math.random() * 8),
                   1 + Math.floor(Math.random() * 5),
                   35 + Math.floor(Math.random() * 15)
               ];
               proCharts.google.data.datasets[0].data = newData;
               proCharts.google.update();
           }
           setTimeout(() => showToast('Stats Google Calendar mises à jour', 'success'), 500);
       }

       function updateMissionsChart() {
           showToast('Mise à jour des missions...', 'info');
           if (proCharts.missions) {
               const newXPData = Array.from({length: 7}, () => 50 + Math.random() * 200);
               const newMissionsData = Array.from({length: 7}, () => 1 + Math.floor(Math.random() * 8));
               
               proCharts.missions.data.datasets[0].data = newXPData;
               proCharts.missions.data.datasets[1].data = newMissionsData;
               proCharts.missions.update();
           }
           setTimeout(() => showToast('Graphique des missions mis à jour', 'success'), 500);
       }

       function generateReport(type) {
           const reports = {
               'performance': 'Rapport de Performance Équipe',
               'google-integration': 'Rapport Google Calendar',
               'missions': 'Rapport Missions & Gamification',
               'predictive': 'Analyse Prédictive IA'
           };
           
           const reportName = reports[type] || type;
           showToast(`Génération du ${reportName} en cours...`, 'info');
           
           setTimeout(() => {
               showToast(`${reportName} généré et téléchargé`, 'success');
               
               // Simulation de téléchargement
               const reportData = {
                   type: type,
                   generatedAt: new Date().toISOString(),
                   data: {
                       activeUsers: document.getElementById('pro-active-users').textContent,
                       avgHours: document.getElementById('pro-avg-hours').textContent,
                       missions: document.getElementById('pro-missions').textContent,
                       productivity: document.getElementById('pro-productivity').textContent,
                       googleSync: document.getElementById('pro-google-sync').textContent
                   }
               };
               
               const blob = new Blob([JSON.stringify(reportData, null, 2)], { type: 'application/json' });
               const url = URL.createObjectURL(blob);
               const a = document.createElement('a');
               a.href = url;
               a.download = `${type}_report_${new Date().toISOString().split('T')[0]}.json`;
               a.click();
               URL.revokeObjectURL(url);
           }, 2000);
       }

       function openFullAnalytics() {
           showToast('Ouverture Analytics Pro dans un nouvel onglet...', 'info');
           // Simulation d'ouverture dans un nouvel onglet
           setTimeout(() => {
               showToast('Analytics Pro ouvert (simulation)', 'success');
           }, 1000);
       }

       function refreshAllAnalytics() {
           showToast('Actualisation complète des analytics...', 'info');
           
           // Mettre à jour tous les KPIs
           updateProKPIs();
           
           // Mettre à jour tous les graphiques
           setTimeout(() => {
               updateAttendanceChart();
           }, 500);
           
           setTimeout(() => {
               updateProductivityChart();
           }, 1000);
           
           setTimeout(() => {
               updateGoogleChart();
           }, 1500);
           
           setTimeout(() => {
               updateMissionsChart();
           }, 2000);
           
           setTimeout(() => {
               showToast('🎉 Toutes les analytics ont été actualisées!', 'success');
           }, 2500);
       }

       function exportAllData() {
           showToast('Export de toutes les données Analytics Pro...', 'info');
           
           setTimeout(() => {
               const allData = {
                   exportedAt: new Date().toISOString(),
                   kpis: {
                       activeUsers: document.getElementById('pro-active-users').textContent,
                       avgHours: document.getElementById('pro-avg-hours').textContent,
                       missions: document.getElementById('pro-missions').textContent,
                       productivity: document.getElementById('pro-productivity').textContent,
                       googleSync: document.getElementById('pro-google-sync').textContent
                   },
                   charts: {
                       attendance: proCharts.attendance ? proCharts.attendance.data : null,
                       productivity: proCharts.productivity ? proCharts.productivity.data : null,
                       google: proCharts.google ? proCharts.google.data : null,
                       missions: proCharts.missions ? proCharts.missions.data : null
                   },
                   metadata: {
                       version: 'SYNERGIA v3.0',
                       module: 'Analytics Pro',
                       googleIntegration: isGoogleConnected
                   }
               };
               
               const blob = new Blob([JSON.stringify(allData, null, 2)], { type: 'application/json' });
               const url = URL.createObjectURL(blob);
               const a = document.createElement('a');
               a.href = url;
               a.download = `synergia_analytics_pro_complete_${new Date().toISOString().split('T')[0]}.json`;
               a.click();
               URL.revokeObjectURL(url);
               
               showToast('Export complet terminé!', 'success');
           }, 2000);
       }

       // Gestion des onglets de missions
       document.querySelectorAll('.quest-tab').forEach(tab => {
           tab.addEventListener('click', function() {
               // Retirer l'active de tous les onglets
               document.querySelectorAll('.quest-tab').forEach(t => t.classList.remove('active'));
               // Ajouter l'active à l'onglet cliqué
               this.classList.add('active');
               
               const tabName = this.textContent.trim();
               showToast(`Onglet "${tabName}" sélectionné`, 'info');
           });
       });

       // Navigation mobile
       function setupMobileNavigation() {
           const mobileToggle = document.getElementById('mobile-menu-toggle');
           const navMenu = document.getElementById('nav-menu');
           
           if (mobileToggle && navMenu) {
               mobileToggle.addEventListener('click', function() {
                   navMenu.classList.toggle('mobile-open');
                   
                   // Changer l'icône
                   const icon = mobileToggle.querySelector('i');
                   if (navMenu.classList.contains('mobile-open')) {
                       icon.className = 'fas fa-times';
                   } else {
                       icon.className = 'fas fa-bars';
                   }
               });

               // Fermer le menu en cliquant sur un lien
               const navLinks = navMenu.querySelectorAll('.nav-link');
               navLinks.forEach(link => {
                   link.addEventListener('click', () => {
                       if (window.innerWidth <= 768) {
                           navMenu.classList.remove('mobile-open');
                           mobileToggle.querySelector('i').className = 'fas fa-bars';
                       }
                   });
               });

               // Fermer le menu en cliquant à l'extérieur
               document.addEventListener('click', function(event) {
                   if (window.innerWidth <= 768 && 
                       !navMenu.contains(event.target) && 
                       !mobileToggle.contains(event.target) &&
                       navMenu.classList.contains('mobile-open')) {
                       navMenu.classList.remove('mobile-open');
                       mobileToggle.querySelector('i').className = 'fas fa-bars';
                   }
               });
           }
       }

       // Chat sidebar mobile
       function toggleChatSidebar() {
           const sidebar = document.getElementById('chat-sidebar');
           if (sidebar) {
               sidebar.classList.toggle('mobile-open');
           }
       }

       // Fonctions de gestion des paramètres
       async function createUser() {
           const name = document.getElementById('new-user-name').value.trim();
           const email = document.getElementById('new-user-email').value.trim();
           const role = document.getElementById('new-user-role').value;
           const department = document.getElementById('new-user-department').value;

           if (!name || !email || !role) {
               showToast('Veuillez remplir tous les champs obligatoires', 'error');
               return;
           }

           try {
               const userData = { name, email, role, department };
               await firebaseManager.createUser(userData);
               
               // Réinitialiser le formulaire
               document.getElementById('new-user-name').value = '';
               document.getElementById('new-user-email').value = '';
               document.getElementById('new-user-role').value = '';
               document.getElementById('new-user-department').value = '';
               
               showToast(`Utilisateur "${name}" créé avec succès`, 'success');
           } catch (error) {
               showToast('Erreur lors de la création de l\'utilisateur', 'error');
           }
       }

       async function createRole() {
           const name = document.getElementById('new-role-name').value.trim();
           const description = document.getElementById('new-role-description').value.trim();
           const permissionCheckboxes = document.querySelectorAll('input[name="role-permissions"]:checked');
           const permissions = Array.from(permissionCheckboxes).map(cb => cb.value);

           if (!name || permissions.length === 0) {
               showToast('Veuillez remplir le nom et sélectionner au moins une permission', 'error');
               return;
           }

           try {
               const roleData = { name, description, permissions };
               await firebaseManager.createRole(roleData);
               
               // Réinitialiser le formulaire
               document.getElementById('new-role-name').value = '';
               document.getElementById('new-role-description').value = '';
               permissionCheckboxes.forEach(cb => cb.checked = false);
               
               showToast(`Rôle "${name}" créé avec succès`, 'success');
           } catch (error) {
               showToast('Erreur lors de la création du rôle', 'error');
           }
       }

       async function createQuest() {
           const title = document.getElementById('new-quest-title').value.trim();
           const description = document.getElementById('new-quest-description').value.trim();
           const type = document.getElementById('new-quest-type').value;
           const xp = parseInt(document.getElementById('new-quest-xp').value);
           const difficulty = document.getElementById('new-quest-difficulty').value;
           const condition = document.getElementById('new-quest-condition').value;
           const conditionValue = document.getElementById('new-quest-condition-value').value.trim();

           if (!title || !description || !xp) {
               showToast('Veuillez remplir tous les champs obligatoires', 'error');
               return;
           }

           try {
               const questData = {
                   title,
                   description,
                   type,
                   xp,
                   difficulty,
                   condition,
                   conditionValue,
                   icon: getQuestIcon(type)
               };
               
               await firebaseManager.createQuest(questData);
               
               // Réinitialiser le formulaire
               document.getElementById('new-quest-title').value = '';
               document.getElementById('new-quest-description').value = '';
               document.getElementById('new-quest-xp').value = '50';
               document.getElementById('new-quest-condition-value').value = '';
               
               showToast(`Mission "${title}" créée avec succès`, 'success');
           } catch (error) {
               showToast('Erreur lors de la création de la mission', 'error');
           }
       }

       function getQuestIcon(type) {
           const icons = {
               'daily': '⭐',
               'weekly': '🗓️',
               'monthly': '📅',
               'special': '🎁'
           };
           return icons[type] || '🎯';
       }

       function editUser(userId) {
           const user = users.find(u => u.id === userId);
           if (user) {
               showToast(`Modification de ${user.name} (fonctionnalité à développer)`, 'info');
           }
       }

       function deleteUser(userId) {
           if (confirm('Êtes-vous sûr de vouloir supprimer cet utilisateur ?')) {
               const userIndex = users.findIndex(u => u.id === userId);
               if (userIndex > -1) {
                   const userName = users[userIndex].name;
                   users.splice(userIndex, 1);
                   // Utiliser la nouvelle méthode pour éviter les boucles
                   if (firebaseManager) {
                       firebaseManager.renderAllDisplays();
                   }
                   showToast(`Utilisateur ${userName} supprimé`, 'success');
               }
           }
       }

       function editRole(roleId) {
           const role = roles.find(r => r.id === roleId);
           if (role) {
               showToast(`Modification du rôle ${role.name} (fonctionnalité à développer)`, 'info');
           }
       }

       function deleteRole(roleId) {
           if (confirm('Êtes-vous sûr de vouloir supprimer ce rôle ?')) {
               const roleIndex = roles.findIndex(r => r.id === roleId);
               if (roleIndex > -1) {
                   const roleName = roles[roleIndex].name;
                   roles.splice(roleIndex, 1);
                   if (firebaseManager) {
                       firebaseManager.renderRoles();
                   }
                   showToast(`Rôle ${roleName} supprimé`, 'success');
               }
           }
       }

       function editQuest(questId) {
           const quest = quests.find(q => q.id === questId);
           if (quest) {
               showToast(`Modification de la mission ${quest.title} (fonctionnalité à développer)`, 'info');
           }
       }

       function deleteQuest(questId) {
           if (confirm('Êtes-vous sûr de vouloir supprimer cette mission ?')) {
               const questIndex = quests.findIndex(q => q.id === questId);
               if (questIndex > -1) {
                   const questTitle = quests[questIndex].title;
                   quests.splice(questIndex, 1);
                   if (firebaseManager) {
                       firebaseManager.renderQuests();
                   }
                   showToast(`Mission ${questTitle} supprimée`, 'success');
               }
           }
       }

       function updateFirebaseConfig() {
           showToast('Mise à jour de la configuration Firebase...', 'info');
           
           // En production, cette fonction mettrait à jour la config Firebase
           setTimeout(() => {
               showToast('Configuration Firebase mise à jour (redémarrage requis)', 'success');
           }, 2000);
       }

       function testFirebaseConnection() {
           showToast('Test de connexion Firebase...', 'info');
           
           setTimeout(() => {
               if (firebaseManager.isReady) {
                   showToast('✅ Connexion Firebase réussie!', 'success');
               } else {
                   showToast('❌ Connexion Firebase échouée - Mode démo actif', 'warning');
               }
           }, 1500);
       }

       async function syncAllToFirebase() {
           await firebaseManager.syncAllToFirebase();
       }

       function importFromFirebase() {
           showToast('Import depuis Firebase en cours...', 'info');
           
           setTimeout(() => {
               if (firebaseManager.isReady) {
                   showToast('Données importées depuis Firebase', 'success');
                   // Recharger les données
                   firebaseManager.loadUserData();
               } else {
                   showToast('Firebase non disponible', 'warning');
               }
           }, 2000);
       }

       function exportFullConfig() {
           showToast('Export de la configuration...', 'info');
           
           const config = {
               exportDate: new Date().toISOString(),
               users: users,
               roles: roles,
               quests: quests,
               events: events,
               settings: {
                   firebaseEnabled: firebaseManager.isReady,
                   googleCalendarEnabled: isGoogleConnected
               }
           };
           
           const blob = new Blob([JSON.stringify(config, null, 2)], { type: 'application/json' });
           const url = URL.createObjectURL(blob);
           const a = document.createElement('a');
           a.href = url;
           a.download = `synergia_config_${new Date().toISOString().split('T')[0]}.json`;
           a.click();
           URL.revokeObjectURL(url);
           
           showToast('Configuration exportée', 'success');
       }

       function resetAllData() {
           if (confirm('⚠️ ATTENTION: Cette action supprimera TOUTES les données de manière irréversible. Êtes-vous sûr ?')) {
               if (confirm('Dernière confirmation: Voulez-vous vraiment tout supprimer ?')) {
                   showToast('Réinitialisation en cours...', 'info');
                   
                   // Réinitialiser toutes les données
                   users.length = 0;
                   roles.length = 0;
                   quests.length = 0;
                   events.length = 0;
                   
                   // Mettre à jour l'affichage
                   firebaseManager.updateUsersDisplay();
                   firebaseManager.updateRolesDisplay();
                   firebaseManager.updateQuestsDisplay();
                   
                   setTimeout(() => {
                       showToast('🔥 Toutes les données ont été supprimées', 'success');
                       
                       // Recharger les données par défaut
                       setTimeout(() => {
                           firebaseManager.loadDemoData();
                           showToast('Données par défaut rechargées', 'info');
                       }, 1000);
                   }, 2000);
               }
           }
       }

       function saveAllSettings() {
           showToast('Sauvegarde de tous les paramètres...', 'info');
           
           setTimeout(() => {
               showToast('Tous les paramètres ont été sauvegardés', 'success');
           }, 1500);
       }

       function refreshDashboard() {
           showToast('Actualisation du dashboard...', 'info');
           setTimeout(() => {
               showToast('Dashboard actualisé', 'success');
               // Mise à jour des stats
               document.getElementById('team-count').textContent = '3';
               document.getElementById('active-quests').textContent = '5';
               document.getElementById('events-today').textContent = isGoogleConnected ? '2' : '1';
           }, 1500);
       }

       function exportTeam() {
           showToast('Export de l\'équipe en cours...', 'info');
           setTimeout(() => {
               showToast('Équipe exportée en CSV', 'success');
           }, 1000);
       }

       function exportSchedule() {
           showToast('Export du planning en cours...', 'info');
           setTimeout(() => {
               showToast('Planning exporté', 'success');
           }, 1000);
       }

       function sendMessage(memberName) {
           showToast(`Ouverture du chat avec ${memberName}`, 'info');
           // Passer à l'onglet chat
           document.querySelector('.nav-link[href="#chat"]').click();
       }

       function viewProfile(memberName) {
           showToast(`Affichage du profil de ${memberName}`, 'info');
       }

       function assignQuest(memberName) {
           showToast(`Attribution de mission à ${memberName}`, 'info');
       }

       // Initialisation
       document.addEventListener('DOMContentLoaded', function() {
           setupNavigation();
           setupMobileNavigation();
           
           // Event listeners
           document.getElementById('google-signin-btn').addEventListener('click', connectGoogle);
           document.getElementById('google-sync-btn').addEventListener('click', syncWithGoogle);
           document.getElementById('add-event-btn').addEventListener('click', showAddEventModal);
           document.getElementById('add-event-form').addEventListener('submit', function(e) {
               e.preventDefault();
               createEvent();
           });
           
           // Fermeture des modales
           document.addEventListener('click', (e) => {
               if (e.target.classList.contains('modal')) {
                   e.target.style.display = 'none';
               }
           });
           
           // Gestion du chat
           document.getElementById('send-message-btn').addEventListener('click', function() {
               const input = document.getElementById('message-input');
               const message = input.value.trim();
               
               if (!message) return;
               
               // Ajouter le message à l'interface
               const messagesArea = document.querySelector('.messages-area');
               const messageElement = document.createElement('div');
               messageElement.style.cssText = 'display: flex; gap: 1rem; padding: 1rem; margin-bottom: 0.5rem; flex-direction: row-reverse;';
               messageElement.innerHTML = `
                   <img src="https://via.placeholder.com/40" alt="Vous" style="width: 40px; height: 40px; border-radius: 50%;">
                   <div style="text-align: right;">
                       <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem; flex-direction: row-reverse;">
                           <strong>Vous</strong>
                           <small style="color: #666;">${new Date().toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' })}</small>
                       </div>
                       <div style="background: #667eea; color: white; padding: 0.75rem; border-radius: 12px; border-top-right-radius: 4px;">
                           ${message}
                       </div>
                   </div>
               `;
               
               messagesArea.appendChild(messageElement);
               messagesArea.scrollTop = messagesArea.scrollHeight;
               
               // Vider l'input
               input.value = '';
               
               showToast('Message envoyé', 'success');
           });

           // Permettre l'envoi avec Entrée
           document.getElementById('message-input').addEventListener('keypress', function(e) {
               if (e.key === 'Enter') {
                   document.getElementById('send-message-btn').click();
               }
           });

           // Event listeners pour les nouveaux boutons
           const refreshBtn = document.getElementById('refresh-dashboard');
           if (refreshBtn) {
               refreshBtn.addEventListener('click', refreshDashboard);
           }

           const exportTeamBtn = document.getElementById('export-team-btn');
           if (exportTeamBtn) {
               exportTeamBtn.addEventListener('click', exportTeam);
           }

           const exportScheduleBtn = document.getElementById('export-schedule-btn');
           if (exportScheduleBtn) {
               exportScheduleBtn.addEventListener('click', exportSchedule);
           }

           // Logout
           const logoutBtn = document.getElementById('logout-btn');
           if (logoutBtn) {
               logoutBtn.addEventListener('click', function() {
                   if (confirm('Voulez-vous vraiment vous déconnecter ?')) {
                       showToast('Déconnexion...', 'info');
                       setTimeout(() => {
                           showToast('Au revoir ! 👋', 'success');
                           // Simulation de redirection
                           setTimeout(() => {
                               location.reload();
                           }, 1000);
                       }, 500);
                   }
               });
           }

           // Recherche d'équipe
           const searchInput = document.getElementById('team-search');
           if (searchInput) {
               searchInput.addEventListener('input', function(e) {
                   const searchTerm = e.target.value.toLowerCase();
                   const memberCards = document.querySelectorAll('.team-member-card');
                   
                   memberCards.forEach(card => {
                       const name = card.querySelector('h3').textContent.toLowerCase();
                       const email = card.querySelector('p:nth-child(3)').textContent.toLowerCase();
                       const role = card.querySelector('p:nth-child(2)').textContent.toLowerCase();
                       
                       const matches = name.includes(searchTerm) || 
                                     email.includes(searchTerm) || 
                                     role.includes(searchTerm);
                       
                       card.style.display = matches ? 'block' : 'none';
                   });
               });
           }

           // Message de bienvenue
           setTimeout(() => {
               showToast('🚀 SYNERGIA v3.0 avec Firebase initialisé!', 'success');
           }, 1000);

           console.log('🎉 SYNERGIA v3.0 entièrement initialisé !');
       });
   </script>
</body>
</html>
