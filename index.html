<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SYNERGIA v3.0 - Gestion d'√©quipe</title>
    
    <!-- Politique de s√©curit√© du contenu mise √† jour pour Analytics -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' 'unsafe-inline' 'unsafe-eval' 
            https://www.gstatic.com 
            https://www.googleapis.com 
            https://cdn.jsdelivr.net 
            https://www.googletagmanager.com;
        style-src 'self' 'unsafe-inline' 
            https://cdnjs.cloudflare.com 
            https://fonts.googleapis.com;
        font-src 'self' 
            https://cdnjs.cloudflare.com 
            https://fonts.gstatic.com;
        connect-src 'self' 
            https://www.gstatic.com 
            https://www.googleapis.com 
            https://firestore.googleapis.com 
            https://www.google-analytics.com
            https://analytics.google.com;
        img-src 'self' data: https:;
    ">
    
    <!-- CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, updateProfile } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, doc, addDoc, updateDoc, deleteDoc, getDocs, getDoc, onSnapshot, setDoc, query, where, orderBy, limit, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getStorage, ref, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js';

        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyD7uBuAQaOhZ02owkZEuMKC5Vji6PrB2f8",
            authDomain: "synergia-app-f27e7.firebaseapp.com",
            projectId: "synergia-app-f27e7",
            storageBucket: "synergia-app-f27e7.firebasestorage.app",
            messagingSenderId: "201912738922",
            appId: "1:201912738922:web:2fcc1e49293bb632899613",
            measurementId: "G-EGJ79SCMWX"
        };

        // Initialisation Firebase
        let app;
        let analytics = null;
        try {
            app = initializeApp(firebaseConfig);
            
            window.firebaseApp = app;
            window.auth = getAuth(app);
            window.db = getFirestore(app);
            window.storage = getStorage(app);
            
            // Initialisation conditionnelle d'Analytics
            try {
                const { getAnalytics } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js');
                analytics = getAnalytics(app);
                window.analytics = analytics;
                console.log('üìä Analytics activ√© avec succ√®s');
            } catch (analyticsError) {
                console.warn('‚ö†Ô∏è Analytics non disponible (CSP ou autre):', analyticsError.message);
                console.log('üìä Application fonctionnelle sans Analytics');
            }
            
            // Rendre les fonctions Firebase disponibles globalement
            window.firebase = {
                collection, doc, addDoc, updateDoc, deleteDoc, getDocs, getDoc, 
                onSnapshot, setDoc, query, where, orderBy, limit, serverTimestamp,
                onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, 
                signOut, updateProfile, ref, uploadBytes, getDownloadURL
            };
            
            console.log('‚úÖ Firebase initialis√© avec succ√®s');
            window.firebaseReady = true;
            window.analyticsReady = analytics !== null;
            
        } catch (error) {
            console.error('‚ùå Erreur d\'initialisation Firebase:', error);
            console.log('‚ö†Ô∏è Activation du mode d√©mo');
            window.firebaseReady = false;
            window.analyticsReady = false;
        }
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        /* Navigation */
        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 0;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
        }

        .nav-logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }

        .nav-menu {
            display: flex;
            gap: 2rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            text-decoration: none;
            color: #666;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .nav-link:hover,
        .nav-link.active {
            color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .nav-user {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-avatar img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        /* Layout principal */
        .main-content {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .content-section {
            display: none;
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .content-section.active {
            display: block;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f0f0f0;
        }

        .section-header h1 {
            color: #333;
            font-size: 2rem;
        }

        .section-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }

        /* Boutons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 1px solid #dee2e6;
        }

        .btn-secondary:hover {
            background: #e9ecef;
        }

        .btn-icon {
            padding: 0.5rem;
            border: none;
            background: transparent;
            border-radius: 6px;
            cursor: pointer;
            color: #666;
            transition: all 0.3s ease;
        }

        .btn-icon:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }

        /* Dashboard */
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 1.5rem;
            border-radius: 12px;
            color: white;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .stat-card i {
            font-size: 2rem;
            opacity: 0.8;
        }

        .stat-info h3 {
            font-size: 2rem;
            margin-bottom: 0.25rem;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }

        .dashboard-widget {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem 0;
            border-bottom: 1px solid #eee;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        /* Status indicators */
        .sync-status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: #28a745;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .sync-status.warning {
            background: #ffc107;
            color: #212529;
        }

        .sync-status.error {
            background: #dc3545;
        }

        .sync-indicator {
            width: 8px;
            height: 8px;
            background: currentColor;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
            100% { opacity: 1; transform: scale(1); }
        }

        /* Form styles */
        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #333;
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            font-size: 1rem;
            outline: none;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .nav-container {
                flex-direction: column;
                gap: 1rem;
            }

            .nav-menu {
                flex-wrap: wrap;
                justify-content: center;
            }

            .main-content {
                padding: 1rem;
            }

            .dashboard-stats {
                grid-template-columns: 1fr;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .section-header {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-bolt"></i>
                <span>SYNERGIA v3.0</span>
            </div>
            
            <div class="nav-menu" id="nav-menu">
                <a href="#dashboard" class="nav-link active">
                    <i class="fas fa-tachometer-alt"></i>
                    Dashboard
                </a>
                <a href="#team" class="nav-link">
                    <i class="fas fa-users"></i>
                    √âquipe
                </a>
                <a href="#planning" class="nav-link">
                    <i class="fas fa-calendar"></i>
                    Planning
                </a>
                <a href="#chat" class="nav-link">
                    <i class="fas fa-comments"></i>
                    Chat
                </a>
                <a href="#quests" class="nav-link">
                    <i class="fas fa-trophy"></i>
                    Missions
                </a>
                <a href="#settings" class="nav-link">
                    <i class="fas fa-cog"></i>
                    Param√®tres
                </a>
            </div>
            <div class="nav-user">
                <div class="user-avatar">
                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 40 40'%3E%3Crect width='40' height='40' fill='%23667eea'/%3E%3Ctext x='20' y='25' text-anchor='middle' fill='white' font-family='Arial' font-size='16'%3EA%3C/text%3E%3C/svg%3E" alt="Avatar" id="user-avatar">
                </div>
                <span id="user-name">Allan Boehme</span>
                <button id="logout-btn" class="btn-icon">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Contenu principal -->
    <main class="main-content">
        <!-- Dashboard -->
        <section id="dashboard" class="content-section active">
            <div class="section-header">
                <h1>Dashboard</h1>
                <div class="section-actions">
                    <button id="refresh-dashboard" class="btn btn-secondary">
                        <i class="fas fa-sync-alt"></i>
                        Actualiser
                    </button>
                </div>
            </div>

            <div class="dashboard-stats">
                <div class="stat-card">
                    <i class="fas fa-users"></i>
                    <div class="stat-info">
                        <h3 id="team-count">3</h3>
                        <p>Membres d'√©quipe</p>
                    </div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-tasks"></i>
                    <div class="stat-info">
                        <h3 id="active-quests">5</h3>
                        <p>Missions actives</p>
                    </div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-calendar-check"></i>
                    <div class="stat-info">
                        <h3 id="events-today">2</h3>
                        <p>√âv√©nements aujourd'hui</p>
                    </div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-star"></i>
                    <div class="stat-info">
                        <h3 id="user-level">5</h3>
                        <p>Niveau actuel</p>
                    </div>
                </div>
            </div>

            <div class="dashboard-grid">
                <div class="dashboard-widget">
                    <h3><i class="fas fa-history"></i> Derni√®res activit√©s</h3>
                    <div id="recent-activities">
                        <div class="activity-item">
                            <i class="fas fa-rocket" style="color: #667eea;"></i>
                            <span>SYNERGIA v3.0 initialis√© avec Firebase</span>
                            <small style="margin-left: auto; color: #666;">Maintenant</small>
                        </div>
                        <div class="activity-item">
                            <i class="fab fa-google" style="color: #4285f4;"></i>
                            <span>Authentification Firebase active</span>
                            <small style="margin-left: auto; color: #666;">Il y a 2 minutes</small>
                        </div>
                        <div class="activity-item">
                            <i class="fas fa-users" style="color: #28a745;"></i>
                            <span>Utilisateur connect√©: allan.boehme61@gmail.com</span>
                            <small style="margin-left: auto; color: #666;">Il y a 5 minutes</small>
                        </div>
                    </div>
                </div>

                <div class="dashboard-widget">
                    <h3><i class="fas fa-database"></i> Statut Firebase</h3>
                    <div style="text-align: center; padding: 1rem;">
                        <div id="firebase-status-dashboard" class="sync-status" style="margin-bottom: 1rem;">
                            <div class="sync-indicator"></div>
                            <span>Firebase Connect√©</span>
                        </div>
                        <div style="font-size: 0.9rem; color: #666; margin-bottom: 1rem;">
                            <div>Projet: <strong>synergia-app-f27e7</strong></div>
                            <div id="analytics-status-dashboard">Analytics: <span id="analytics-status-text">Chargement...</span></div>
                            <div>Auth: <span id="auth-status-text">Actif</span></div>
                        </div>
                        <button onclick="showFirebaseModal()" class="btn btn-primary">
                            <i class="fas fa-database"></i>
                            G√©rer Firebase
                        </button>
                    </div>
                </div>

                <div class="dashboard-widget">
                    <h3><i class="fas fa-chart-line"></i> Analytics & M√©triques</h3>
                    <div style="text-align: center; padding: 1rem;">
                        <div style="margin-bottom: 1rem;">
                            <div style="font-size: 1.5rem; color: #667eea; margin-bottom: 0.5rem;">1,250</div>
                            <div style="color: #666; font-size: 0.9rem;">Points d'exp√©rience totaux</div>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <div style="font-size: 1.2rem; color: #28a745; margin-bottom: 0.5rem;">87%</div>
                            <div style="color: #666; font-size: 0.9rem;">Taux de completion missions</div>
                        </div>
                        <button onclick="trackCustomEvent()" class="btn btn-secondary">
                            <i class="fas fa-chart-bar"></i>
                            Voir Analytics
                        </button>
                    </div>
                </div>

                <div class="dashboard-widget">
                    <h3><i class="fas fa-cloud"></i> Synchronisation Cloud</h3>
                    <div style="text-align: center; padding: 1rem;">
                        <div id="sync-status-display" class="sync-status" style="margin-bottom: 1rem;">
                            <div class="sync-indicator"></div>
                            <span>Donn√©es synchronis√©es</span>
                        </div>
                        <div style="font-size: 0.9rem; color: #666; margin-bottom: 1rem;">
                            Derni√®re sync: <span id="last-sync-time">Il y a 2 minutes</span>
                        </div>
                        <button onclick="forceSyncData()" class="btn btn-secondary">
                            <i class="fas fa-sync-alt"></i>
                            Forcer la sync
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Param√®tres -->
        <section id="settings" class="content-section">
            <div class="section-header">
                <h1><i class="fas fa-cog"></i> Param√®tres Syst√®me</h1>
                <div class="section-actions">
                    <button onclick="saveAllSettings()" class="btn btn-primary">
                        <i class="fas fa-save"></i>
                        Sauvegarder
                    </button>
                    <button onclick="exportSettings()" class="btn btn-secondary">
                        <i class="fas fa-download"></i>
                        Exporter
                    </button>
                </div>
            </div>

            <!-- Statut Firebase D√©taill√© -->
            <div id="firebase-status" style="background: #e8f5e8; border: 1px solid #28a745; border-radius: 8px; padding: 1rem; margin-bottom: 2rem;">
                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                    <i class="fas fa-database" style="color: #28a745;"></i>
                    <strong style="color: #155724;">Statut Firebase</strong>
                </div>
                <div id="firebase-status-details" style="color: #155724; font-size: 0.9rem;">
                    <div>‚úÖ <strong>App:</strong> Initialis√©</div>
                    <div>‚úÖ <strong>Auth:</strong> Connect√© (alan.boehme61@gmail.com)</div>
                    <div>‚úÖ <strong>Firestore:</strong> Op√©rationnel</div>
                    <div>‚úÖ <strong>Storage:</strong> Disponible</div>
                    <div id="analytics-status-detail">‚ö†Ô∏è <strong>Analytics:</strong> Chargement...</div>
                    <div style="margin-top: 0.5rem;"><strong>Projet:</strong> synergia-app-f27e7</div>
                </div>
            </div>

            <!-- Configuration Firebase -->
            <div style="background: white; border: 1px solid #e9ecef; border-radius: 12px; padding: 2rem; margin-top: 2rem;">
                <h3><i class="fas fa-database"></i> Configuration Firebase</h3>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                    <div>
                        <div class="form-group">
                            <label>API Key</label>
                            <input type="password" id="firebase-api-key" value="AIzaSyD7uBuAQaOhZ02owkZEuMKC5Vji6PrB2f8" readonly>
                        </div>
                        <div class="form-group">
                            <label>Auth Domain</label>
                            <input type="text" id="firebase-auth-domain" value="synergia-app-f27e7.firebaseapp.com" readonly>
                        </div>
                        <div class="form-group">
                            <label>Project ID</label>
                            <input type="text" id="firebase-project-id" value="synergia-app-f27e7" readonly>
                        </div>
                        <div class="form-group">
                            <label>Storage Bucket</label>
                            <input type="text" id="firebase-storage-bucket" value="synergia-app-f27e7.firebasestorage.app" readonly>
                        </div>
                    </div>
                    <div>
                        <div class="form-group">
                            <label>Messaging Sender ID</label>
                            <input type="text" id="firebase-messaging-sender-id" value="201912738922" readonly>
                        </div>
                        <div class="form-group">
                            <label>App ID</label>
                            <input type="text" id="firebase-app-id" value="1:201912738922:web:2fcc1e49293bb632899613" readonly>
                        </div>
                        <div class="form-group">
                            <label>Measurement ID (Analytics)</label>
                            <input type="text" id="firebase-measurement-id" value="G-EGJ79SCMWX" readonly>
                        </div>
                        <div class="form-group">
                            <label>Statut Analytics</label>
                            <div id="analytics-config-status" style="padding: 0.75rem; background: #fff3cd; border: 1px solid #ffc107; border-radius: 8px; color: #856404;">
                                <i class="fas fa-exclamation-triangle"></i> V√©rification en cours...
                            </div>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 1.5rem; text-align: center;">
                    <button onclick="testFirebaseConnection()" class="btn btn-primary">
                        <i class="fas fa-plug"></i> Tester la connexion
                    </button>
                    <button onclick="initializeFirebaseData()" class="btn btn-secondary">
                        <i class="fas fa-database"></i> Initialiser les donn√©es
                    </button>
                    <button onclick="testAnalytics()" class="btn btn-secondary">
                        <i class="fas fa-chart-bar"></i> Tester Analytics
                    </button>
                </div>
            </div>

            <!-- Outils de d√©veloppement -->
            <div style="background: white; border: 1px solid #e9ecef; border-radius: 12px; padding: 2rem; margin-top: 2rem;">
                <h3><i class="fas fa-tools"></i> Outils de D√©veloppement</h3>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                    <div style="text-align: center; padding: 1.5rem; border: 1px solid #e9ecef; border-radius: 8px;">
                        <i class="fas fa-console" style="font-size: 2rem; color: #667eea; margin-bottom: 1rem;"></i>
                        <h4>Console Logs</h4>
                        <p style="color: #666; font-size: 0.9rem; margin-bottom: 1rem;">Voir les logs de d√©bogage</p>
                        <button onclick="showConsoleLogs()" class="btn btn-secondary">
                            <i class="fas fa-terminal"></i> Ouvrir Console
                        </button>
                    </div>
                    
                    <div style="text-align: center; padding: 1.5rem; border: 1px solid #e9ecef; border-radius: 8px;">
                        <i class="fas fa-bug" style="font-size: 2rem; color: #28a745; margin-bottom: 1rem;"></i>
                        <h4>Mode Debug</h4>
                        <p style="color: #666; font-size: 0.9rem; margin-bottom: 1rem;">Activer le mode d√©bogage</p>
                        <button onclick="toggleDebugMode()" class="btn btn-secondary">
                            <i class="fas fa-bug"></i> <span id="debug-btn-text">Activer Debug</span>
                        </button>
                    </div>
                    
                    <div style="text-align: center; padding: 1.5rem; border: 1px solid #e9ecef; border-radius: 8px;">
                        <i class="fas fa-download" style="font-size: 2rem; color: #ffc107; margin-bottom: 1rem;"></i>
                        <h4>Export Donn√©es</h4>
                        <p style="color: #666; font-size: 0.9rem; margin-bottom: 1rem;">Exporter toutes les donn√©es</p>
                        <button onclick="exportAllData()" class="btn btn-secondary">
                            <i class="fas fa-file-export"></i> Exporter
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Team (placeholder) -->
        <section id="team" class="content-section">
            <div class="section-header">
                <h1><i class="fas fa-users"></i> Gestion d'√©quipe</h1>
                <div class="section-actions">
                    <button class="btn btn-primary">
                        <i class="fas fa-user-plus"></i>
                        Ajouter membre
                    </button>
                </div>
            </div>
            <p>Section √©quipe en d√©veloppement...</p>
        </section>

        <!-- Planning (placeholder) -->
        <section id="planning" class="content-section">
            <div class="section-header">
                <h1><i class="fas fa-calendar"></i> Planning</h1>
                <div class="section-actions">
                    <button class="btn btn-primary">
                        <i class="fas fa-plus"></i>
                        Nouvel √©v√©nement
                    </button>
                </div>
            </div>
            <p>Section planning en d√©veloppement...</p>
        </section>

        <!-- Chat (placeholder) -->
        <section id="chat" class="content-section">
            <div class="section-header">
                <h1><i class="fas fa-comments"></i> Chat d'√©quipe</h1>
            </div>
            <p>Section chat en d√©veloppement...</p>
        </section>

        <!-- Quests (placeholder) -->
        <section id="quests" class="content-section">
            <div class="section-header">
                <h1><i class="fas fa-trophy"></i> Missions & R√©compenses</h1>
            </div>
            <p>Section missions en d√©veloppement...</p>
        </section>
    </main>

    <script>
        // Variables globales
        let currentUser = null;
        let isFirebaseReady = false;
        let isAnalyticsReady = false;
        let isDebugMode = false;

        // V√©rification de l'√©tat Firebase et Analytics
        function checkFirebaseStatus() {
            if (window.firebaseReady) {
                console.log('‚úÖ Firebase pr√™t et configur√©');
                isFirebaseReady = true;
                isAnalyticsReady = window.analyticsReady || false;
                
                updateFirebaseStatusDisplay();
                updateAnalyticsStatus();
                setupFirebaseAuth();
            } else {
                console.log('‚ùå Firebase non disponible');
                setTimeout(checkFirebaseStatus, 1000);
            }
        }

        // Mise √† jour de l'affichage du statut Firebase
        function updateFirebaseStatusDisplay() {
            // Dashboard
            const dashboardStatus = document.getElementById('firebase-status-dashboard');
            if (dashboardStatus && isFirebaseReady) {
                dashboardStatus.className = 'sync-status';
                dashboardStatus.innerHTML = '<div class="sync-indicator"></div><span>Firebase Connect√©</span>';
            }

            // Settings - Statut d√©taill√©
            const analyticsDetail = document.getElementById('analytics-status-detail');
            if (analyticsDetail) {
                if (isAnalyticsReady) {
                    analyticsDetail.innerHTML = '‚úÖ <strong>Analytics:</strong> Op√©rationnel';
                } else {
                    analyticsDetail.innerHTML = '‚ö†Ô∏è <strong>Analytics:</strong> Indisponible (CSP)';
                }
            }

            // Status de configuration Analytics
            const analyticsConfigStatus = document.getElementById('analytics-config-status');
            if (analyticsConfigStatus) {
                if (isAnalyticsReady) {
                    analyticsConfigStatus.style.background = '#d4edda';
                    analyticsConfigStatus.style.borderColor = '#28a745';
                    analyticsConfigStatus.style.color = '#155724';
                    analyticsConfigStatus.innerHTML = '<i class="fas fa-check-circle"></i> Analytics op√©rationnel';
                } else {
                    analyticsConfigStatus.style.background = '#fff3cd';
                    analyticsConfigStatus.style.borderColor = '#ffc107';
                    analyticsConfigStatus.style.color = '#856404';
                    analyticsConfigStatus.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Analytics indisponible (CSP/Bloqueur pub)';
                }
            }
        }

        // Mise √† jour du statut Analytics
        function updateAnalyticsStatus() {
            const dashboardAnalyticsStatus = document.getElementById('analytics-status-text');
            const authStatus = document.getElementById('auth-status-text');
            
            if (dashboardAnalyticsStatus) {
                dashboardAnalyticsStatus.textContent = isAnalyticsReady ? 'Actif' : 'Indisponible';
                dashboardAnalyticsStatus.style.color = isAnalyticsReady ? '#28a745' : '#ffc107';
            }

            if (authStatus) {
                authStatus.textContent = currentUser ? 'Connect√©' : 'Non connect√©';
                authStatus.style.color = currentUser ? '#28a745' : '#dc3545';
            }
        }

        // Configuration de l'authentification Firebase
        function setupFirebaseAuth() {
            if (!isFirebaseReady) return;
            
            window.firebase.onAuthStateChanged(window.auth, (user) => {
                if (user) {
                    currentUser = user;
                    console.log(`üë§ Utilisateur connect√©: ${user.email}`);
                    document.getElementById('user-name').textContent = user.displayName || user.email.split('@')[0];
                    updateAnalyticsStatus();
                    
                    // Mettre √† jour les activit√©s
                    updateRecentActivities('Utilisateur connect√©: ' + user.email);
                } else {
                    console.log('üë§ Aucun utilisateur connect√©');
                    currentUser = null;
                    updateAnalyticsStatus();
                }
            });
        }

        // Test de connexion Firebase
        function testFirebaseConnection() {
            if (!isFirebaseReady) {
                showNotification('‚ùå Firebase non disponible', 'error');
                return;
            }

            showNotification('üîç Test de connexion Firebase...', 'info');
            
            // Test d'√©criture dans Firestore
            const testDoc = {
                test: true,
                timestamp: window.firebase.serverTimestamp(),
                message: 'Test de connexion SYNERGIA v3.0',
                user: currentUser ? currentUser.email : 'anonyme'
            };
            
            window.firebase.addDoc(
                window.firebase.collection(window.db, 'tests'), 
                testDoc
            ).then((docRef) => {
                showNotification('‚úÖ Connexion Firebase et Firestore r√©ussie!', 'success');
                console.log('üìù Document test cr√©√©:', docRef.id);
                
                // Supprimer le document test apr√®s 5 secondes
                setTimeout(() => {
                    window.firebase.deleteDoc(window.firebase.doc(window.db, 'tests', docRef.id))
                        .then(() => console.log('üßπ Document test supprim√©'))
                        .catch(e => console.log('‚ö†Ô∏è Erreur suppression test:', e));
                }, 5000);
                
            }).catch((error) => {
                showNotification('‚ùå Erreur test Firestore: ' + error.message, 'error');
                console.error('‚ùå Erreur test:', error);
            });
        }

        // Test Analytics (si disponible)
        function testAnalytics() {
            if (isAnalyticsReady && window.analytics) {
                showNotification('üìä Test Analytics...', 'info');
                
                try {
                    // Importer et utiliser logEvent
                    import('https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js')
                        .then(({ logEvent }) => {
                            logEvent(window.analytics, 'synergia_test_event', {
                                event_category: 'test',
                                event_label: 'manual_test',
                                value: 1
                            });
                            showNotification('‚úÖ √âv√©nement Analytics envoy√©!', 'success');
                        })
                        .catch(error => {
                            showNotification('‚ùå Erreur test Analytics: ' + error.message, 'error');
                        });
                } catch (error) {
                    showNotification('‚ùå Analytics non disponible: ' + error.message, 'error');
                }
            } else {
                showNotification('‚ö†Ô∏è Analytics non disponible (CSP ou bloqueur)', 'warning');
            }
        }

        // Suivre un √©v√©nement personnalis√©
        function trackCustomEvent() {
            if (isAnalyticsReady && window.analytics) {
                import('https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js')
                    .then(({ logEvent }) => {
                        logEvent(window.analytics, 'dashboard_analytics_view', {
                            event_category: 'engagement',
                            event_label: 'dashboard_widget',
                            user_id: currentUser ? currentUser.uid : 'anonymous'
                        });
                        showNotification('üìä √âv√©nement Analytics enregistr√©', 'success');
                    })
                    .catch(error => {
                        console.warn('Analytics error:', error);
                    });
            } else {
                showNotification('üìä Simulation √©v√©nement Analytics (non disponible)', 'info');
            }
        }

        // Initialiser les donn√©es Firebase
        function initializeFirebaseData() {
            if (!isFirebaseReady) {
                showNotification('‚ùå Firebase non disponible', 'error');
                return;
            }
            
            showNotification('üöÄ Initialisation des donn√©es Firebase...', 'info');
            
            const collections = ['users', 'teams', 'projects', 'missions', 'events'];
            let initialized = 0;
            
            collections.forEach(async (collectionName) => {
                try {
                    const initDoc = {
                        initialized: true,
                        createdAt: window.firebase.serverTimestamp(),
                        version: '3.0',
                        createdBy: currentUser ? currentUser.email : 'system'
                    };
                    
                    await window.firebase.addDoc(
                        window.firebase.collection(window.db, collectionName),
                        initDoc
                    );
                    
                    initialized++;
                    console.log(`‚úÖ Collection ${collectionName} initialis√©e`);
                    
                    if (initialized === collections.length) {
                        showNotification('‚úÖ Toutes les collections initialis√©es!', 'success');
                        updateRecentActivities('Collections Firebase initialis√©es');
                    }
                } catch (error) {
                    console.error(`‚ùå Erreur initialisation ${collectionName}:`, error);
                    showNotification(`‚ùå Erreur ${collectionName}: ${error.message}`, 'error');
                }
            });
        }

        // Forcer la synchronisation des donn√©es
        function forceSyncData() {
            showNotification('üîÑ Synchronisation forc√©e...', 'info');
            
            // Simuler la synchronisation
            setTimeout(() => {
                const now = new Date();
                document.getElementById('last-sync-time').textContent = '√Ä l\'instant';
                showNotification('‚úÖ Synchronisation termin√©e!', 'success');
                updateRecentActivities('Synchronisation des donn√©es forc√©e');
            }, 2000);
        }

        // Sauvegarde des param√®tres
        function saveAllSettings() {
            showNotification('üíæ Sauvegarde des param√®tres...', 'info');
            
            if (isFirebaseReady && currentUser) {
                const settings = {
                    userId: currentUser.uid,
                    firebaseConfig: {
                        projectId: 'synergia-app-f27e7',
                        analyticsEnabled: isAnalyticsReady
                    },
                    userPreferences: {
                        debugMode: isDebugMode,
                        lastSave: new Date().toISOString()
                    },
                    updatedAt: window.firebase.serverTimestamp()
                };
                
                window.firebase.setDoc(
                    window.firebase.doc(window.db, 'user-settings', currentUser.uid),
                    settings
                ).then(() => {
                    showNotification('‚úÖ Param√®tres sauvegard√©s dans Firebase!', 'success');
                    updateRecentActivities('Param√®tres utilisateur sauvegard√©s');
                }).catch((error) => {
                    showNotification('‚ùå Erreur sauvegarde: ' + error.message, 'error');
                });
            } else {
                // Sauvegarde locale
                const localSettings = {
                    saved: true,
                    timestamp: new Date().toISOString(),
                    debugMode: isDebugMode
                };
                localStorage.setItem('synergia-settings', JSON.stringify(localSettings));
                showNotification('‚úÖ Param√®tres sauvegard√©s localement!', 'success');
            }
        }

        // Export des param√®tres
        function exportSettings() {
            const settings = {
                exportDate: new Date().toISOString(),
                firebaseStatus: {
                    ready: isFirebaseReady,
                    analyticsReady: isAnalyticsReady,
                    userConnected: !!currentUser,
                    userEmail: currentUser ? currentUser.email : null
                },
                configuration: {
                    projectId: 'synergia-app-f27e7',
                    debugMode: isDebugMode
                },
                version: '3.0'
            };
            
            const blob = new Blob([JSON.stringify(settings, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `synergia_config_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('üì• Configuration export√©e!', 'success');
        }

        // Export de toutes les donn√©es
        function exportAllData() {
            showNotification('üì¶ Export des donn√©es en cours...', 'info');
            
            // Simuler l'export
            setTimeout(() => {
                const data = {
                    exportDate: new Date().toISOString(),
                    userData: {
                        email: currentUser ? currentUser.email : null,
                        level: 5,
                        xp: 1250
                    },
                    stats: {
                        teamCount: 3,
                        activeQuests: 5,
                        eventsToday: 2
                    },
                    systemInfo: {
                        firebase: isFirebaseReady,
                        analytics: isAnalyticsReady,
                        version: '3.0'
                    }
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `synergia_data_export_${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
                showNotification('‚úÖ Donn√©es export√©es!', 'success');
            }, 1500);
        }

        // Toggle mode debug
        function toggleDebugMode() {
            isDebugMode = !isDebugMode;
            const btn = document.getElementById('debug-btn-text');
            btn.textContent = isDebugMode ? 'D√©sactiver Debug' : 'Activer Debug';
            
            if (isDebugMode) {
                console.log('üêõ Mode debug activ√©');
                showNotification('üêõ Mode debug activ√©', 'info');
                // Afficher plus d'infos dans la console
                console.log('üìä √âtat Firebase:', { isFirebaseReady, isAnalyticsReady });
                console.log('üë§ Utilisateur:', currentUser);
            } else {
                console.log('üêõ Mode debug d√©sactiv√©');
                showNotification('Mode debug d√©sactiv√©', 'info');
            }
        }

        // Afficher les logs de la console
        function showConsoleLogs() {
            showNotification('üñ•Ô∏è Consultez la console du navigateur (F12)', 'info');
            console.log('üìù === SYNERGIA v3.0 DEBUG LOGS ===');
            console.log('üîß Firebase Status:', {
                ready: isFirebaseReady,
                analytics: isAnalyticsReady,
                user: currentUser ? currentUser.email : null,
                timestamp: new Date().toISOString()
            });
            console.log('üåê Browser Info:', {
                userAgent: navigator.userAgent,
                language: navigator.language,
                cookieEnabled: navigator.cookieEnabled
            });
            console.log('üìä App State:', {
                debugMode: isDebugMode,
                currentSection: document.querySelector('.nav-link.active')?.textContent?.trim()
            });
        }

        // Mettre √† jour les activit√©s r√©centes
        function updateRecentActivities(activity) {
            const activitiesContainer = document.getElementById('recent-activities');
            if (!activitiesContainer) return;
            
            const activityElement = document.createElement('div');
            activityElement.className = 'activity-item';
            activityElement.innerHTML = `
                <i class="fas fa-info-circle" style="color: #667eea;"></i>
                <span>${activity}</span>
                <small style="margin-left: auto; color: #666;">√Ä l'instant</small>
            `;
            
            // Ajouter en premier
            activitiesContainer.insertBefore(activityElement, activitiesContainer.firstChild);
            
            // Garder seulement les 5 derni√®res activit√©s
            const activities = activitiesContainer.children;
            if (activities.length > 5) {
                activitiesContainer.removeChild(activities[activities.length - 1]);
            }
        }

        // Actualisation du dashboard
        function refreshDashboard() {
            showNotification('üîÑ Actualisation du dashboard...', 'info');
            
            // Simuler le chargement de nouvelles donn√©es
            setTimeout(() => {
                // Mise √† jour des statistiques avec des valeurs al√©atoires
                const newTeamCount = Math.floor(Math.random() * 10) + 1;
                const newQuestCount = Math.floor(Math.random() * 15) + 1;
                const newEventCount = Math.floor(Math.random() * 5) + 1;
                
                document.getElementById('team-count').textContent = newTeamCount;
                document.getElementById('active-quests').textContent = newQuestCount;
                document.getElementById('events-today').textContent = newEventCount;
                
                // Mettre √† jour l'heure de derni√®re sync
                document.getElementById('last-sync-time').textContent = '√Ä l\'instant';
                
                showNotification('‚úÖ Dashboard actualis√©!', 'success');
                updateRecentActivities('Dashboard actualis√© avec nouvelles donn√©es');
                
                // Tracker l'√©v√©nement si Analytics disponible
                if (isAnalyticsReady && window.analytics) {
                    import('https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js')
                        .then(({ logEvent }) => {
                            logEvent(window.analytics, 'dashboard_refresh', {
                                event_category: 'user_action',
                                value: 1
                            });
                        })
                        .catch(e => console.log('Analytics log error:', e));
                }
            }, 1500);
        }

        // Syst√®me de notifications am√©lior√©
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: white;
                padding: 1rem 1.5rem;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                z-index: 3000;
                border-left: 4px solid ${type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : type === 'warning' ? '#ffc107' : '#667eea'};
                animation: slideInRight 0.3s ease;
                max-width: 350px;
            `;
            
            const icons = {
                success: 'check-circle',
                error: 'exclamation-triangle',
                warning: 'exclamation-triangle',
                info: 'info-circle'
            };
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <i class="fas fa-${icons[type]}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Navigation
        function setupNavigation() {
            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('.content-section');

            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    
                    navLinks.forEach(l => l.classList.remove('active'));
                    link.classList.add('active');
                    
                    sections.forEach(section => section.classList.remove('active'));
                    
                    const targetId = link.getAttribute('href').substring(1);
                    const targetSection = document.getElementById(targetId);
                    if (targetSection) {
                        targetSection.classList.add('active');
                        
                        // Tracker la navigation si Analytics disponible
                        if (isAnalyticsReady && window.analytics) {
                            import('https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js')
                                .then(({ logEvent }) => {
                                    logEvent(window.analytics, 'page_view', {
                                        page_title: targetId,
                                        page_location: window.location.href + '#' + targetId
                                    });
                                })
                                .catch(e => console.log('Analytics navigation error:', e));
                        }
                    }
                });
            });
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Initialisation SYNERGIA v3.0...');
            
            setupNavigation();
            checkFirebaseStatus();
            
            // Event listeners
            document.getElementById('refresh-dashboard')?.addEventListener('click', refreshDashboard);
            document.getElementById('logout-btn')?.addEventListener('click', () => {
                if (confirm('Voulez-vous vraiment vous d√©connecter ?')) {
                    if (window.firebase && window.auth) {
                        window.firebase.signOut(window.auth);
                    }
                    showNotification('üëã √Ä bient√¥t !', 'info');
                }
            });
            
            // Styles d'animation pour les notifications
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideInRight {
                    from { opacity: 0; transform: translateX(100px); }
                    to { opacity: 1; transform: translateX(0); }
                }
                @keyframes slideOutRight {
                    from { opacity: 1; transform: translateX(0); }
                    to { opacity: 0; transform: translateX(100px); }
                }
            `;
            document.head.appendChild(style);
            
            // Message de bienvenue apr√®s un d√©lai
            setTimeout(() => {
                showNotification('üéâ SYNERGIA v3.0 initialis√© avec Firebase!', 'success');
                updateRecentActivities('Application SYNERGIA v3.0 d√©marr√©e');
            }, 1000);
            
            // Mise √† jour p√©riodique du statut
            setInterval(() => {
                if (isFirebaseReady) {
                    const now = new Date();
                    const timeStr = now.toLocaleTimeString('fr-FR', { 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    });
                    // Mise √† jour discr√®te de l'heure (optionnel)
                }
            }, 60000); // Toutes les minutes
            
            console.log('‚úÖ SYNERGIA v3.0 pr√™t !');
        });

        // Modal Firebase (placeholder)
        function showFirebaseModal() {
            showNotification('üîß Modal Firebase en d√©veloppement', 'info');
        }
    </script>
</body>
</html>
