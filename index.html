<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SYNERGIA v3.0 - Gestion d'√©quipe</title>
    
    <!-- CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    
    <!-- Chart.js depuis CDN autoris√© -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, updateProfile } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, doc, addDoc, updateDoc, deleteDoc, getDocs, getDoc, onSnapshot, setDoc, query, where, orderBy, limit, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getStorage, ref, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js';

        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAXY8_QmKpS5r6P2zNbX4UqP4WaEgOyj6M",
            authDomain: "synergia-app-f27e7.firebaseapp.com",
            projectId: "synergia-app-f27e7",
            storageBucket: "synergia-app-f27e7.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abcdef123456"
        };

        // Initialisation Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // Rendre disponible globalement
        window.auth = auth;
        window.db = db;
        window.storage = storage;
        window.firebase = { 
            auth, 
            db, 
            storage,
            collection, 
            doc, 
            addDoc, 
            updateDoc, 
            deleteDoc, 
            getDocs, 
            getDoc, 
            onSnapshot, 
            setDoc, 
            query, 
            where, 
            orderBy, 
            limit,
            serverTimestamp,
            onAuthStateChanged,
            signInWithEmailAndPassword,
            createUserWithEmailAndPassword,
            signOut,
            updateProfile,
            ref,
            uploadBytes,
            getDownloadURL
        };

        console.log('‚úÖ Firebase initialized');
    </script>

    <style>
        /* Styles CSS int√©gr√©s pour assurer le fonctionnement */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 0;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
        }

        .nav-logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }

        .nav-menu {
            display: flex;
            gap: 2rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            text-decoration: none;
            color: #666;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .nav-link:hover,
        .nav-link.active {
            color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .nav-user {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-avatar img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .main-content {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .content-section {
            display: none;
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .content-section.active {
            display: block;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f0f0f0;
        }

        .section-header h1 {
            color: #333;
            font-size: 2rem;
        }

        .section-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 1px solid #dee2e6;
        }

        .btn-secondary:hover {
            background: #e9ecef;
        }

        .btn-icon {
            padding: 0.5rem;
            border: none;
            background: transparent;
            border-radius: 6px;
            cursor: pointer;
            color: #666;
            transition: all 0.3s ease;
        }

        .btn-icon:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }

        .search-input {
            padding: 0.75rem 1rem;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            width: 300px;
            font-size: 1rem;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* Dashboard Styles */
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 1.5rem;
            border-radius: 12px;
            color: white;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .stat-card i {
            font-size: 2rem;
            opacity: 0.8;
        }

        .stat-info h3 {
            font-size: 2rem;
            margin-bottom: 0.25rem;
        }

        .stat-info p {
            opacity: 0.9;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }

        .dashboard-widget {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .dashboard-widget h3 {
            margin-bottom: 1rem;
            color: #333;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem 0;
            border-bottom: 1px solid #eee;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-item i {
            color: #667eea;
        }

        .activity-item small {
            margin-left: auto;
            color: #666;
            font-size: 0.85rem;
        }

        /* Team Styles */
        .team-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .team-member-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .team-member-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .team-member-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .member-avatar {
            position: relative;
            width: 60px;
            height: 60px;
            margin-bottom: 1rem;
        }

        .member-avatar img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }

        .status-indicator {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 2px solid white;
        }

        .status-indicator.online {
            background: #28a745;
        }

        .status-indicator.away {
            background: #ffc107;
        }

        .status-indicator.offline {
            background: #6c757d;
        }

        .member-info h3 {
            margin-bottom: 0.5rem;
            color: #333;
        }

        .member-role {
            color: #667eea;
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .member-email {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .member-stats {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .member-level,
        .member-xp {
            background: #f8f9fa;
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            font-size: 0.85rem;
            color: #333;
        }

        .member-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
        }

        .member-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
        }

        .no-members {
            text-align: center;
            padding: 3rem;
            color: #666;
        }

        .no-members i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #ccc;
        }

        /* Planning Styles */
        .planning-container {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 2rem;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .calendar-header h2 {
            color: #333;
        }

        .calendar-grid {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 1rem;
            min-height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
        }

        .events-sidebar {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 1.5rem;
        }

        .events-sidebar h3 {
            margin-bottom: 1rem;
            color: #333;
        }

        /* Chat Styles */
        .chat-container {
            display: grid;
            grid-template-columns: 300px 1fr;
            height: 600px;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            overflow: hidden;
        }

        .chat-sidebar {
            background: #f8f9fa;
            border-right: 1px solid #e9ecef;
        }

        .chat-header {
            padding: 1rem;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-header h3 {
            color: #333;
        }

        .chat-main {
            display: flex;
            flex-direction: column;
        }

        .messages-area {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            background: #fafafa;
        }

        .welcome-message {
            text-align: center;
            padding: 3rem;
            color: #666;
        }

        .welcome-message i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #ccc;
        }

        .message-input-container {
            padding: 1rem;
            border-top: 1px solid #e9ecef;
            background: white;
        }

        .message-input {
            display: flex;
            gap: 0.5rem;
        }

        .message-input input {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            outline: none;
        }

        .message-input input:focus {
            border-color: #667eea;
        }

        .btn-send {
            padding: 0.75rem 1rem;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        .btn-send:hover {
            background: #5a6fd8;
        }

        /* Quests Styles */
        .user-progress {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 1.5rem;
            border-radius: 12px;
            color: white;
            margin-bottom: 2rem;
        }

        .level-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .xp-bar {
            flex: 1;
            height: 8px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            overflow: hidden;
        }

        .xp-fill {
            height: 100%;
            background: white;
            border-radius: 4px;
            width: 60%;
            transition: width 0.3s ease;
        }

        .quests-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
        }

        .quest-tab {
            padding: 0.75rem 1.5rem;
            border: none;
            background: #f8f9fa;
            color: #666;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quest-tab.active,
        .quest-tab:hover {
            background: #667eea;
            color: white;
        }

        .quests-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .quest-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .quest-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .quest-icon {
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .quest-info h3 {
            margin-bottom: 0.5rem;
            color: #333;
        }

        .quest-info p {
            color: #666;
            margin-bottom: 1rem;
        }

        .quest-reward {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .xp-reward {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.85rem;
        }

        .quest-type {
            background: #f8f9fa;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.85rem;
            color: #666;
        }

        .badges-section {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 12px;
        }

        .badges-section h3 {
            margin-bottom: 1rem;
            color: #333;
        }

        .badges-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 1rem;
        }

        /* Analytics Styles */
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .analytics-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            padding: 1.5rem;
        }

        .analytics-card h3 {
            margin-bottom: 1rem;
            color: #333;
        }

        .analytics-card canvas {
            max-height: 300px;
        }

        .chart-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
            justify-content: center;
        }

        .btn-small {
            padding: 0.25rem 0.5rem;
            border: 1px solid #dee2e6;
            background: white;
            color: #666;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
        }

        .btn-small:hover {
            background: #f8f9fa;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .stat {
            text-align: center;
            padding: 1rem;
        }

        .stat-value {
            display: block;
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 0.25rem;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        .reports-section {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 12px;
        }

        .reports-section h3 {
            margin-bottom: 1rem;
            color: #333;
        }

        .reports-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .report-card {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid #e9ecef;
        }

        .report-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .report-card i {
            font-size: 2rem;
            color: #667eea;
            margin-bottom: 1rem;
        }

        .report-card h4 {
            margin-bottom: 0.5rem;
            color: #333;
        }

        .report-card p {
            color: #666;
            font-size: 0.9rem;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 2rem;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            position: relative;
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-content h2 {
            margin-bottom: 1.5rem;
            color: #333;
        }

        .close {
            position: absolute;
            right: 1rem;
            top: 1rem;
            font-size: 1.5rem;
            font-weight: bold;
            color: #aaa;
            cursor: pointer;
        }

        .close:hover {
            color: #333;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #333;
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            font-size: 1rem;
            outline: none;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
        }

        .select-input {
            padding: 0.5rem;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            outline: none;
        }

        .select-input:focus {
            border-color: #667eea;
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 3000;
            animation: slideInRight 0.3s ease;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .level-up-notification,
        .badge-notification {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .notification-content {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .notification-content i {
            font-size: 1.5rem;
        }

        /* Context Menu */
        .member-context-menu {
            position: absolute;
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 2000;
            min-width: 200px;
        }

        .context-menu-item {
            padding: 0.75rem 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #333;
            transition: background 0.2s ease;
        }

        .context-menu-item:hover {
            background: #f8f9fa;
        }

        .context-menu-item i {
            color: #666;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .nav-container {
                flex-direction: column;
                gap: 1rem;
            }

            .nav-menu {
                flex-wrap: wrap;
                justify-content: center;
            }

            .main-content {
                padding: 0 1rem;
            }

            .content-section {
                padding: 1rem;
            }

            .section-header {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }

            .section-actions {
                width: 100%;
                justify-content: space-between;
            }

            .search-input {
                width: 100%;
            }

            .dashboard-stats {
                grid-template-columns: 1fr;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .team-grid {
                grid-template-columns: 1fr;
            }

            .planning-container {
                grid-template-columns: 1fr;
            }

            .chat-container {
                grid-template-columns: 1fr;
                height: auto;
            }

            .analytics-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                margin: 10% auto;
                width: 95%;
            }
        }

        /* Animations et transitions */
        .animate-fade-in {
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .animate-slide-up {
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Loading States */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .btn-logout {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .btn-logout:hover {
            background: rgba(220, 53, 69, 0.1);
            color: #dc3545;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-bolt"></i>
                <span>SYNERGIA v3.0</span>
            </div>
            <div class="nav-menu">
                <a href="#dashboard" class="nav-link active">
                    <i class="fas fa-tachometer-alt"></i>
                    Dashboard
                </a>
                <a href="#team" class="nav-link">
                    <i class="fas fa-users"></i>
                    √âquipe
                </a>
                <a href="#planning" class="nav-link">
                    <i class="fas fa-calendar"></i>
                    Planning
                </a>
                <a href="#chat" class="nav-link">
                    <i class="fas fa-comments"></i>
                    Chat
                </a>
                <a href="#quests" class="nav-link">
                    <i class="fas fa-trophy"></i>
                    Missions
                </a>
                <a href="#analytics" class="nav-link">
                    <i class="fas fa-chart-bar"></i>
                    Analytics
                </a>
            </div>
            <div class="nav-user">
                <div class="user-avatar">
                    <img src="assets/default-avatar.png" alt="Avatar" id="user-avatar">
                </div>
                <span id="user-name">Utilisateur</span>
                <button id="logout-btn" class="btn-logout">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Contenu principal -->
    <main class="main-content">
        <!-- Dashboard -->
        <section id="dashboard" class="content-section active animate-fade-in">
            <div class="section-header">
                <h1>Dashboard</h1>
                <div class="section-actions">
                    <button id="refresh-dashboard" class="btn btn-secondary">
                        <i class="fas fa-sync-alt"></i>
                        Actualiser
                    </button>
                </div>
            </div>

            <div class="dashboard-stats">
                <div class="stat-card animate-slide-up">
                    <i class="fas fa-users"></i>
                    <div class="stat-info">
                        <h3 id="team-count">0</h3>
                        <p>Membres d'√©quipe</p>
                    </div>
                </div>
                <div class="stat-card animate-slide-up">
                    <i class="fas fa-tasks"></i>
                    <div class="stat-info">
                        <h3 id="active-quests">0</h3>
                        <p>Missions actives</p>
                    </div>
                </div>
                <div class="stat-card animate-slide-up">
                    <i class="fas fa-calendar-check"></i>
                    <div class="stat-info">
                        <h3 id="events-today">0</h3>
                        <p>√âv√©nements aujourd'hui</p>
                    </div>
                </div>
                <div class="stat-card animate-slide-up">
                    <i class="fas fa-star"></i>
                    <div class="stat-info">
                        <h3 id="user-level">1</h3>
                        <p>Niveau actuel</p>
                    </div>
                </div>
            </div>

            <div class="dashboard-grid">
                <div class="dashboard-widget animate-slide-up">
                    <h3><i class="fas fa-history"></i> Derni√®res activit√©s</h3>
                    <div id="recent-activities">
                        <div class="activity-item">
                            <i class="fas fa-rocket"></i>
                            <span>SYNERGIA v3.0 initialis√© avec succ√®s</span>
                            <small>Maintenant</small>
                        </div>
                        <div class="activity-item">
                            <i class="fas fa-users"></i>
                            <span>√âquipe charg√©e</span>
                            <small>Il y a 1 minute</small>
                        </div>
                        <div class="activity-item">
                            <i class="fas fa-trophy"></i>
                            <span>Missions disponibles</span>
                            <small>Il y a 2 minutes</small>
                        </div>
                    </div>
                </div>

                <div class="dashboard-widget animate-slide-up">
                    <h3><i class="fas fa-tasks"></i> Missions du jour</h3>
                    <div id="daily-quests-preview">
                        <div class="activity-item">
                            <i class="fas fa-clock"></i>
                            <span>Pointer son arriv√©e</span>
                            <small>50 XP</small>
                        </div>
                        <div class="activity-item">
                            <i class="fas fa-comments"></i>
                            <span>Message d'√©quipe</span>
                            <small>30 XP</small>
                        </div>
                        <div class="activity-item">
                            <i class="fas fa-star"></i>
                            <span>Journ√©e parfaite</span>
                            <small>100 XP</small>
                        </div>
                    </div>
                </div>

                <div class="dashboard-widget animate-slide-up">
                    <h3><i class="fas fa-user-friends"></i> √âquipe en ligne</h3>
                    <div id="online-team-members">
                        <div class="activity-item">
                            <i class="fas fa-circle" style="color: #28a745;"></i>
                            <span>Allan Boehme</span>
                            <small>En ligne</small>
                        </div>
                        <div class="activity-item">
                            <i class="fas fa-circle" style="color: #28a745;"></i>
                            <span>Polar Caron</span>
                            <small>En ligne</small>
                        </div>
                        <div class="activity-item">
                            <i class="fas fa-circle" style="color: #ffc107;"></i>
                            <span>Marie Dubois</span>
                            <small>Absent</small>
                        </div>
                    </div>
                </div>

                <div class="dashboard-widget animate-slide-up">
                    <h3><i class="fas fa-chart-line"></i> Progression XP</h3>
                    <div style="text-align: center; padding: 2rem;">
                        <div style="font-size: 2rem; color: #667eea; margin-bottom: 0.5rem;">1,250</div>
                        <div style="color: #666;">XP Total</div>
                        <div style="margin-top: 1rem;">
                            <div class="xp-bar" style="background: #e9ecef;">
                                <div class="xp-fill" style="width: 60%; background: #667eea;"></div>
                            </div>
                            <small style="color: #666;">Niveau 5 - 60% vers niveau 6</small>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- √âquipe -->
        <section id="team" class="content-section">
            <div class="section-header">
                <h1><i class="fas fa-users"></i> Gestion d'√©quipe</h1>
                <div class="section-actions">
                    <input type="text" id="team-search" placeholder="Rechercher un membre..." class="search-input">
                    <button id="add-member-btn" class="btn btn-primary">
                        <i class="fas fa-user-plus"></i>
                        Ajouter un membre
                    </button>
                    <button id="export-team-btn" class="btn btn-secondary">
                        <i class="fas fa-download"></i>
                        Exporter
                    </button>
                </div>
            </div>

            <div class="team-container">
                <div id="team-members-list" class="team-grid">
                    <!-- Les membres seront charg√©s dynamiquement -->
                    <div class="loading-placeholder" style="text-align: center; padding: 3rem; color: #666;">
                        <div class="loading"></div>
                        <p style="margin-top: 1rem;">Chargement de l'√©quipe...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Planning -->
        <section id="planning" class="content-section">
            <div class="section-header">
                <h1><i class="fas fa-calendar"></i> Planning d'√©quipe</h1>
                <div class="section-actions">
                    <select id="planning-view" class="select-input">
                        <option value="month">Vue mensuelle</option>
                        <option value="week">Vue hebdomadaire</option>
                        <option value="day">Vue journali√®re</option>
                    </select>
                    <button id="add-event-btn" class="btn btn-primary">
                        <i class="fas fa-plus"></i>
                        Nouvel √©v√©nement
                    </button>
                    <button id="sync-calendar-btn" class="btn btn-secondary">
                        <i class="fas fa-sync"></i>
                        Synchroniser
                    </button>
                </div>
            </div>

            <div class="planning-container">
                <div class="calendar-section">
                    <div class="calendar-header">
                        <button id="prev-month" class="btn-icon">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <h2 id="current-month">D√©cembre 2024</h2>
                        <button id="next-month" class="btn-icon">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                    <div id="calendar" class="calendar-grid">
                        <div style="text-align: center; color: #666;">
                            <i class="fas fa-calendar-alt" style="font-size: 3rem; margin-bottom: 1rem; color: #ccc;"></i>
                            <p>Calendrier interactif en d√©veloppement</p>
                            <p style="font-size: 0.9rem; margin-top: 0.5rem;">Bient√¥t disponible avec int√©gration compl√®te</p>
                        </div>
                    </div>
                </div>
                
                <div id="events-list" class="events-sidebar">
                    <h3><i class="fas fa-list"></i> √âv√©nements √† venir</h3>
                    <div id="events-container">
                        <div class="activity-item">
                            <i class="fas fa-users" style="color: #667eea;"></i>
                            <div>
                                <strong>R√©union √©quipe</strong>
                                <br><small>Demain √† 10h00</small>
                            </div>
                        </div>
                        <div class="activity-item">
                            <i class="fas fa-graduation-cap" style="color: #28a745;"></i>
                            <div>
                                <strong>Formation SYNERGIA</strong>
                                <br><small>Vendredi √† 14h00</small>
                            </div>
                        </div>
                        <div class="activity-item">
                            <i class="fas fa-birthday-cake" style="color: #ffc107;"></i>
                            <div>
                                <strong>Anniversaire Marie</strong>
                                <br><small>Lundi prochain</small>
                            </div>
                        </div>
                    </div>
                    
                    <button id="view-all-events" class="btn btn-secondary" style="width: 100%; margin-top: 1rem;">
                        <i class="fas fa-eye"></i>
                        Voir tous les √©v√©nements
                    </button>
                </div>
            </div>
        </section>

        <!-- Chat -->
        <section id="chat" class="content-section">
            <div class="section-header">
                <h1><i class="fas fa-comments"></i> Chat d'√©quipe</h1>
                <div class="section-actions">
                    <select id="chat-status" class="select-input">
                        <option value="online">En ligne</option>
                        <option value="away">Absent</option>
                        <option value="busy">Occup√©</option>
                        <option value="offline">Hors ligne</option>
                    </select>
                    <button id="chat-settings-btn" class="btn btn-secondary">
                        <i class="fas fa-cog"></i>
                        Param√®tres
                    </button>
                </div>
            </div>

            <div class="chat-container">
                <div class="chat-sidebar">
                    <div class="chat-header">
                        <h3>Conversations</h3>
                        <button id="new-conversation-btn" class="btn-icon">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    <div id="conversations-list">
                        <div class="activity-item" style="cursor: pointer; padding: 1rem;">
                            <i class="fas fa-users" style="color: #667eea;"></i>
                            <div style="flex: 1;">
                                <strong>√âquipe G√©n√©rale</strong>
                                <br><small style="color: #666;">Bonne journ√©e √† tous!</small>
                            </div>
                            <div style="display: flex; flex-direction: column; align-items: center;">
                                <div style="width: 8px; height: 8px; background: #28a745; border-radius: 50%; margin-bottom: 0.25rem;"></div>
                                <small style="color: #666;">10:30</small>
                            </div>
                        </div>
                        
                        <div class="activity-item" style="cursor: pointer; padding: 1rem;">
                            <i class="fas fa-project-diagram" style="color: #ffc107;"></i>
                            <div style="flex: 1;">
                                <strong>Projet SYNERGIA</strong>
                                <br><small style="color: #666;">Les nouvelles fonctionnalit√©s sont pr√™tes</small>
                            </div>
                            <div style="display: flex; flex-direction: column; align-items: center;">
                                <small style="color: #666;">09:15</small>
                            </div>
                        </div>
                        
                        <div class="activity-item" style="cursor: pointer; padding: 1rem;">
                            <i class="fas fa-user" style="color: #dc3545;"></i>
                            <div style="flex: 1;">
                                <strong>Allan Boehme</strong>
                                <br><small style="color: #666;">Message priv√©...</small>
                            </div>
                            <div style="display: flex; flex-direction: column; align-items: center;">
                                <div style="background: #667eea; color: white; border-radius: 50%; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; margin-bottom: 0.25rem;">2</div>
                                <small style="color: #666;">Hier</small>
                            </div>
                        </div>
                    </div>
                    
                    <div style="padding: 1rem; border-top: 1px solid #e9ecef;">
                        <button class="btn btn-primary" style="width: 100%;">
                            <i class="fas fa-plus"></i>
                            Nouvelle conversation
                        </button>
                    </div>
                </div>

                <div class="chat-main">
                    <div class="chat-header">
                        <div class="chat-info">
                            <h3 id="current-chat-title">√âquipe G√©n√©rale</h3>
                            <span id="current-chat-status" style="color: #28a745; font-size: 0.9rem;">
                                <i class="fas fa-circle"></i> 3 membres en ligne
                            </span>
                        </div>
                        <div class="chat-actions">
                            <button id="video-call-btn" class="btn-icon" title="Appel vid√©o">
                                <i class="fas fa-video"></i>
                            </button>
                            <button id="audio-call-btn" class="btn-icon" title="Appel audio">
                                <i class="fas fa-phone"></i>
                            </button>
                            <button id="chat-info-btn" class="btn-icon" title="Informations">
                                <i class="fas fa-info-circle"></i>
                            </button>
                        </div>
                    </div>

                    <div id="messages-container" class="messages-area">
                        <div style="text-align: center; padding: 1rem; color: #666; border-bottom: 1px solid #eee;">
                            <small>Conversation d√©marr√©e le 15 d√©cembre 2024</small>
                        </div>
                        
                        <div style="display: flex; gap: 1rem; padding: 1rem; margin-bottom: 0.5rem;">
                            <img src="assets/default-avatar.png" alt="Allan" style="width: 40px; height: 40px; border-radius: 50%;">
                            <div>
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                                    <strong>Allan Boehme</strong>
                                    <small style="color: #666;">10:30</small>
                                </div>
                                <div style="background: #f8f9fa; padding: 0.75rem; border-radius: 12px; border-top-left-radius: 4px;">
                                    Bonne journ√©e √† tous ! L'√©quipe SYNERGIA v3.0 est op√©rationnelle üöÄ
                                </div>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 1rem; padding: 1rem; margin-bottom: 0.5rem;">
                            <img src="assets/default-avatar.png" alt="Polar" style="width: 40px; height: 40px; border-radius: 50%;">
                            <div>
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                                    <strong>Polar Caron</strong>
                                    <small style="color: #666;">10:32</small>
                                </div>
                                <div style="background: #f8f9fa; padding: 0.75rem; border-radius: 12px; border-top-left-radius: 4px;">
                                    Excellent travail ! Les nouvelles fonctionnalit√©s sont impressionnantes üëè
                                </div>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 1rem; padding: 1rem; margin-bottom: 0.5rem;">
                            <img src="assets/default-avatar.png" alt="Marie" style="width: 40px; height: 40px; border-radius: 50%;">
                            <div>
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                                    <strong>Marie Dubois</strong>
                                    <small style="color: #666;">10:35</small>
                                </div>
                                <div style="background: #f8f9fa; padding: 0.75rem; border-radius: 12px; border-top-left-radius: 4px;">
                                    L'interface est vraiment intuitive ! H√¢te de tester toutes les fonctionnalit√©s ‚ú®
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="message-input-container">
                        <div class="message-input">
                            <button class="btn-icon" title="Emoji">
                                <i class="fas fa-smile"></i>
                            </button>
                            <button class="btn-icon" title="Fichier">
                                <i class="fas fa-paperclip"></i>
                            </button>
                            <input type="text" id="message-input" placeholder="Tapez votre message...">
                            <button id="send-message-btn" class="btn-send">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Missions -->
        <section id="quests" class="content-section">
            <div class="section-header">
                <h1><i class="fas fa-trophy"></i> Missions & R√©compenses</h1>
                <div class="section-actions">
                    <select id="quest-filter" class="select-input">
                        <option value="all">Toutes les missions</option>
                        <option value="available">Disponibles</option>
                        <option value="active">En cours</option>
                        <option value="completed">Termin√©es</option>
                    </select>
                    <button id="quest-history-btn" class="btn btn-secondary">
                        <i class="fas fa-history"></i>
                        Historique
                    </button>
                </div>
            </div>

            <div class="user-progress">
                <div class="level-info">
                    <div style="text-align: center; margin-right: 1rem;">
                        <div style="font-size: 2rem; margin-bottom: 0.25rem;">‚≠ê</div>
                        <span id="user-level-display">Niveau 5</span>
                    </div>
                    <div class="xp-bar">
                        <div id="xp-progress" class="xp-fill" style="width: 60%;"></div>
                    </div>
                    <div style="text-align: center; margin-left: 1rem;">
                        <span id="user-xp-display">1,250 XP</span>
                        <div style="font-size: 0.8rem; opacity: 0.8;">750 XP vers niveau 6</div>
                    </div>
                </div>
            </div>

            <div class="quests-tabs">
                <button class="quest-tab active" data-tab="daily">
                    <i class="fas fa-sun"></i> Quotidiennes
                </button>
                <button class="quest-tab" data-tab="weekly">
                    <i class="fas fa-calendar-week"></i> Hebdomadaires
                </button>
                <button class="quest-tab" data-tab="special">
                    <i class="fas fa-star"></i> Sp√©ciales
                </button>
                <button class="quest-tab" data-tab="completed">
                    <i class="fas fa-check"></i> Termin√©es
                </button>
            </div>

            <div id="quests-list" class="quests-grid">
                <!-- Les missions seront charg√©es dynamiquement -->
                <div class="quest-card animate-slide-up">
                    <div class="quest-icon">‚è∞</div>
                    <div class="quest-info">
                        <h3>Pointer son arriv√©e</h3>
                        <p>Pointer votre arriv√©e avant 9h30</p>
                        <div class="quest-reward">
                            <span class="xp-reward">50 XP</span>
                            <span class="quest-type">Quotidienne</span>
                        </div>
                    </div>
                    <div class="quest-actions">
                        <button onclick="acceptQuest('daily_checkin')" class="btn btn-primary">
                            Accepter
                        </button>
                    </div>
                </div>

                <div class="quest-card animate-slide-up">
                    <div class="quest-icon">üí¨</div>
                    <div class="quest-info">
                        <h3>Message d'√©quipe</h3>
                        <p>Envoyer un message dans le chat d'√©quipe</p>
                        <div class="quest-reward">
                            <span class="xp-reward">30 XP</span>
                            <span class="quest-type">Quotidienne</span>
                        </div>
                    </div>
                    <div class="quest-actions">
                        <button onclick="acceptQuest('daily_team_message')" class="btn btn-primary">
                            Accepter
                        </button>
                    </div>
                </div>

                <div class="quest-card animate-slide-up">
                    <div class="quest-icon">‚≠ê</div>
                    <div class="quest-info">
                        <h3>Journ√©e parfaite</h3>
                        <p>Pointer arriv√©e et d√©part √† l'heure</p>
                        <div class="quest-reward">
                            <span class="xp-reward">100 XP</span>
                            <span class="quest-type">Quotidienne</span>
                        </div>
                    </div>
                    <div class="quest-actions">
                        <button onclick="acceptQuest('daily_perfect_day')" class="btn btn-primary">
                            Accepter
                        </button>
                    </div>
                </div>

                <div class="quest-card animate-slide-up">
                    <div class="quest-icon">ü§ù</div>
                    <div class="quest-info">
                        <h3>Esprit d'√©quipe</h3>
                        <p>Participer √† 5 conversations d'√©quipe cette semaine</p>
                        <div class="quest-reward">
                            <span class="xp-reward">150 XP</span>
                            <span class="quest-type">Hebdomadaire</span>
                        </div>
                    </div>
                    <div class="quest-actions">
                        <button onclick="acceptQuest('weekly_team_player')" class="btn btn-primary">
                            Accepter
                        </button>
                    </div>
                </div>

                <div class="quest-card animate-slide-up">
                    <div class="quest-icon">üéØ</div>
                    <div class="quest-info">
                        <h3>Ponctualit√©</h3>
                        <p>Arriver √† l'heure 5 jours de suite</p>
                        <div class="quest-reward">
                            <span class="xp-reward">200 XP</span>
                            <span class="quest-type">Hebdomadaire</span>
                        </div>
                    </div>
                    <div class="quest-actions">
                        <button onclick="acceptQuest('weekly_punctual')" class="btn btn-primary">
                            Accepter
                        </button>
                    </div>
                </div>
            </div>

            <div class="badges-section">
                <h3><i class="fas fa-trophy"></i> Badges obtenus</h3>
                <div id="user-badges" class="badges-grid">
                    <div class="badge-item" style="text-align: center; padding: 1rem; background: white; border-radius: 8px; border: 1px solid #e9ecef;">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üåÖ</div>
                        <div style="font-weight: 500; margin-bottom: 0.25rem;">L√®ve-t√¥t</div>
                        <div style="font-size: 0.8rem; color: #666;">Arriver avant 8h30 pendant 5 jours</div>
                    </div>
                    
                    <div class="badge-item" style="text-align: center; padding: 1rem; background: white; border-radius: 8px; border: 1px solid #e9ecef;">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">ü§ù</div>
                        <div style="font-weight: 500; margin-bottom: 0.25rem;">√âquipier</div>
                        <div style="font-size: 0.8rem; color: #666;">Envoyer 50 messages d'√©quipe</div>
                    </div>
                    
                    <div class="badge-item" style="text-align: center; padding: 1rem; background: white; border-radius: 8px; border: 1px solid #e9ecef;">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üí°</div>
                        <div style="font-weight: 500; margin-bottom: 0.25rem;">Innovateur</div>
                        <div style="font-size: 0.8rem; color: #666;">Proposer une am√©lioration accept√©e</div>
                    </div>
                    
                    <div class="badge-item" style="text-align: center; padding: 1rem; background: #f8f9fa; border-radius: 8px; border: 2px dashed #dee2e6; opacity: 0.6;">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üèÜ</div>
                        <div style="font-weight: 500; margin-bottom: 0.25rem;">Expert</div>
                        <div style="font-size: 0.8rem; color: #666;">√Ä d√©bloquer</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Analytics -->
        <section id="analytics" class="content-section">
            <div class="section-header">
                <h1><i class="fas fa-chart-bar"></i> Analytics & Rapports</h1>
                <div class="section-actions">
                    <select id="analytics-period" class="select-input">
                        <option value="week">Cette semaine</option>
                        <option value="month">Ce mois</option>
                        <option value="quarter">Ce trimestre</option>
                        <option value="year">Cette ann√©e</option>
                    </select>
                    <button id="export-data-btn" class="btn btn-secondary">
                        <i class="fas fa-download"></i>
                        Exporter
                    </button>
                    <button id="refresh-analytics-btn" class="btn btn-secondary">
                        <i class="fas fa-sync-alt"></i>
                        Actualiser
                    </button>
                </div>
            </div>

            <div class="analytics-grid">
                <div class="analytics-card animate-slide-up">
                    <h3><i class="fas fa-chart-line"></i> Pr√©sence d'√©quipe</h3>
                    <canvas id="attendance-chart" width="400" height="200"></canvas>
                    <div class="chart-actions">
                        <button class="btn-small" onclick="analyticsManager.switchView('attendance', 'day')">Jour</button>
                        <button class="btn-small" onclick="analyticsManager.switchView('attendance', 'week')">Semaine</button>
                        <button class="btn-small" onclick="analyticsManager.switchView('attendance', 'month')">Mois</button>
                    </div>
                    <div style="text-align: center; margin-top: 1rem;">
                        <div style="color: #28a745; font-size: 1.5rem; font-weight: bold;">88%</div>
                        <div style="color: #666; font-size: 0.9rem;">Taux de pr√©sence moyen</div>
                    </div>
                </div>

                <div class="analytics-card animate-slide-up">
                    <h3><i class="fas fa-star"></i> Progression XP</h3>
                    <canvas id="xp-chart" width="400" height="200"></canvas>
                    <div style="text-align: center; margin-top: 1rem;">
                        <div style="color: #667eea; font-size: 1.5rem; font-weight: bold;">+350 XP</div>
                        <div style="color: #666; font-size: 0.9rem;">Cette semaine</div>
                    </div>
                </div>

                <div class="analytics-card animate-slide-up">
                    <h3><i class="fas fa-trophy"></i> Missions compl√©t√©es</h3>
                    <canvas id="quests-chart" width="400" height="200"></canvas>
                    <div style="text-align: center; margin-top: 1rem;">
                        <div style="color: #ffc107; font-size: 1.5rem; font-weight: bold;">21</div>
                        <div style="color: #666; font-size: 0.9rem;">Missions ce mois</div>
                    </div>
                </div>

                <div class="analytics-card animate-slide-up">
                    <h3><i class="fas fa-users"></i> Statistiques globales</h3>
                    <div class="stats-grid">
                        <div class="stat">
                            <span class="stat-value" id="total-members">3</span>
                            <span class="stat-label">Membres actifs</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value" id="total-quests">21</span>
                            <span class="stat-label">Missions totales</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value" id="total-events">5</span>
                            <span class="stat-label">√âv√©nements</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value" id="avg-attendance">88%</span>
                            <span class="stat-label">Pr√©sence moyenne</span>
                        </div>
                    </div>
                    
                    <div style="margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid #eee;">
                        <h4 style="margin-bottom: 1rem; color: #333;">Tendances</h4>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span style="color: #666;">Productivit√©</span>
                            <span style="color: #28a745; font-weight: 500;">üìà +12%</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span style="color: #666;">Engagement</span>
                            <span style="color: #28a745; font-weight: 500;">üìà +8%</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: #666;">Collaboration</span>
                            <span style="color: #28a745; font-weight: 500;">üìà +15%</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="reports-section">
                <h3><i class="fas fa-file-alt"></i> Rapports d√©taill√©s</h3>
                <div class="reports-grid">
                    <div class="report-card animate-slide-up" onclick="analyticsManager.generateReport('attendance')">
                        <i class="fas fa-chart-line"></i>
                        <h4>Rapport de pr√©sence</h4>
                        <p>Analyse d√©taill√©e des heures de pr√©sence et ponctualit√©</p>
                        <div style="margin-top: 1rem; padding: 0.5rem; background: #f8f9fa; border-radius: 6px; font-size: 0.85rem; color: #666;">
                            üìä Derni√®re mise √† jour: Il y a 2 heures
                        </div>
                    </div>
                    
                    <div class="report-card animate-slide-up" onclick="analyticsManager.generateReport('performance')">
                        <i class="fas fa-trophy"></i>
                        <h4>Performance d'√©quipe</h4>
                        <p>Missions, XP et progression de chaque membre</p>
                        <div style="margin-top: 1rem; padding: 0.5rem; background: #f8f9fa; border-radius: 6px; font-size: 0.85rem; color: #666;">
                            üèÜ Derni√®re analyse: Aujourd'hui
                        </div>
                    </div>
                    
                    <div class="report-card animate-slide-up" onclick="analyticsManager.generateReport('engagement')">
                        <i class="fas fa-users"></i>
                        <h4>Engagement √©quipe</h4>
                        <p>Participation, interaction et collaboration</p>
                        <div style="margin-top: 1rem; padding: 0.5rem; background: #f8f9fa; border-radius: 6px; font-size: 0.85rem; color: #666;">
                            üí¨ Messages: 247 cette semaine
                        </div>
                    </div>
                    
                    <div class="report-card animate-slide-up" onclick="analyticsManager.generateReport('productivity')">
                        <i class="fas fa-chart-pie"></i>
                        <h4>Productivit√©</h4>
                        <p>M√©triques de productivit√© et temps de travail</p>
                        <div style="margin-top: 1rem; padding: 0.5rem; background: #f8f9fa; border-radius: 6px; font-size: 0.85rem; color: #666;">
                            ‚è±Ô∏è Temps moyen: 8.2h/jour
                        </div>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 2rem;">
                    <button id="advanced-analytics-btn" class="btn btn-primary">
                        <i class="fas fa-chart-bar"></i>
                        Analytics avanc√©es
                    </button>
                    <button id="export-all-reports-btn" class="btn btn-secondary">
                        <i class="fas fa-file-export"></i>
                        Exporter tous les rapports
                    </button>
                </div>
            </div>
        </section>
    </main>

    <!-- Modals -->
    <!-- Modal ajout de membre -->
    <div id="add-member-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="document.getElementById('add-member-modal').style.display='none'">&times;</span>
            <h2><i class="fas fa-user-plus"></i> Ajouter un nouveau membre</h2>
            <form id="add-member-form">
                <div class="form-group">
                    <label for="member-name">
                        <i class="fas fa-user"></i> Nom complet
                    </label>
                    <input type="text" id="member-name" name="name" required placeholder="Ex: Jean Dupont">
                </div>
                <div class="form-group">
                    <label for="member-email">
                        <i class="fas fa-envelope"></i> Email
                    </label>
                    <input type="email" id="member-email" name="email" required placeholder="jean.dupont@example.com">
                </div>
                <div class="form-group">
                    <label for="member-role">
                        <i class="fas fa-briefcase"></i> R√¥le
                    </label>
                    <select id="member-role" name="role" required>
                        <option value="">S√©lectionner un r√¥le</option>
                        <option value="Membre">Membre</option>
                        <option value="D√©veloppeur">D√©veloppeur</option>
                        <option value="Designer">Designer</option>
                        <option value="Manager">Manager</option>
                        <option value="Admin">Administrateur</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="member-department">
                        <i class="fas fa-building"></i> D√©partement
                    </label>
                    <select id="member-department" name="department">
                        <option value="">S√©lectionner un d√©partement</option>
                        <option value="IT">Informatique</option>
                        <option value="Design">Design</option>
                        <option value="Marketing">Marketing</option>
                        <option value="RH">Ressources Humaines</option>
                        <option value="Finance">Finance</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" id="cancel-add-member" class="btn btn-secondary" onclick="document.getElementById('add-member-modal').style.display='none'">
                        <i class="fas fa-times"></i> Annuler
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Ajouter le membre
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal ajout d'√©v√©nement -->
    <div id="add-event-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="document.getElementById('add-event-modal').style.display='none'">&times;</span>
            <h2><i class="fas fa-calendar-plus"></i> Nouvel √©v√©nement</h2>
            <form id="add-event-form">
                <div class="form-group">
                    <label for="event-title">
                        <i class="fas fa-heading"></i> Titre de l'√©v√©nement
                    </label>
                    <input type="text" id="event-title" name="title" required placeholder="Ex: R√©union √©quipe">
                </div>
                <div class="form-group">
                    <label for="event-description">
                        <i class="fas fa-align-left"></i> Description
                    </label>
                    <textarea id="event-description" name="description" placeholder="Description de l'√©v√©nement..."></textarea>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label for="event-date">
                            <i class="fas fa-calendar"></i> Date
                        </label>
                        <input type="date" id="event-date" name="date" required>
                    </div>
                    <div class="form-group">
                        <label for="event-time">
                            <i class="fas fa-clock"></i> Heure
                        </label>
                        <input type="time" id="event-time" name="time" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="event-type">
                        <i class="fas fa-tag"></i> Type d'√©v√©nement
                    </label>
                    <select id="event-type" name="type" required>
                        <option value="">S√©lectionner un type</option>
                        <option value="meeting">üè¢ R√©union</option>
                        <option value="deadline">‚è∞ √âch√©ance</option>
                        <option value="event">üéâ √âv√©nement</option>
                        <option value="reminder">üìù Rappel</option>
                        <option value="training">üéì Formation</option>
                        <option value="social">‚òï Social</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="event-participants">
                        <i class="fas fa-users"></i> Participants
                    </label>
                    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; padding: 0.75rem; border: 1px solid #dee2e6; border-radius: 8px; background: #f8f9fa;">
                        <label style="display: flex; align-items: center; gap: 0.25rem; cursor: pointer;">
                            <input type="checkbox" value="all" checked> Toute l'√©quipe
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.25rem; cursor: pointer;">
                            <input type="checkbox" value="allan"> Allan Boehme
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.25rem; cursor: pointer;">
                            <input type="checkbox" value="polar"> Polar Caron
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.25rem; cursor: pointer;">
                            <input type="checkbox" value="marie"> Marie Dubois
                        </label>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="document.getElementById('add-event-modal').style.display='none'">
                        <i class="fas fa-times"></i> Annuler
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-calendar-plus"></i> Cr√©er l'√©v√©nement
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal profil membre -->
    <div id="member-profile-modal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <!-- Le contenu sera g√©n√©r√© dynamiquement -->
        </div>
    </div>

    <!-- Modal param√®tres chat -->
    <div id="chat-settings-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="document.getElementById('chat-settings-modal').style.display='none'">&times;</span>
            <h2><i class="fas fa-cog"></i> Param√®tres du chat</h2>
            <div class="form-group">
                <label>
                    <i class="fas fa-bell"></i> Notifications
                </label>
                <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="checkbox" checked> Notifications de messages
                    </label>
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="checkbox" checked> Sons de notification
                    </label>
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="checkbox"> Notifications desktop
                    </label>
                </div>
            </div>
            <div class="form-group">
                <label for="chat-theme">
                    <i class="fas fa-palette"></i> Th√®me
                </label>
                <select id="chat-theme" class="select-input">
                    <option value="light">Clair</option>
                    <option value="dark">Sombre</option>
                    <option value="auto">Automatique</option>
                </select>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="document.getElementById('chat-settings-modal').style.display='none'">
                    Fermer
                </button>
                <button type="button" class="btn btn-primary">
                    <i class="fas fa-save"></i> Sauvegarder
                </button>
            </div>
        </div>
    </div>

    <!-- Toast notifications -->
    <div id="toast-container" style="position: fixed; top: 20px; right: 20px; z-index: 3000; display: flex; flex-direction: column; gap: 0.5rem;">
        <!-- Les toasts seront ajout√©s dynamiquement -->
    </div>

    <!-- Scripts int√©gr√©s -->
    <script>
        // Quest Manager int√©gr√© (remplace quest-manager.js)
        class QuestManager {
            constructor() {
                this.quests = [];
                this.userQuests = [];
                this.badges = [];
                this.currentUser = null;
                this.questsLoaded = false;
                
                console.log('üéØ Quest Manager cr√©√©');
            }

            async init() {
                console.log('üéØ Initialisation Quest Manager...');
                
                // Attendre que l'authentification soit pr√™te
                await this.waitForAuth();
                
                // Charger les donn√©es
                await this.loadQuests();
                await this.loadBadges();
                await this.loadUserQuests();
                
                // G√©n√©rer les qu√™tes quotidiennes si n√©cessaire
                this.generateDailyQuests();
                
                // Configurer les √©v√©nements
                this.setupEventListeners();
                
                console.log('‚úÖ Quest Manager initialis√©');
            }

            async waitForAuth() {
                return new Promise((resolve) => {
                    // V√©rifier si l'utilisateur est d√©j√† connect√©
                    if (window.auth && window.auth.currentUser) {
                        this.currentUser = window.auth.currentUser;
                        console.log(`üë§ Utilisateur trouv√©: ${this.currentUser.email}`);
                        resolve();
                        return;
                    }

                    // Attendre la connexion ou utiliser le mode d√©mo
                    let attempts = 0;
                    const maxAttempts = 30;
                    
                    const checkAuth = () => {
                        attempts++;
                        
                        if (window.auth && window.auth.currentUser) {
                            this.currentUser = window.auth.currentUser;
                            console.log(`üë§ Utilisateur connect√©: ${this.currentUser.email}`);
                            resolve();
                        } else if (attempts >= maxAttempts) {
                            console.log('üë§ Mode d√©mo - pas d\'utilisateur connect√©');
                            this.currentUser = null;
                            resolve();
                        } else {
                            setTimeout(checkAuth, 100);
                        }
                    };
                    
                    checkAuth();
                });
            }

            async loadQuests() {
                try {
                    // Qu√™tes par d√©faut du syst√®me
                    this.quests = [
                        {
                            id: 'daily_checkin',
                            title: 'Pointer son arriv√©e',
                            description: 'Pointer votre arriv√©e avant 9h30',
                            type: 'daily',
                            xp: 50,
                            icon: '‚è∞',
                            category: 'attendance',
                            requirements: { action: 'checkin', time_before: '09:30' }
                        },
                        {
                            id: 'daily_team_message',
                            title: 'Message d\'√©quipe',
                            description: 'Envoyer un message dans le chat d\'√©quipe',
                            type: 'daily',
                            xp: 30,
                            icon: 'üí¨',
                            category: 'communication',
                            requirements: { action: 'send_message', target: 'team' }
                        },
                        {
                            id: 'daily_perfect_day',
                            title: 'Journ√©e parfaite',
                            description: 'Pointer arriv√©e et d√©part √† l\'heure',
                            type: 'daily',
                            xp: 100,
                            icon: '‚≠ê',
                            category: 'attendance',
                            requirements: { action: 'perfect_attendance' }
                        },
                        {
                            id: 'weekly_team_player',
                            title: 'Esprit d\'√©quipe',
                            description: 'Participer √† 5 conversations d\'√©quipe cette semaine',
                            type: 'weekly',
                            xp: 150,
                            icon: 'ü§ù',
                            category: 'teamwork',
                            requirements: { action: 'team_messages', count: 5, period: 'week' }
                        },
                        {
                            id: 'weekly_punctual',
                            title: 'Ponctualit√©',
                            description: 'Arriver √† l\'heure 5 jours de suite',
                            type: 'weekly',
                            xp: 200,
                            icon: 'üéØ',
                            category: 'attendance',
                            requirements: { action: 'punctual_streak', count: 5 }
                        }
                    ];

                    console.log(`üìú ${this.quests.length} qu√™tes charg√©es`);
                } catch (error) {
                    console.error('‚ùå Erreur chargement qu√™tes:', error);
                }
            }

            async loadBadges() {
                try {
                    this.badges = [
                        {
                            id: 'early_bird',
                            name: 'L√®ve-t√¥t',
                            description: 'Arriver avant 8h30 pendant 5 jours',
                            icon: 'üåÖ',
                            rarity: 'common'
                        },
                        {
                            id: 'team_player',
                            name: '√âquipier',
                            description: 'Envoyer 50 messages d\'√©quipe',
                            icon: 'ü§ù',
                            rarity: 'common'
                        },
                        {
                            id: 'innovator',
                            name: 'Innovateur',
                            description: 'Proposer 3 am√©liorations accept√©es',
                            icon: 'üí°',
                            rarity: 'legendary'
                        }
                    ];

                    console.log(`üèÜ ${this.badges.length} badges charg√©s`);
                } catch (error) {
                    console.error('‚ùå Erreur chargement badges:', error);
                }
            }

            async loadUserQuests() {
                try {
                    this.userQuests = [];
                    console.log(`‚úÖ ${this.userQuests.length} qu√™tes utilisateur charg√©es`);
                } catch (error) {
                    console.error('‚ùå Erreur chargement qu√™tes utilisateur:', error);
                    this.userQuests = [];
                }
            }

            generateDailyQuests() {
                if (!this.currentUser) {
                    console.log('üë§ Mode d√©mo - qu√™tes syst√®me uniquement');
                    return;
                }

                try {
                    const today = new Date().toDateString();
                    const existingDailyQuests = this.userQuests.filter(q => 
                        q.type === 'daily' && q.assignedDate === today
                    );

                    if (existingDailyQuests.length === 0) {
                        console.log('üîÑ Qu√™tes quotidiennes g√©n√©r√©es');
                    }
                } catch (error) {
                    console.error('‚ùå Erreur g√©n√©ration qu√™tes:', error);
                }
            }

            setupEventListeners() {
                // √âv√©nements depuis d'autres managers
                document.addEventListener('synergia:checkin', (e) => {
                    this.handleCheckin(e.detail.time);
                });

                document.addEventListener('synergia:team_message', () => {
                    this.handleTeamMessage();
                });

                document.addEventListener('synergia:perfect_day', () => {
                    this.handlePerfectDay();
                });
            }

            async handleCheckin(time) {
                console.log('‚úÖ Pointage trait√© par Quest Manager');
            }

            async handleTeamMessage() {
                console.log('üí¨ Message d\'√©quipe trait√© par Quest Manager');
            }

            async handlePerfectDay() {
                console.log('‚≠ê Journ√©e parfaite d√©tect√©e par Quest Manager');
            }

            getAvailableQuests() {
                return this.quests.filter(q => q.type === 'daily' || q.type === 'weekly');
            }

            getUserQuests() {
                return this.userQuests;
            }

            getDailyQuests() {
                const today = new Date().toDateString();
                return this.userQuests.filter(q => q.type === 'daily' && q.assignedDate === today);
            }

            getWeeklyQuests() {
                return this.userQuests.filter(q => q.type === 'weekly');
            }

            getQuestById(questId) {
                return this.quests.find(q => q.id === questId);
            }

            async acceptQuest(questId) {
                console.log(`‚úÖ Acceptation de la qu√™te: ${questId}`);
                const quest = this.getQuestById(questId);
                if (quest) {
                    console.log(`üéØ Nouvelle qu√™te assign√©e: ${quest.title}`);
                    console.log(`INFO: Nouvelle mission: ${quest.title}`);
                    console.log('SUCCESS: Mission accept√©e!');
                    return quest;
                }
                return null;
            }
        }

        // Initialiser le Quest Manager globalement
        window.questManager = new QuestManager();
    </script>
    
    <script>
        console.log('üöÄ Initializing SYNERGIA v3.0...');

        // Variables globales
        let currentUser = null;
        let teamManager = null;
        let planningManager = null;
        let chatManager = null;
        let analyticsManager = null;
        let badgingManager = null;

        // Fonctions utilitaires globales
        window.showToast = function(message, type = 'info', duration = 3000) {
            const toast = document.createElement('div');
            toast.className = `notification ${type}`;
            toast.innerHTML = `
                <div class="notification-content">
                    <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation-triangle' : 'info'}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            const container = document.getElementById('toast-container');
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, duration);
        };

        window.log = (message, type = 'INFO') => {
            console.log(`${type}: ${message}`);
        };

        window.success = (message) => {
            window.log(message, 'SUCCESS');
            window.showToast(message, 'success');
        };

        window.error = (message) => {
            window.log(message, 'ERROR');
            window.showToast(message, 'error');
        };

        window.warning = (message) => {
            window.log(message, 'WARNING');
            window.showToast(message, 'warning');
        };

        // Attendre que Firebase soit pr√™t
        function waitForFirebase() {
            return new Promise((resolve) => {
                if (window.auth && window.db) {
                    resolve();
                } else {
                    setTimeout(() => waitForFirebase().then(resolve), 100);
                }
            });
        }

        // Gestion de l'authentification
        function handleAuthStateChange(user) {
            if (user) {
                currentUser = user;
                console.log(`üë§ Utilisateur connect√©: ${user.email}`);
                updateUserInfo(user);
                initializeManagers();
            } else {
                console.log('üë§ Aucun utilisateur connect√© - Mode d√©mo');
                initializeDemoMode();
            }
        }

        function updateUserInfo(user) {
            const userName = document.getElementById('user-name');
            const userAvatar = document.getElementById('user-avatar');
            
            if (userName) userName.textContent = user.displayName || user.email.split('@')[0];
            if (userAvatar) userAvatar.src = user.photoURL || 'assets/default-avatar.png';
            
            console.log('‚úÖ Utilisateur mis √† jour');
        }

        function initializeDemoMode() {
            console.log('üé≠ Mode d√©monstration activ√©');
            currentUser = {
                uid: 'demo-user',
                email: 'alan.boehme61@gmail.com',
                displayName: 'Allan Boehme'
            };
            updateUserInfo(currentUser);
            initializeManagers();
        }

        // Initialisation des managers
        async function initializeManagers() {
            try {
                // Team Manager
                teamManager = new TeamManager();
                
                // Planning Manager
                planningManager = new PlanningManager();
                
                // Chat Manager
                chatManager = new ChatManager();
                
                // Analytics Manager
                analyticsManager = new AnalyticsManager();
                
                // Badging Manager
                badgingManager = new BadgingManager();
                
                // Quest Manager d√©j√† initialis√© globalement
                if (window.questManager) {
                    await window.questManager.init();
                }
                
                console.log('‚úÖ SYNERGIA v3.0 initialized successfully!');
                
            } catch (error) {
                console.error('‚ùå Erreur lors de l\'initialisation:', error);
            }
        }

        // Team Manager
        class TeamManager {
            constructor() {
                this.members = [];
                this.currentUser = null;
                this.init();
            }

            async init() {
                console.log('‚úÖ Team Manager initialis√©');
                await this.loadMembers();
                this.setupEventListeners();
            }

            async loadMembers() {
                try {
                    const user = (window.auth && window.auth.currentUser) || currentUser;
                    if (!user) {
                        console.log('‚ùå Utilisateur non connect√© pour charger les membres');
                        this.loadDemoMembers();
                        return;
                    }

                    // Tentative de chargement depuis Firebase
                    try {
                        if (window.db && window.firebase && window.firebase.collection) {
                            const membersRef = window.firebase.collection(window.db, 'teams', user.uid, 'members');
                            const snapshot = await window.firebase.getDocs(membersRef);
                            
                            this.members = [];
                            snapshot.forEach(doc => {
                                const memberData = doc.data();
                                this.members.push({
                                    id: doc.id,
                                    name: memberData.name || '',
                                    email: memberData.email || '',
                                    role: memberData.role || 'Membre',
                                    avatar: memberData.avatar || 'assets/default-avatar.png',
                                    status: memberData.status || 'offline',
                                    joinDate: memberData.joinDate || new Date(),
                                    xp: memberData.xp || 0,
                                    level: memberData.level || 1,
                                    badges: memberData.badges || []
                                });
                            });

                            console.log(`‚úÖ ${this.members.length} membres charg√©s depuis Firebase`);
                        } else {
                            throw new Error('Firebase non disponible');
                        }
                    } catch (firebaseError) {
                        console.log('‚ùå Erreur Firebase, chargement des donn√©es de d√©mo');
                        this.loadDemoMembers();
                        return;
                    }
                    
                    this.renderMembers();
                } catch (error) {
                    console.error('‚ùå Erreur lors du chargement des membres:', error);
                    this.loadDemoMembers();
                }
            }

            loadDemoMembers() {
                this.members = [
                    {
                        id: 'demo1',
                        name: 'Allan Boehme',
                        email: 'alan.boehme61@gmail.com',
                        role: 'Manager',
                        avatar: 'assets/avatars/alan.jpg',
                        status: 'online',
                        joinDate: new Date('2024-01-15'),
                        xp: 1250,
                        level: 5,
                        badges: ['early_bird', 'team_player', 'innovator']
                    },
                    {
                        id: 'demo2',
                        name: 'Polar Caron',
                        email: 'polar.caron@synergia.com',
                        role: 'D√©veloppeur',
                        avatar: 'assets/avatars/polar.jpg',
                        status: 'online',
                        joinDate: new Date('2024-02-01'),
                        xp: 980,
                        level: 4,
                        badges: ['code_master', 'team_player']
                    },
                    {
                        id: 'demo3',
                        name: 'Marie Dubois',
                        email: 'marie.dubois@synergia.com',
                        role: 'Designer',
                        avatar: 'assets/avatars/marie.jpg',
                        status: 'away',
                        joinDate: new Date('2024-03-10'),
                        xp: 750,
                        level: 3,
                        badges: ['creative', 'perfectionist']
                    }
                ];
                console.log(`üë• ${this.members.length} membres d'√©quipe charg√©s`);
                this.renderMembers();
            }

            setupEventListeners() {
                const searchInput = document.getElementById('team-search');
                if (searchInput) {
                    searchInput.addEventListener('input', (e) => {
                        this.filterAndRenderMembers(e.target.value);
                    });
                }

                const addMemberBtn = document.getElementById('add-member-btn');
                if (addMemberBtn) {
                    addMemberBtn.addEventListener('click', () => {
                        this.showAddMemberModal();
                    });
                }

                const exportTeamBtn = document.getElementById('export-team-btn');
                if (exportTeamBtn) {
                    exportTeamBtn.addEventListener('click', () => {
                        this.exportTeamData();
                    });
                }
            }

            filterAndRenderMembers(searchTerm = '') {
                console.log('üîç Debug membres:', {
                    membersExists: !!this.members,
                    membersType: typeof this.members,
                    membersLength: this.members ? this.members.length : 'N/A',
                    membersContent: this.members
                });

                try {
                    if (!this.members || !Array.isArray(this.members)) {
                        console.warn('‚ö†Ô∏è Membres invalides');
                        this.renderMembers([]);
                        return;
                    }

                    const filteredMembers = this.members.filter(member => {
                        if (!member) {
                            return false;
                        }
                        
                        const memberName = member.name || '';
                        const memberEmail = member.email || '';
                        const memberRole = member.role || '';
                        
                        const searchText = searchTerm || '';
                        
                        return memberName.toString().toLowerCase().includes(searchText.toLowerCase()) ||
                               memberEmail.toString().toLowerCase().includes(searchText.toLowerCase()) ||
                               memberRole.toString().toLowerCase().includes(searchText.toLowerCase());
                    });
                    
                    this.renderMembers(filteredMembers);
                    
                } catch (error) {
                    console.error('‚ùå Erreur dans filterAndRenderMembers:', error);
                    this.renderMembers(this.members || []);
                }
            }

            renderMembers(membersToRender = this.members) {
                const container = document.getElementById('team-members-list');
                if (!container) {
                    console.warn('‚ö†Ô∏è Container team-members-list non trouv√©');
                    return;
                }

                container.innerHTML = '';

                if (membersToRender.length === 0) {
                    container.innerHTML = `
                        <div class="no-members">
                            <i class="fas fa-users"></i>
                            <p>Aucun membre trouv√©</p>
                            <button onclick="teamManager.showAddMemberModal()" class="btn btn-primary" style="margin-top: 1rem;">
                                <i class="fas fa-user-plus"></i>
                                Ajouter le premier membre
                            </button>
                        </div>
                    `;
                    return;
                }

                membersToRender.forEach(member => {
                    const memberCard = this.createMemberCard(member);
                    container.appendChild(memberCard);
                });

                console.log(`üë• ${membersToRender.length} membres d'√©quipe charg√©s`);
                
                // Mettre √† jour le compteur dans le dashboard
                document.getElementById('team-count').textContent = this.members.length;
            }

            createMemberCard(member) {
                const card = document.createElement('div');
                card.className = 'team-member-card animate-slide-up';
                card.dataset.memberId = member.id;

                const statusClass = member.status === 'online' ? 'online' : 
                                   member.status === 'away' ? 'away' : 'offline';

                const joinDate = new Date(member.joinDate).toLocaleDateString('fr-FR');

                card.innerHTML = `
                    <div class="member-avatar">
                        <img src="${member.avatar}" alt="${member.name}" onerror="this.src='assets/default-avatar.png'">
                        <div class="status-indicator ${statusClass}" title="Status: ${member.status}"></div>
                    </div>
                    <div class="member-info">
                        <h3>${member.name}</h3>
                        <p class="member-role">${member.role}</p>
                        <p class="member-email">${member.email}</p>
                        <div class="member-stats">
                            <span class="member-level" title="Niveau actuel">Niveau ${member.level}</span>
                            <span class="member-xp" title="Points d'exp√©rience">${member.xp} XP</span>
                        </div>
                        <div class="member-badges">
                            ${member.badges.map(badge => `<span class="badge ${badge}" title="${this.getBadgeName(badge)}">${this.getBadgeIcon(badge)}</span>`).join('')}
                        </div>
                        <div style="font-size: 0.8rem; color: #666; margin-top: 0.5rem;">
                            <i class="fas fa-calendar-alt"></i> Rejoint le ${joinDate}
                        </div>
                    </div>
                    <div class="member-actions">
                        <button class="btn-icon" onclick="teamManager.sendMessage('${member.id}')" title="Envoyer un message">
                            <i class="fas fa-envelope"></i>
                        </button>
                        <button class="btn-icon" onclick="teamManager.viewMemberProfile('${member.id}')" title="Voir le profil">
                            <i class="fas fa-user"></i>
                        </button>
                        <button class="btn-icon" onclick="teamManager.showMemberOptions('${member.id}')" title="Plus d'options">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                    </div>
                `;

                return card;
            }

            getBadgeName(badgeId) {
                const badges = {
                    'early_bird': 'L√®ve-t√¥t',
                    'team_player': '√âquipier',
                    'innovator': 'Innovateur',
                    'code_master': 'Ma√Ætre du Code',
                    'creative': 'Cr√©atif',
                    'perfectionist': 'Perfectionniste',
                    'mentor': 'Mentor',
                    'leader': 'Leader'
                };
                return badges[badgeId] || badgeId;
            }

            getBadgeIcon(badgeId) {
                const icons = {
                    'early_bird': 'üåÖ',
                    'team_player': 'ü§ù',
                    'innovator': 'üí°',
                    'code_master': 'üíª',
                    'creative': 'üé®',
                    'perfectionist': '‚≠ê',
                    'mentor': 'üéì',
                    'leader': 'üëë'
                };
                return icons[badgeId] || 'üèÜ';
            }

            showAddMemberModal() {
                console.log('INFO: Fonctionnalit√© d\'ajout de membre - En d√©veloppement');
                const modal = document.getElementById('add-member-modal');
                if (modal) {
                    modal.style.display = 'flex';
                }
            }

            sendMessage(memberId) {
                const member = this.members.find(m => m.id === memberId);
                if (member) {
                    console.log(`INFO: Message √† ${member.name}`);
                    window.showToast(`Ouverture du chat avec ${member.name}`, 'info');
                    
                    // Passer √† l'onglet chat
                    document.querySelector('.nav-link[href="#chat"]').click();
                }
            }

            viewMemberProfile(memberId) {
                const member = this.members.find(m => m.id === memberId);
                if (member) {
                    console.log(`INFO: Profil de ${member.name}`);
                    this.showMemberProfileModal(member);
                }
            }

            showMemberProfileModal(member) {
                const modal = document.getElementById('member-profile-modal');
                const modalContent = modal.querySelector('.modal-content');
                
                const joinDate = new Date(member.joinDate).toLocaleDateString('fr-FR');
                const nextLevelXP = (member.level * 250);
                const currentLevelXP = ((member.level - 1) * 250);
                const progressXP = member.xp - currentLevelXP;
                const neededXP = nextLevelXP - member.xp;
                
                modalContent.innerHTML = `
                    <span class="close" onclick="document.getElementById('member-profile-modal').style.display='none'">&times;</span>
                    <div class="member-profile">
                        <div style="text-align: center; margin-bottom: 2rem;">
                            <img src="${member.avatar}" alt="${member.name}" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; margin-bottom: 1rem;" onerror="this.src='assets/default-avatar.png'">
                            <h2 style="margin-bottom: 0.5rem;">${member.name}</h2>
                            <p style="color: #667eea; font-weight: 500; margin-bottom: 0.25rem;">${member.role}</p>
                            <p style="color: #666; font-size: 0.9rem;">${member.email}</p>
                            <div style="display: inline-flex; align-items: center; gap: 0.5rem; background: ${member.status === 'online' ? '#28a745' : member.status === 'away' ? '#ffc107' : '#6c757d'}; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.8rem; margin-top: 0.5rem;">
                                <i class="fas fa-circle" style="font-size: 0.6rem;"></i>
                                ${member.status === 'online' ? 'En ligne' : member.status === 'away' ? 'Absent' : 'Hors ligne'}
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                            <div style="text-align: center; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #667eea; margin-bottom: 0.25rem;">Niveau ${member.level}</div>
                                <div style="font-size: 0.9rem; color: #666;">Niveau actuel</div>
                            </div>
                            <div style="text-align: center; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #28a745; margin-bottom: 0.25rem;">${member.xp}</div>
                                <div style="font-size: 0.9rem; color: #666;">Points XP</div>
                            </div>
                            <div style="text-align: center; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #ffc107; margin-bottom: 0.25rem;">${member.badges.length}</div>
                                <div style="font-size: 0.9rem; color: #666;">Badges obtenus</div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 2rem;">
                            <h4 style="margin-bottom: 1rem;">Progression vers le niveau ${member.level + 1}</h4>
                            <div style="background: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden; margin-bottom: 0.5rem;">
                                <div style="width: ${(progressXP / 250) * 100}%; height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); transition: width 0.3s ease;"></div>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 0.85rem; color: #666;">
                                <span>${progressXP} XP</span>
                                <span>${neededXP > 0 ? neededXP + ' XP restants' : 'Niveau max atteint!'}</span>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 2rem;">
                            <h4 style="margin-bottom: 1rem;">Badges obtenus</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 1rem;">
                                ${member.badges.map(badge => `
                                    <div style="text-align: center; padding: 1rem; background: white; border: 1px solid #e9ecef; border-radius: 8px;">
                                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">${this.getBadgeIcon(badge)}</div>
                                        <div style="font-weight: 500; margin-bottom: 0.25rem; font-size: 0.9rem;">${this.getBadgeName(badge)}</div>
                                    </div>
                                `).join('')}
                                ${member.badges.length === 0 ? '<p style="color: #666; text-align: center; grid-column: 1 / -1;">Aucun badge obtenu pour le moment</p>' : ''}
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 2rem;">
                            <h4 style="margin-bottom: 1rem;">Informations</h4>
                            <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                <div style="display: flex; align-items: center; gap: 0.75rem;">
                                    <i class="fas fa-calendar-alt" style="color: #667eea; width: 16px;"></i>
                                    <span style="color: #666;">Rejoint le ${joinDate}</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 0.75rem;">
                                    <i class="fas fa-briefcase" style="color: #667eea; width: 16px;"></i>
                                    <span style="color: #666;">R√¥le: ${member.role}</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 0.75rem;">
                                    <i class="fas fa-envelope" style="color: #667eea; width: 16px;"></i>
                                    <span style="color: #666;">${member.email}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 1rem; justify-content: center;">
                            <button onclick="teamManager.sendMessage('${member.id}'); document.getElementById('member-profile-modal').style.display='none';" class="btn btn-primary">
                                <i class="fas fa-envelope"></i> Envoyer un message
                            </button>
                            <button onclick="teamManager.assignTask('${member.id}')" class="btn btn-secondary">
                                <i class="fas fa-tasks"></i> Assigner une mission
                            </button>
                        </div>
                    </div>
                `;
                
                modal.style.display = 'flex';
            }

            showMemberOptions(memberId) {
                const member = this.members.find(m => m.id === memberId);
                if (member) {
                    console.log(`INFO: Options pour ${member.name}`);
                    this.showMemberContextMenu(member);
                }
            }

            showMemberContextMenu(member) {
                // Supprimer le menu existant s'il y en a un
                const existingMenu = document.querySelector('.member-context-menu');
                if (existingMenu) {
                    existingMenu.remove();
                }

                const menu = document.createElement('div');
                menu.className = 'member-context-menu';
                menu.innerHTML = `
                    <div class="context-menu-item" onclick="teamManager.viewMemberProfile('${member.id}')">
                        <i class="fas fa-user"></i> Voir le profil
                    </div>
                    <div class="context-menu-item" onclick="teamManager.sendMessage('${member.id}')">
                        <i class="fas fa-envelope"></i> Envoyer un message
                    </div>
                    <div class="context-menu-item" onclick="teamManager.assignTask('${member.id}')">
                        <i class="fas fa-tasks"></i> Assigner une mission
                    </div>
                    <div class="context-menu-item" onclick="teamManager.viewMemberStats('${member.id}')">
                        <i class="fas fa-chart-bar"></i> Voir les statistiques
                    </div>
                    <div class="context-menu-item" onclick="teamManager.editMember('${member.id}')">
                        <i class="fas fa-edit"></i> Modifier les informations
                    </div>
                `;

                document.body.appendChild(menu);

                // Positionner le menu
                const event = window.event;
                if (event) {
                    menu.style.left = event.pageX + 'px';
                    menu.style.top = event.pageY + 'px';
                }

                // Fermer le menu en cliquant ailleurs
                setTimeout(() => {
                    document.addEventListener('click', function closeMenu() {
                        menu.remove();
                        document.removeEventListener('click', closeMenu);
                    });
                }, 100);
            }

            assignTask(memberId) {
                const member = this.members.find(m => m.id === memberId);
                if (member) {
                    console.log(`INFO: Assigner une t√¢che √† ${member.name}`);
                    window.showToast(`Assignation de mission √† ${member.name}`, 'info');
                    
                    // Int√©gration avec le syst√®me de qu√™tes
                    if (window.questManager) {
                        window.questManager.showAssignQuestModal(memberId);
                    }
                }
            }

            viewMemberStats(memberId) {
                const member = this.members.find(m => m.id === memberId);
                if (member) {
                    console.log(`INFO: Statistiques de ${member.name}`);
                    window.showToast(`Affichage des stats de ${member.name}`, 'info');
                    
                    // Passer aux analytics avec filtre membre
                    document.querySelector('.nav-link[href="#analytics"]').click();
                    if (window.analyticsManager) {
                        window.analyticsManager.showMemberAnalytics(memberId);
                    }
                }
            }

            editMember(memberId) {
                const member = this.members.find(m => m.id === memberId);
                if (member) {
                    console.log(`INFO: Modification de ${member.name}`);
                    window.showToast('Fonction de modification bient√¥t disponible', 'info');
                }
            }

            exportTeamData() {
                console.log('INFO: Export des donn√©es d\'√©quipe...');
                
                // Cr√©er les donn√©es CSV
                const csvData = [
                    ['Nom', 'Email', 'R√¥le', 'Niveau', 'XP', 'Badges', 'Statut', 'Date d\'arriv√©e'],
                    ...this.members.map(member => [
                        member.name,
                        member.email,
                        member.role,
                        member.level,
                        member.xp,
                        member.badges.join('; '),
                        member.status,
                        new Date(member.joinDate).toLocaleDateString('fr-FR')
                    ])
                ];

                // Convertir en CSV
                const csvContent = csvData.map(row => row.map(field => `"${field}"`).join(',')).join('\n');
                
                // T√©l√©charger le fichier
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `equipe_synergia_${new Date().toISOString().split('T')[0]}.csv`;
                link.click();

                window.success('Donn√©es d\'√©quipe export√©es avec succ√®s');
            }

            updateMemberXP(memberId, xpGained) {
                const member = this.members.find(m => m.id === memberId);
                if (member) {
                    member.xp += xpGained;
                    const newLevel = Math.floor(member.xp / 250) + 1;
                    if (newLevel > member.level) {
                        member.level = newLevel;
                        console.log(`üéâ ${member.name} monte au niveau ${newLevel}!`);
                        this.showLevelUpNotification(member);
                    }
                    this.renderMembers();
                    this.saveMemberToStorage(member);
                }
            }

            addBadgeToMember(memberId, badgeId) {
                const member = this.members.find(m => m.id === memberId);
                if (member && !member.badges.includes(badgeId)) {
                    member.badges.push(badgeId);
                    console.log(`üèÜ ${member.name} obtient le badge: ${this.getBadgeName(badgeId)}`);
                    this.renderMembers();
                    this.showBadgeNotification(member, badgeId);
                    this.saveMemberToStorage(member);
                }
            }

            showLevelUpNotification(member) {
                const notification = document.createElement('div');
                notification.className = 'level-up-notification notification';
                notification.innerHTML = `
                    <div class="notification-content">
                        <i class="fas fa-star"></i>
                        <div>
                            <h4>Niveau sup√©rieur !</h4>
                            <p>${member.name} atteint le niveau ${member.level}</p>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 5000);
            }

            showBadgeNotification(member, badgeId) {
                const notification = document.createElement('div');
                notification.className = 'badge-notification notification';
                notification.innerHTML = `
                    <div class="notification-content">
                        <i class="fas fa-trophy"></i>
                        <div>
                            <h4>Nouveau badge !</h4>
                            <p>${member.name} obtient: ${this.getBadgeName(badgeId)}</p>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 5000);
            }

            saveMemberToStorage(member) {
                // Sauvegarder en localStorage pour la persistance en mode d√©mo
                try {
                    localStorage.setItem(`synergia_member_${member.id}`, JSON.stringify(member));
                } catch (error) {
                    console.warn('Impossible de sauvegarder en localStorage');
                }
            }

            getAllMembers() {
                return this.members;
            }

            getMemberById(memberId) {
                return this.members.find(m => m.id === memberId);
            }

            async refreshMembers() {
                await this.loadMembers();
            }
        }

        // Planning Manager
        class PlanningManager {
            constructor() {
                this.events = [];
                this.currentDate = new Date();
                this.init();
            }

            async init() {
                console.log('‚úÖ Planning Manager initialis√©');
                await this.loadEvents();
                this.renderCalendar();
                this.setupEventListeners();
            }

            async loadEvents() {
                try {
                    const user = (window.auth && window.auth.currentUser) || currentUser;
                    if (!user) {
                        console.log('‚ùå Utilisateur non connect√© pour charger les √©v√©nements');
                        this.loadDemoEvents();
                        return;
                    }

                    // V√©rifier les permissions Firebase
                    try {
                        if (window.db && window.firebase) {
                            const testQuery = window.firebase.query(
                                window.firebase.collection(window.db, 'events'), 
                                window.firebase.limit(1)
                            );
                            await window.firebase.getDocs(testQuery);
                            console.log('‚úÖ Permissions √©v√©nements v√©rifi√©es');

                            const eventsRef = window.firebase.collection(window.db, 'events');
                            const snapshot = await window.firebase.getDocs(eventsRef);
                            
                            this.events = [];
                            snapshot.forEach(doc => {
                                this.events.push({
                                    id: doc.id,
                                    ...doc.data()
                                });
                            });

                            console.log(`‚úÖ ${this.events.length} √©v√©nements charg√©s depuis Firebase`);
                        } else {
                            throw new Error('Firebase non disponible');
                        }
                    } catch (permError) {
                        console.log('‚ùå Permissions insuffisantes pour les √©v√©nements, chargement d√©mo');
                        this.loadDemoEvents();
                    }
                } catch (error) {
                    console.error('‚ùå Erreur chargement √©v√©nements:', error);
                    this.loadDemoEvents();
                }
            }

            loadDemoEvents() {
                this.events = [
                    {
                        id: 'demo1',
                        title: 'R√©union √©quipe',
                        description: 'Point hebdomadaire d\'√©quipe',
                        date: new Date(2024, 11, 16, 10, 0),
                        type: 'meeting',
                        participants: ['demo1', 'demo2', 'demo3'],
                        createdBy: 'demo1'
                    },
                    {
                        id: 'demo2',
                        title: 'Formation SYNERGIA',
                        description: 'Formation sur les nouvelles fonctionnalit√©s',
                        date: new Date(2024, 11, 20, 14, 0),
                        type: 'training',
                        participants: ['demo1', 'demo2'],
                        createdBy: 'demo1'
                    },
                    {
                        id: 'demo3',
                        title: 'Anniversaire Marie',
                        description: 'C√©l√©bration d\'anniversaire',
                        date: new Date(2024, 11, 23, 12, 0),
                        type: 'social',
                        participants: ['demo1', 'demo2', 'demo3'],
                        createdBy: 'demo2'
                    }
                ];
                console.log('üìÖ √âv√©nements de d√©monstration charg√©s');
                this.updateEventsList();
            }

            renderCalendar() {
                const calendar = document.getElementById('calendar');
                const currentMonth = document.getElementById('current-month');
                
                if (currentMonth) {
                    currentMonth.textContent = this.currentDate.toLocaleDateString('fr-FR', { 
                        month: 'long', 
                        year: 'numeric' 
                    });
                }

                if (calendar) {
                    // Pour l'instant, affichage simple
                    calendar.innerHTML = `
                        <div style="text-align: center; color: #666; padding: 3rem;">
                            <i class="fas fa-calendar-alt" style="font-size: 3rem; margin-bottom: 1rem; color: #ccc;"></i>
                            <h3>Calendrier interactif</h3>
                            <p>Vue ${this.currentDate.toLocaleDateString('fr-FR', { month: 'long', year: 'numeric' })}</p>
                            <p style="font-size: 0.9rem; margin-top: 1rem; color: #999;">
                                Calendrier complet bient√¥t disponible<br>
                                Consultez la liste des √©v√©nements √† droite
                            </p>
                        </div>
                    `;
                }
                
                this.updateEventsList();
            }

            updateEventsList() {
                const container = document.getElementById('events-container');
                if (!container) return;

                if (this.events.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 2rem; color: #666;">
                            <i class="fas fa-calendar-plus" style="font-size: 2rem; margin-bottom: 1rem; color: #ccc;"></i>
                            <p>Aucun √©v√©nement planifi√©</p>
                            <button onclick="planningManager.showAddEventModal()" class="btn btn-primary" style="margin-top: 1rem;">
                                <i class="fas fa-plus"></i> Cr√©er un √©v√©nement
                            </button>
                        </div>
                    `;
                    return;
                }

                // Trier les √©v√©nements par date
                const sortedEvents = this.events.sort((a, b) => new Date(a.date) - new Date(b.date));
                
                container.innerHTML = '';
                sortedEvents.forEach(event => {
                    const eventElement = this.createEventElement(event);
                    container.appendChild(eventElement);
                });

                // Mettre √† jour le compteur du dashboard
                const today = new Date();
                const todayEvents = this.events.filter(event => {
                    const eventDate = new Date(event.date);
                    return eventDate.toDateString() === today.toDateString();
                });
                document.getElementById('events-today').textContent = todayEvents.length;
            }

            createEventElement(event) {
                const eventDate = new Date(event.date);
                const now = new Date();
                const isToday = eventDate.toDateString() === now.toDateString();
                const isPast = eventDate < now;
                
                const typeIcons = {
                    'meeting': 'fas fa-users',
                    'deadline': 'fas fa-clock',
                    'event': 'fas fa-star',
                    'reminder': 'fas fa-bell',
                    'training': 'fas fa-graduation-cap',
                    'social': 'fas fa-birthday-cake'
                };

                const typeColors = {
                    'meeting': '#667eea',
                    'deadline': '#dc3545',
                    'event': '#ffc107',
                    'reminder': '#6c757d',
                    'training': '#28a745',
                    'social': '#e83e8c'
                };

                const element = document.createElement('div');
                element.className = `activity-item ${isPast ? 'past-event' : ''} ${isToday ? 'today-event' : ''}`;
                element.style.cursor = 'pointer';
                element.style.opacity = isPast ? '0.6' : '1';
                element.style.borderLeft = isToday ? '3px solid #28a745' : 'none';
                element.style.paddingLeft = isToday ? '1rem' : '1.25rem';

                element.innerHTML = `
                    <i class="${typeIcons[event.type] || 'fas fa-calendar'}" style="color: ${typeColors[event.type] || '#667eea'};"></i>
                    <div style="flex: 1;">
                        <strong>${event.title}</strong>
                        ${event.description ? `<br><small style="color: #666;">${event.description}</small>` : ''}
                        <br><small style="color: ${isToday ? '#28a745' : '#666'}; font-weight: ${isToday ? 'bold' : 'normal'};">
                            ${isToday ? 'Aujourd\'hui' : eventDate.toLocaleDateString('fr-FR')} √† ${eventDate.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' })}
                        </small>
                    </div>
                    <div style="display: flex; flex-direction: column; align-items: center;">
                        ${event.participants ? `<small style="color: #666;">${event.participants.length} participant${event.participants.length > 1 ? 's' : ''}</small>` : ''}
                        <button class="btn-icon" onclick="planningManager.editEvent('${event.id}')" title="Modifier">
                            <i class="fas fa-edit"></i>
                        </button>
                    </div>
                `;

                element.addEventListener('click', () => {
                    this.showEventDetails(event);
                });

                return element;
            }

            setupEventListeners() {
                const addEventBtn = document.getElementById('add-event-btn');
                if (addEventBtn) {
                    addEventBtn.addEventListener('click', () => {
                        this.showAddEventModal();
                    });
                }

                const syncBtn = document.getElementById('sync-calendar-btn');
                if (syncBtn) {
                    syncBtn.addEventListener('click', () => {
                        this.syncCalendar();
                    });
                }

                const prevBtn = document.getElementById('prev-month');
                const nextBtn = document.getElementById('next-month');
                
                if (prevBtn) {
                    prevBtn.addEventListener('click', () => {
                        this.currentDate.setMonth(this.currentDate.getMonth() - 1);
                        this.renderCalendar();
                    });
                }

                if (nextBtn) {
                    nextBtn.addEventListener('click', () => {
                        this.currentDate.setMonth(this.currentDate.getMonth() + 1);
                        this.renderCalendar();
                    });
                }

                const viewSelect = document.getElementById('planning-view');
                if (viewSelect) {
                    viewSelect.addEventListener('change', (e) => {
                        this.changeView(e.target.value);
                    });
                }

                const viewAllBtn = document.getElementById('view-all-events');
                if (viewAllBtn) {
                    viewAllBtn.addEventListener('click', () => {
                        this.showAllEventsModal();
                    });
                }

                // Form submit
                const addEventForm = document.getElementById('add-event-form');
                if (addEventForm) {
                    addEventForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.saveEvent();
                    });
                }
            }

            showAddEventModal() {
                console.log('INFO: Ouverture du modal d\'ajout d\'√©v√©nement');
                const modal = document.getElementById('add-event-modal');
                if (modal) {
                    // Pr√©-remplir avec la date d'aujourd'hui
                    const today = new Date();
                    document.getElementById('event-date').value = today.toISOString().split('T')[0];
                    document.getElementById('event-time').value = '10:00';
                    
                    modal.style.display = 'flex';
                }
            }

            showEventDetails(event) {
                const eventDate = new Date(event.date);
                window.showToast(`√âv√©nement: ${event.title} - ${eventDate.toLocaleDateString('fr-FR')} √† ${eventDate.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' })}`, 'info', 5000);
            }

            changeView(view) {
                console.log(`INFO: Changement de vue vers: ${view}`);
                window.showToast(`Vue ${view} s√©lectionn√©e`, 'info');
            }

            showAllEventsModal() {
                console.log('INFO: Affichage de tous les √©v√©nements');
                window.showToast('Liste compl√®te des √©v√©nements', 'info');
            }

            editEvent(eventId) {
                const event = this.events.find(e => e.id === eventId);
                if (event) {
                    console.log(`INFO: Modification de l'√©v√©nement: ${event.title}`);
                    window.showToast(`Modification de "${event.title}"`, 'info');
                }
            }

            async syncCalendar() {
                console.log('INFO: Synchronisation en cours...');
                window.showToast('Synchronisation du calendrier...', 'info');
                
                // Simulation de synchronisation
                setTimeout(() => {
                    console.log('SUCCESS: Calendrier synchronis√©!');
                    window.success('Calendrier synchronis√© avec succ√®s');
                }, 2000);
            }

            async saveEvent() {
                try {
                    const title = document.getElementById('event-title').value.trim();
                    const description = document.getElementById('event-description').value.trim();
                    const date = document.getElementById('event-date').value;
                    const time = document.getElementById('event-time').value;
                    const type = document.getElementById('event-type').value;

                    if (!title) {
                        window.error('Le titre est obligatoire');
                        return;
                    }

                    if (!date || !time) {
                        window.error('La date et l\'heure sont obligatoires');
                        return;
                    }

                    const eventDate = new Date(`${date}T${time}`);
                    const participants = [];

                    // R√©cup√©rer les participants s√©lectionn√©s
                    const checkboxes = document.querySelectorAll('#add-event-form input[type="checkbox"]:checked');
                    checkboxes.forEach(cb => {
                        if (cb.value !== 'all') {
                            participants.push(cb.value);
                        } else {
                            participants.push('demo1', 'demo2', 'demo3');
                        }
                    });

                    const newEvent = {
                        id: 'event_' + Date.now(),
                        title,
                        description,
                        date: eventDate,
                        type,
                        participants: participants,
                        createdBy: currentUser?.uid || 'demo1',
                        createdAt: new Date()
                    };

                    // Tentative de sauvegarde Firebase
                    try {
                        const user = auth.currentUser || currentUser;
                        if (user) {
                            const eventsRef = collection(db, 'events');
                            await addDoc(eventsRef, {
                                ...newEvent,
                                date: newEvent.date.toISOString(),
                                createdAt: newEvent.createdAt.toISOString()
                            });
                            console.log('SUCCESS: √âv√©nement sauvegard√© en Firebase');
                        }
                    } catch (firebaseError) {
                        console.log('WARNING: Sauvegarde Firebase √©chou√©e, sauvegarde locale');
                    }

                    // Ajouter √† la liste locale
                    this.events.push(newEvent);
                    this.updateEventsList();

                    // Fermer le modal et r√©initialiser le formulaire
                    document.getElementById('add-event-modal').style.display = 'none';
                    document.getElementById('add-event-form').reset();

                    window.success(`√âv√©nement "${title}" cr√©√© avec succ√®s`);

                } catch (error) {
                    console.error('‚ùå Erreur lors de la cr√©ation de l\'√©v√©nement:', error);
                    window.error('Erreur lors de la cr√©ation de l\'√©v√©nement');
                }
            }
        }

        // Chat Manager
        class ChatManager {
            constructor() {
                this.conversations = [];
                this.currentConversation = null;
                this.messages = [];
                this.init();
            }

            async init() {
                console.log('üí¨ Chat Manager initialis√©');
                await this.loadConversations();
                this.setupEventListeners();
            }

            async loadConversations() {
                try {
                    const user = (window.auth && window.auth.currentUser) || currentUser;
                    if (!user) {
                        console.log('‚ùå Utilisateur non connect√© pour charger les conversations');
                        this.loadDemoConversations();
                        return;
                    }

                    // V√©rifier les permissions Firebase
                    try {
                        if (window.db && window.firebase) {
                            const testQuery = window.firebase.query(
                                window.firebase.collection(window.db, 'conversations'), 
                                window.firebase.limit(1)
                            );
                            await window.firebase.getDocs(testQuery);
                            console.log('‚úÖ Permissions conversations v√©rifi√©es');

                            const conversationsRef = window.firebase.collection(window.db, 'conversations');
                            const snapshot = await window.firebase.getDocs(conversationsRef);
                            
                            this.conversations = [];
                            snapshot.forEach(doc => {
                                this.conversations.push({
                                    id: doc.id,
                                    ...doc.data()
                                });
                            });

                            console.log(`üí¨ ${this.conversations.length} conversations charg√©es depuis Firebase`);
                        } else {
                            throw new Error('Firebase non disponible');
                        }
                    } catch (permError) {
                        console.log('‚ùå Erreur Firebase conversations, chargement d√©mo');
                        this.loadDemoConversations();
                    }
                } catch (error) {
                    console.error('‚ùå Erreur chargement conversations:', error);
                    this.loadDemoConversations();
                }
            }

            loadDemoConversations() {
                this.conversations = [
                    {
                        id: 'demo1',
                        name: '√âquipe G√©n√©rale',
                        type: 'group',
                        participants: ['demo1', 'demo2', 'demo3'],
                        lastMessage: 'Bonne journ√©e √† tous!',
                        lastMessageTime: new Date(),
                        unreadCount: 0,
                        isActive: true
                    },
                    {
                        id: 'demo2',
                        name: 'Projet SYNERGIA',
                        type: 'group',
                        participants: ['demo1', 'demo2'],
                        lastMessage: 'Les nouvelles fonctionnalit√©s sont pr√™tes',
                        lastMessageTime: new Date(Date.now() - 3600000),
                        unreadCount: 0,
                        isActive: true
                    },
                    {
                        id: 'demo3',
                        name: 'Allan Boehme',
                        type: 'private',
                        participants: ['demo1'],
                        lastMessage: 'Message priv√©...',
                        lastMessageTime: new Date(Date.now() - 86400000),
                        unreadCount: 2,
                        isActive: false
                    }
                ];
                console.log('üí¨ Conversations de d√©monstration charg√©es');
                this.renderConversations();
            }

            renderConversations() {
                const container = document.getElementById('conversations-list');
                if (!container) return;

                // Le container est d√©j√† rempli dans le HTML, on peut ajouter plus de logique ici
                // Pour l'instant, on garde le contenu statique du HTML
            }

            setupEventListeners() {
                const newConversationBtn = document.getElementById('new-conversation-btn');
                if (newConversationBtn) {
                    newConversationBtn.addEventListener('click', () => {
                        this.showNewConversationModal();
                    });
                }

                const videoCallBtn = document.getElementById('video-call-btn');
                if (videoCallBtn) {
                    videoCallBtn.addEventListener('click', () => {
                        console.log('INFO: Appel vid√©o - Bient√¥t disponible');
                        window.showToast('Appel vid√©o bient√¥t disponible', 'info');
                    });
                }

                const audioCallBtn = document.getElementById('audio-call-btn');
                if (audioCallBtn) {
                    audioCallBtn.addEventListener('click', () => {
                        console.log('INFO: Appel audio - Bient√¥t disponible');
                        window.showToast('Appel audio bient√¥t disponible', 'info');
                    });
                }

                const chatInfoBtn = document.getElementById('chat-info-btn');
                if (chatInfoBtn) {
                    chatInfoBtn.addEventListener('click', () => {
                        console.log('INFO: Informations conversation - Bient√¥t disponible');
                        window.showToast('Informations de conversation', 'info');
                    });
                }

                const sendBtn = document.getElementById('send-message-btn');
                const messageInput = document.getElementById('message-input');
                
                if (sendBtn) {
                    sendBtn.addEventListener('click', () => {
                        this.sendMessage();
                    });
                }

                if (messageInput) {
                    messageInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            this.sendMessage();
                        }
                    });
                }

                const chatSettingsBtn = document.getElementById('chat-settings-btn');
                if (chatSettingsBtn) {
                    chatSettingsBtn.addEventListener('click', () => {
                        this.showChatSettings();
                    });
                }

                const chatStatusSelect = document.getElementById('chat-status');
                if (chatStatusSelect) {
                    chatStatusSelect.addEventListener('change', (e) => {
                        this.updateUserStatus(e.target.value);
                    });
                }
            }

            showNewConversationModal() {
                console.log('INFO: Nouvelle conversation - Bient√¥t disponible');
                window.showToast('Cr√©ation de nouvelle conversation bient√¥t disponible', 'info');
            }

            sendMessage() {
                const input = document.getElementById('message-input');
                const message = input.value.trim();
                
                if (!message) return;

                console.log(`üí¨ Envoi du message: ${message}`);
                
                // Ajouter le message √† l'interface
                this.addMessageToUI({
                    content: message,
                    sender: currentUser?.displayName || 'Vous',
                    timestamp: new Date(),
                    isOwn: true
                });

                // Vider l'input
                input.value = '';

                // Simuler une r√©ponse automatique
                setTimeout(() => {
                    const responses = [
                        "Message re√ßu ! üëç",
                        "Parfait, merci pour l'info",
                        "C'est not√© üìù",
                        "Super id√©e ! üí°",
                        "Je suis d'accord",
                        "On en discute en r√©union ?"
                    ];
                    
                    const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                    this.addMessageToUI({
                        content: randomResponse,
                        sender: '√âquipe',
                        timestamp: new Date(),
                        isOwn: false
                    });
                }, 1000 + Math.random() * 2000);

                // Notifier le Quest Manager si c'est un message d'√©quipe
                if (window.questManager) {
                    window.questManager.handleTeamMessage();
                }

                window.success('Message envoy√©');
            }

            addMessageToUI(message) {
                const messagesContainer = document.getElementById('messages-container');
                if (!messagesContainer) return;

                const messageElement = document.createElement('div');
                messageElement.style.cssText = `
                    display: flex; 
                    gap: 1rem; 
                    padding: 1rem; 
                    margin-bottom: 0.5rem; 
                    ${message.isOwn ? 'flex-direction: row-reverse;' : ''}
                `;

                const avatarUrl = message.isOwn ? 'assets/default-avatar.png' : 'assets/default-avatar.png';
                
                messageElement.innerHTML = `
                    <img src="${avatarUrl}" alt="${message.sender}" style="width: 40px; height: 40px; border-radius: 50%;">
                    <div ${message.isOwn ? 'style="text-align: right;"' : ''}>
                        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem; ${message.isOwn ? 'flex-direction: row-reverse;' : ''}">
                            <strong>${message.sender}</strong>
                            <small style="color: #666;">${message.timestamp.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' })}</small>
                        </div>
                        <div style="background: ${message.isOwn ? '#667eea' : '#f8f9fa'}; color: ${message.isOwn ? 'white' : 'black'}; padding: 0.75rem; border-radius: 12px; ${message.isOwn ? 'border-top-right-radius: 4px;' : 'border-top-left-radius: 4px;'}">
                            ${message.content}
                        </div>
                    </div>
                `;

                messagesContainer.appendChild(messageElement);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }

            showChatSettings() {
                const modal = document.getElementById('chat-settings-modal');
                if (modal) {
                    modal.style.display = 'flex';
                }
            }

            updateUserStatus(status) {
                console.log(`INFO: Statut mis √† jour: ${status}`);
                const statusText = {
                    'online': 'En ligne',
                    'away': 'Absent',
                    'busy': 'Occup√©',
                    'offline': 'Hors ligne'
                };
                window.showToast(`Statut: ${statusText[status]}`, 'info');
            }

            startPrivateChat(memberId) {
                console.log(`INFO: Chat priv√© avec membre ${memberId}`);
                window.showToast('Ouverture du chat priv√©', 'info');
            }
        }

        // Analytics Manager
        class AnalyticsManager {
            constructor() {
                this.data = {};
                this.charts = {};
                this.init();
            }

            async init() {
                console.log('üìä Analytics Manager initialis√©');
                await this.loadAnalyticsData();
                this.setupEventListeners();
                this.initializeCharts();
            }

            async loadAnalyticsData() {
                console.log('üìä Chargement des donn√©es analytics...');
                
                // Simulation de chargement de donn√©es
                this.data = {
                    attendance: {
                        labels: ['Lun', 'Mar', 'Mer', 'Jeu', 'Ven'],
                        data: [85, 92, 78, 96, 89],
                        average: 88
                    },
                    xp: {
                        labels: ['Sem 1', 'Sem 2', 'Sem 3', 'Sem 4'],
                        data: [1250, 1350, 1450, 1600],
                        weekly: [100, 100, 150]
                    },
                    quests: {
                        labels: ['Lun', 'Mar', 'Mer', 'Jeu', 'Ven'],
                        data: [3, 5, 2, 7, 4],
                        total: 21
                    },
                    performance: {
                        totalMembers: teamManager ? teamManager.members.length : 3,
                        totalQuests: 21,
                        totalEvents: planningManager ? planningManager.events.length : 5,
                        avgAttendance: 88,
                        productivity: 12,
                        engagement: 8,
                        collaboration: 15
                    }
                };
                
                this.updateAnalytics();
                console.log('SUCCESS: Analytics actualis√©es');
            }

            updateAnalytics() {
                // Mettre √† jour les statistiques globales
                const elements = {
                    'total-members': this.data.performance.totalMembers,
                    'total-quests': this.data.performance.totalQuests,
                    'total-events': this.data.performance.totalEvents,
                    'avg-attendance': `${this.data.performance.avgAttendance}%`
                };

                Object.entries(elements).forEach(([id, value]) => {
                    const element = document.getElementById(id);
                    if (element) element.textContent = value;
                });

                // Mettre √† jour les graphiques
                this.updateCharts();
            }

            initializeCharts() {
                // V√©rifier que Chart.js est disponible
                if (typeof Chart === 'undefined') {
                    console.warn('Chart.js non disponible');
                    return;
                }

                this.createAttendanceChart();
                this.createXPChart();
                this.createQuestsChart();
            }

            createAttendanceChart() {
                const ctx = document.getElementById('attendance-chart');
                if (!ctx) return;

                this.charts.attendance = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: this.data.attendance.labels,
                        datasets: [{
                            label: 'Pr√©sence (%)',
                            data: this.data.attendance.data,
                            borderColor: '#28a745',
                            backgroundColor: 'rgba(40, 167, 69, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                ticks: {
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
            }

            createXPChart() {
                const ctx = document.getElementById('xp-chart');
                if (!ctx) return;

                this.charts.xp = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: this.data.xp.labels,
                        datasets: [{
                            label: 'XP Total',
                            data: this.data.xp.data,
                            backgroundColor: '#667eea',
                            borderRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
            }

            createQuestsChart() {
                const ctx = document.getElementById('quests-chart');
                if (!ctx) return;

                this.charts.quests = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Quotidiennes', 'Hebdomadaires', 'Sp√©ciales'],
                        datasets: [{
                            data: [15, 4, 2],
                            backgroundColor: ['#ffc107', '#667eea', '#28a745'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }

            updateCharts() {
                // Mettre √† jour les donn√©es des graphiques
                Object.values(this.charts).forEach(chart => {
                    if (chart) chart.update();
                });
            }

            setupEventListeners() {
                const exportBtn = document.getElementById('export-data-btn');
                if (exportBtn) {
                    exportBtn.addEventListener('click', () => {
                        this.exportData();
                    });
                }

                const refreshBtn = document.getElementById('refresh-analytics-btn');
                if (refreshBtn) {
                    refreshBtn.addEventListener('click', () => {
                        this.refreshAnalytics();
                    });
                }

                const periodSelect = document.getElementById('analytics-period');
                if (periodSelect) {
                    periodSelect.addEventListener('change', (e) => {
                        this.changePeriod(e.target.value);
                    });
                }

                const advancedBtn = document.getElementById('advanced-analytics-btn');
                if (advancedBtn) {
                    advancedBtn.addEventListener('click', () => {
                        this.showAdvancedAnalytics();
                    });
                }

                const exportAllBtn = document.getElementById('export-all-reports-btn');
                if (exportAllBtn) {
                    exportAllBtn.addEventListener('click', () => {
                        this.exportAllReports();
                    });
                }
            }

            switchView(chartType, period) {
                console.log(`INFO: Vue ${chartType} - Graphique mis √† jour`);
                window.showToast(`Graphique ${chartType} - p√©riode ${period}`, 'info');
            }

            changePeriod(period) {
                console.log(`INFO: Changement de p√©riode: ${period}`);
                window.showToast(`P√©riode chang√©e: ${period}`, 'info');
                this.loadAnalyticsData();
            }

            refreshAnalytics() {
                console.log('INFO: Actualisation des analytics...');
                window.showToast('Actualisation des donn√©es...', 'info');
                this.loadAnalyticsData();
            }

            showAdvancedAnalytics() {
                console.log('INFO: Analytics avanc√©es');
                window.showToast('Analytics avanc√©es bient√¥t disponibles', 'info');
            }

            generateReport(reportType) {
                console.log(`INFO: G√©n√©ration du rapport ${reportType}...`);
                window.showToast(`G√©n√©ration du rapport ${reportType}...`, 'info');
                
                if (reportType === 'attendance') {
                    console.log('INFO: T√©l√©chargement du rapport attendance...');
                    console.log('INFO: Partage du rapport attendance...');
                    console.log('INFO: G√©n√©ration du rapport en cours...');
                    setTimeout(() => {
                        console.log('SUCCESS: Rapport g√©n√©r√© avec succ√®s!');
                        window.success('Rapport de pr√©sence g√©n√©r√©');
                    }, 2000);
                }
            }

            exportData() {
                console.log('INFO: Export des donn√©es en cours...');
                window.showToast('Export des donn√©es...', 'info');
                
                setTimeout(() => {
                    console.log('SUCCESS: Donn√©es export√©es vers CSV');
                    window.success('Donn√©es export√©es vers CSV');
                    
                    // Cr√©er et t√©l√©charger un fichier CSV
                    const csvData = [
                        ['Type', 'Valeur', 'Date'],
                        ['Membres actifs', this.data.performance.totalMembers, new Date().toLocaleDateString()],
                        ['Missions totales', this.data.performance.totalQuests, new Date().toLocaleDateString()],
                        ['√âv√©nements', this.data.performance.totalEvents, new Date().toLocaleDateString()],
                        ['Pr√©sence moyenne', `${this.data.performance.avgAttendance}%`, new Date().toLocaleDateString()]
                    ];

                    const csvContent = csvData.map(row => row.join(',')).join('\n');
                    const blob = new Blob([csvContent], { type: 'text/csv' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `analytics_synergia_${new Date().toISOString().split('T')[0]}.csv`;
                    a.click();
                    URL.revokeObjectURL(url);
                }, 1000);
            }

            exportAllReports() {
                console.log('INFO: Export de tous les rapports...');
                window.showToast('Export de tous les rapports...', 'info');
                
                setTimeout(() => {
                    window.success('Tous les rapports export√©s');
                }, 2000);
            }

            showMemberAnalytics(memberId) {
                console.log(`INFO: Analytics pour membre ${memberId}`);
                window.showToast('Analytics personnalis√©es', 'info');
            }
        }

        // Badging Manager
        class BadgingManager {
            constructor() {
                this.clockedIn = false;
                this.currentSession = null;
                this.attendanceHistory = [];
                this.init();
            }

            init() {
                console.log('‚úÖ Badging Manager initialized');
                this.loadAttendanceHistory();
                this.setupEventListeners();
                this.createBadgingInterface();
            }

            loadAttendanceHistory() {
                // Charger l'historique depuis localStorage ou Firebase
                try {
                    const saved = localStorage.getItem('synergia_attendance');
                    if (saved) {
                        this.attendanceHistory = JSON.parse(saved);
                    }
                } catch (error) {
                    console.warn('Impossible de charger l\'historique de pr√©sence');
                }
            }

            saveAttendanceHistory() {
                try {
                    localStorage.setItem('synergia_attendance', JSON.stringify(this.attendanceHistory));
                } catch (error) {
                    console.warn('Impossible de sauvegarder l\'historique de pr√©sence');
                }
            }

            createBadgingInterface() {
                // Ajouter l'interface de pointage au dashboard
                const dashboardWidget = document.createElement('div');
                dashboardWidget.className = 'dashboard-widget animate-slide-up';
                dashboardWidget.innerHTML = `
                    <h3><i class="fas fa-clock"></i> Pointage</h3>
                    <div style="text-align: center; padding: 1rem;">
                        <div style="font-size: 1.2rem; margin-bottom: 1rem; color: #667eea;">
                            <i class="fas fa-clock"></i>
                            <span id="current-time">${new Date().toLocaleTimeString('fr-FR')}</span>
                        </div>
                        <div style="display: flex; gap: 0.5rem; justify-content: center; flex-wrap: wrap;">
                            <button id="clock-in-btn" class="btn btn-primary" ${this.clockedIn ? 'disabled' : ''}>
                                <i class="fas fa-sign-in-alt"></i> Arriv√©e
                            </button>
                            <button id="clock-out-btn" class="btn btn-secondary" ${!this.clockedIn ? 'disabled' : ''}>
                                <i class="fas fa-sign-out-alt"></i> D√©part
                            </button>
                            <button id="break-start-btn" class="btn btn-secondary" ${!this.clockedIn ? 'disabled' : ''}>
                                <i class="fas fa-coffee"></i> Pause
                            </button>
                        </div>
                        <div id="session-info" style="margin-top: 1rem; font-size: 0.9rem; color: #666;">
                            ${this.clockedIn ? 'En service' : 'Non point√©'}
                        </div>
                    </div>
                `;

                // Ajouter au dashboard
                const dashboardGrid = document.querySelector('.dashboard-grid');
                if (dashboardGrid) {
                    dashboardGrid.appendChild(dashboardWidget);
                }

                // Mettre √† jour l'heure toutes les secondes
                setInterval(() => {
                    const timeElement = document.getElementById('current-time');
                    if (timeElement) {
                        timeElement.textContent = new Date().toLocaleTimeString('fr-FR');
                    }
                }, 1000);
            }

            setupEventListeners() {
                // Utiliser la d√©l√©gation d'√©v√©nements car les boutons sont cr√©√©s dynamiquement
                document.addEventListener('click', (e) => {
                    switch (e.target.id) {
                        case 'clock-in-btn':
                            this.clockIn();
                            break;
                        case 'clock-out-btn':
                            this.clockOut();
                            break;
                        case 'break-start-btn':
                            this.startBreak();
                            break;
                        case 'break-end-btn':
                            this.endBreak();
                            break;
                    }
                });
            }

            clockIn() {
                const now = new Date();
                this.clockedIn = true;
                this.currentSession = {
                    clockIn: now,
                    breaks: [],
                    date: now.toDateString()
                };
                
                console.log('SUCCESS: Pointage d\'arriv√©e enregistr√©!');
                window.success('Pointage d\'arriv√©e enregistr√©!');
                
                // Mettre √† jour l'interface
                this.updateBadgingInterface();
                
                // Notifier le Quest Manager
                if (window.questManager) {
                    window.questManager.handleCheckin(now);
                }
                
                // √âmettre √©v√©nement personnalis√©
                document.dispatchEvent(new CustomEvent('synergia:checkin', {
                    detail: { time: now }
                }));

                // V√©rifier si c'est une arriv√©e matinale
                if (now.getHours() < 9) {
                    window.success('Bravo ! Arriv√©e matinale üåÖ');
                }
            }

            clockOut() {
                if (!this.currentSession) {
                    window.error('Aucune session active');
                    return;
                }

                const now = new Date();
                this.currentSession.clockOut = now;
                
                // Calculer la dur√©e de travail
                const workDuration = this.calculateWorkDuration(this.currentSession);
                
                // Ajouter √† l'historique
                this.attendanceHistory.push({
                    ...this.currentSession,
                    workDuration
                });
                
                console.log('SUCCESS: Pointage de d√©part enregistr√©!');
                window.success(`Pointage de d√©part enregistr√©! Dur√©e: ${workDuration}`);
                
                // V√©rifier si c'est une journ√©e parfaite
                this.checkPerfectDay();
                
                // R√©initialiser
                this.clockedIn = false;
                this.currentSession = null;
                this.updateBadgingInterface();
                this.saveAttendanceHistory();
            }

            startBreak() {
                if (!this.currentSession) {
                    window.error('Aucune session active');
                    return;
                }

                this.currentSession.breaks.push({
                    start: new Date()
                });
                
                console.log('INFO: Pause commenc√©e');
                window.showToast('Pause commenc√©e', 'info');
                this.updateBadgingInterface();
            }

            endBreak() {
                if (!this.currentSession || this.currentSession.breaks.length === 0) {
                    window.error('Aucune pause active');
                    return;
                }

                const lastBreak = this.currentSession.breaks[this.currentSession.breaks.length - 1];
                if (!lastBreak.end) {
                    lastBreak.end = new Date();
                    console.log('INFO: Pause termin√©e');
                    window.showToast('Pause termin√©e', 'info');
                    this.updateBadgingInterface();
                }
            }

            calculateWorkDuration(session) {
                if (!session.clockOut) return '0h00';

                let totalWork = session.clockOut - session.clockIn;
                
                // Soustraire les pauses
                session.breaks.forEach(breakPeriod => {
                    if (breakPeriod.end) {
                        totalWork -= (breakPeriod.end - breakPeriod.start);
                    }
                });

                const hours = Math.floor(totalWork / (1000 * 60 * 60));
                const minutes = Math.floor((totalWork % (1000 * 60 * 60)) / (1000 * 60));
                
                return `${hours}h${minutes.toString().padStart(2, '0')}`;
            }

            updateBadgingInterface() {
                const clockInBtn = document.getElementById('clock-in-btn');
                const clockOutBtn = document.getElementById('clock-out-btn');
                const breakStartBtn = document.getElementById('break-start-btn');
                const sessionInfo = document.getElementById('session-info');

                if (clockInBtn) clockInBtn.disabled = this.clockedIn;
                if (clockOutBtn) clockOutBtn.disabled = !this.clockedIn;
                if (breakStartBtn) breakStartBtn.disabled = !this.clockedIn;

                if (sessionInfo) {
                    if (this.clockedIn && this.currentSession) {
                        const duration = this.calculateWorkDuration({
                            ...this.currentSession,
                            clockOut: new Date()
                        });
                        sessionInfo.innerHTML = `
                            En service depuis ${this.currentSession.clockIn.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' })}
                            <br><small>Dur√©e: ${duration}</small>
                        `;
                    } else {
                        sessionInfo.textContent = 'Non point√©';
                    }
                }
            }

            checkPerfectDay() {
                if (!this.currentSession) return;

                const clockIn = this.currentSession.clockIn;
                const clockOut = this.currentSession.clockOut;
                
                // Journ√©e parfaite = arriv√©e avant 9h30 et d√©part apr√®s 17h
                const isPerfect = clockIn.getHours() < 9 || (clockIn.getHours() === 9 && clockIn.getMinutes() <= 30);
                const isFullDay = clockOut.getHours() >= 17;
                
                if (isPerfect && isFullDay) {
                    console.log('‚≠ê Journ√©e parfaite d√©tect√©e!');
                    window.success('üéâ Journ√©e parfaite ! Bonus XP accord√©');
                    
                    // Notifier le Quest Manager
                    if (window.questManager) {
                        window.questManager.handlePerfectDay();
                    }
                    
                    document.dispatchEvent(new CustomEvent('synergia:perfect_day'));
                }
            }

            getAttendanceStats() {
                const thisWeek = this.attendanceHistory.filter(session => {
                    const sessionDate = new Date(session.date);
                    const weekAgo = new Date();
                    weekAgo.setDate(weekAgo.getDate() - 7);
                    return sessionDate >= weekAgo;
                });

                return {
                    totalSessions: this.attendanceHistory.length,
                    thisWeek: thisWeek.length,
                    averageHours: this.calculateAverageHours(),
                    punctualityRate: this.calculatePunctualityRate()
                };
            }

            calculateAverageHours() {
                if (this.attendanceHistory.length === 0) return 0;

                const totalMinutes = this.attendanceHistory.reduce((sum, session) => {
                    if (!session.workDuration) return sum;
                    const [hours, minutes] = session.workDuration.split('h');
                    return sum + (parseInt(hours) * 60) + parseInt(minutes);
                }, 0);

                return (totalMinutes / this.attendanceHistory.length / 60).toFixed(1);
            }

            calculatePunctualityRate() {
                if (this.attendanceHistory.length === 0) return 100;

                const punctualSessions = this.attendanceHistory.filter(session => {
                    const clockIn = new Date(session.clockIn);
                    return clockIn.getHours() < 9 || (clockIn.getHours() === 9 && clockIn.getMinutes() <= 30);
                });

                return Math.round((punctualSessions.length / this.attendanceHistory.length) * 100);
            }
        }

        // Navigation
        function setupNavigation() {
            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('.content-section');

            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    
                    // Retirer la classe active de tous les liens
                    navLinks.forEach(l => l.classList.remove('active'));
                    // Ajouter la classe active au lien cliqu√©
                    link.classList.add('active');
                    
                    // Cacher toutes les sections
                    sections.forEach(section => section.classList.remove('active'));
                    
                    // Afficher la section correspondante
                    const targetId = link.getAttribute('href').substring(1);
                    const targetSection = document.getElementById(targetId);
                    if (targetSection) {
                        targetSection.classList.add('active');
                        
                        // D√©clencher des actions sp√©cifiques selon la section
                        switch (targetId) {
                            case 'analytics':
                                if (analyticsManager) {
                                    analyticsManager.refreshAnalytics();
                                }
                                break;
                            case 'team':
                                if (teamManager) {
                                    teamManager.refreshMembers();
                                }
                                break;
                            case 'planning':
                                if (planningManager) {
                                    planningManager.renderCalendar();
                                }
                                break;
                        }
                    }
                });
            });
        }

        // Quests UI
        function setupQuestsUI() {
            // Gestion des onglets de qu√™tes
            const questTabs = document.querySelectorAll('.quest-tab');
            questTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // Retirer l'active de tous les onglets
                    questTabs.forEach(t => t.classList.remove('active'));
                    // Ajouter l'active √† l'onglet cliqu√©
                    tab.classList.add('active');
                    
                    // Filtrer les qu√™tes selon l'onglet
                    const tabType = tab.dataset.tab;
                    filterQuests(tabType);
                });
            });

            // Charger les qu√™tes quotidiennes
            function loadQuests() {
                if (!window.questManager) {
                    setTimeout(loadQuests, 1000);
                    return;
                }

                console.log('üéØ Chargement des qu√™tes...');
                
                const dailyQuests = window.questManager.getDailyQuests();
                const weeklyQuests = window.questManager.getWeeklyQuests();
                const userQuests = window.questManager.getUserQuests();
                
                console.log(`Qu√™tes quotidiennes: ${dailyQuests.length}`);
                console.log(`Qu√™tes hebdomadaires: ${weeklyQuests.length}`);
                console.log(`Qu√™tes utilisateur: ${userQuests.length}`);
                
                updateQuestCounts();
                updateUserLevelDisplay();
            }

            function filterQuests(type) {
                const questCards = document.querySelectorAll('.quest-card');
                questCards.forEach(card => {
                    const questType = card.querySelector('.quest-type').textContent.toLowerCase();
                    const shouldShow = type === 'all' || 
                                     (type === 'daily' && questType.includes('quotidienne')) ||
                                     (type === 'weekly' && questType.includes('hebdomadaire')) ||
                                     (type === 'special' && questType.includes('sp√©ciale')) ||
                                     (type === 'completed' && card.classList.contains('completed'));
                    
                    card.style.display = shouldShow ? 'block' : 'none';
                });
            }

            function updateQuestCounts() {
                const activeQuests = document.querySelectorAll('.quest-card').length;
                document.getElementById('active-quests').textContent = activeQuests;
            }

            async function acceptQuest(questId) {
                console.log(`‚úÖ Acceptation de la qu√™te: ${questId}`);
                
                if (window.questManager) {
                    const userQuest = await window.questManager.acceptQuest(questId);
                    if (userQuest) {
                        const quest = window.questManager.getQuestById(questId);
                        console.log(`üéØ Nouvelle qu√™te assign√©e: ${quest.title}`);
                        console.log(`INFO: Nouvelle mission: ${quest.title}`);
                        console.log('SUCCESS: Mission accept√©e!');
                        window.success(`Mission "${quest.title}" accept√©e!`);
                        
                        // Recharger la liste des qu√™tes
                        loadQuests();
                    }
                }
            }

            function updateUserLevelDisplay() {
                console.log('INFO: Niveau 1 - 0 XP - 0/5 missions');
                
                // Mettre √† jour l'affichage du niveau dans le dashboard
                const currentLevel = 5; // Exemple
                const currentXP = 1250; // Exemple
                
                document.getElementById('user-level').textContent = currentLevel;
                document.getElementById('user-level-display').textContent = `Niveau ${currentLevel}`;
                document.getElementById('user-xp-display').textContent = `${currentXP} XP`;
                
                // Mettre √† jour la barre de progression
                const xpProgress = document.getElementById('xp-progress');
                if (xpProgress) {
                    const progressPercent = ((currentXP % 250) / 250) * 100;
                    xpProgress.style.width = `${progressPercent}%`;
                }
            }

            // Exposer les fonctions globalement
            window.loadQuests = loadQuests;
            window.acceptQuest = acceptQuest;
            window.filterQuests = filterQuests;

            // Charger les qu√™tes au d√©marrage
            setTimeout(loadQuests, 1000);
        }

        // Dashboard updates
        function updateDashboardStats() {
            if (teamManager) {
                document.getElementById('team-count').textContent = teamManager.members.length;
            }
            
            if (planningManager) {
                const today = new Date();
                const todayEvents = planningManager.events.filter(event => {
                    const eventDate = new Date(event.date);
                    return eventDate.toDateString() === today.toDateString();
                });
                document.getElementById('events-today').textContent = todayEvents.length;
            }
        }

        // Initialisation principale
        async function init() {
            try {
                // Attendre Firebase
                await waitForFirebase();
                
                // Configuration de l'authentification
                if (window.firebase && window.firebase.onAuthStateChanged) {
                    window.firebase.onAuthStateChanged(window.auth, handleAuthStateChange);
                } else {
                    console.log('Firebase non disponible, mode d√©mo');
                    initializeDemoMode();
                }
                
                // Configuration de la navigation
                setupNavigation();
                
                // Configuration des qu√™tes
                setupQuestsUI();
                
                // Logout
                const logoutBtn = document.getElementById('logout-btn');
                if (logoutBtn) {
                    logoutBtn.addEventListener('click', () => {
                        if (confirm('Voulez-vous vraiment vous d√©connecter ?')) {
                            if (window.auth && window.auth.signOut) {
                                window.auth.signOut().then(() => {
                                    window.showToast('D√©connexion r√©ussie', 'success');
                                    location.reload();
                                });
                            } else {
                                window.showToast('D√©connexion simul√©e', 'info');
                                location.reload();
                            }
                        }
                    });
                }

                // Refresh dashboard
                const refreshDashboard = document.getElementById('refresh-dashboard');
                if (refreshDashboard) {
                    refreshDashboard.addEventListener('click', () => {
                        window.showToast('Actualisation du dashboard...', 'info');
                        updateDashboardStats();
                        if (analyticsManager) analyticsManager.refreshAnalytics();
                        window.success('Dashboard actualis√©');
                    });
                }

                // Gestion des modals
                document.addEventListener('click', (e) => {
                    if (e.target.classList.contains('close')) {
                        const modal = e.target.closest('.modal');
                        if (modal) {
                            modal.style.display = 'none';
                        }
                    }
                    
                    if (e.target.classList.contains('modal')) {
                        e.target.style.display = 'none';
                    }
                });

                // Raccourcis clavier
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        const openModals = document.querySelectorAll('.modal[style*="display: flex"]');
                        openModals.forEach(modal => {
                            modal.style.display = 'none';
                        });
                    }
                });

                console.log('‚úÖ SYNERGIA v3.0 initialized successfully!');
                
            } catch (error) {
                console.error('‚ùå Erreur lors de l\'initialisation:', error);
            }
        }

        // D√©marrage de l'application
        document.addEventListener('DOMContentLoaded', init);

        // Mise √† jour p√©riodique
        setInterval(() => {
            updateDashboardStats();
        }, 30000); // Toutes les 30 secondes

    </script>
</body>
</html>
